<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <title>Spark MLContext Programming Guide - SystemML 0.12.0</title>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        
        <meta name="description" content="Spark MLContext Programming Guide">
        
        <meta name="viewport" content="width=device-width">
        <link rel="stylesheet" href="css/bootstrap.min.css">
        <link rel="stylesheet" href="css/main.css">
        <link rel="stylesheet" href="css/pygments-default.css">
        <link rel="shortcut icon" href="img/favicon.png">
    </head>
    <body>
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an outdated browser. <a href="http://browsehappy.com/">Upgrade your browser today</a> or <a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to better experience this site.</p>
        <![endif]-->

        <header class="navbar navbar-default navbar-fixed-top" id="topbar">
            <div class="container">
                <div class="navbar-header">
                    <div class="navbar-brand brand projectlogo">
                        <a href="http://systemml.apache.org/"><img class="logo" src="img/systemml-logo.png" alt="Apache SystemML (incubating)" title="Apache SystemML (incubating)"/></a>
                    </div>
                    <div class="navbar-brand brand projecttitle">
                        <a href="http://systemml.apache.org/">Apache SystemML<sup id="trademark">â„¢</sup> (incubating)</a><br/>
                        <span class="version">0.12.0</span>
                    </div>
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>
                <nav class="navbar-collapse collapse">
                    <ul class="nav navbar-nav navbar-right">
                        <li><a href="index.html">Overview</a></li>
                        <li><a href="https://github.com/apache/incubator-systemml">GitHub</a></li>
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Documentation<b class="caret"></b></a>
                            <ul class="dropdown-menu" role="menu">
                                <li><b>Running SystemML:</b></li>
                                <li><a href="https://github.com/apache/incubator-systemml">SystemML GitHub README</a></li>
                                <li><a href="spark-mlcontext-programming-guide.html">Spark MLContext</a></li>
                                <li><a href="spark-batch-mode.html">Spark Batch Mode</a>
                                <li><a href="hadoop-batch-mode.html">Hadoop Batch Mode</a>
                                <li><a href="standalone-guide.html">Standalone Guide</a></li>
                                <li><a href="jmlc.html">Java Machine Learning Connector (JMLC)</a>
                                <li class="divider"></li>
                                <li><b>Language Guides:</b></li>
                                <li><a href="dml-language-reference.html">DML Language Reference</a></li>
                                <li><a href="beginners-guide-to-dml-and-pydml.html">Beginner's Guide to DML and PyDML</a></li>
                                <li><a href="beginners-guide-python.html">Beginner's Guide for Python Users</a></li>
                                <li><a href="python-reference.html">Reference Guide for Python Users</a></li>
                                <li class="divider"></li>
                                <li><b>ML Algorithms:</b></li>
                                <li><a href="algorithms-reference.html">Algorithms Reference</a></li>
                                <li class="divider"></li>
                                <li><b>Tools:</b></li>
                                <li><a href="debugger-guide.html">Debugger Guide</a></li>
                                <li><a href="developer-tools-systemml.html">IDE Guide</a></li>
                                <li class="divider"></li>
                                <li><b>Other:</b></li>
                                <li><a href="contributing-to-systemml.html">Contributing to SystemML</a></li>
                                <li><a href="engine-dev-guide.html">Engine Developer Guide</a></li>
                                <li><a href="troubleshooting-guide.html">Troubleshooting Guide</a></li>
                                <li><a href="release-process.html">Release Process</a></li>
                            </ul>
                        </li>
                        
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">API Docs<b class="caret"></b></a>
                            <ul class="dropdown-menu" role="menu">
                                <li><a href="./api/java/index.html">Javadoc</a></li>
                            </ul>
                        </li>
                        
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Issues<b class="caret"></b></a>
                            <ul class="dropdown-menu" role="menu">
                                <li><b>JIRA:</b></li>
                                <li><a href="https://issues.apache.org/jira/browse/SYSTEMML">SystemML JIRA</a></li>
                                
                            </ul>
                        </li>
                    </ul>
                </nav>
            </div>
        </header>

        <div class="container" id="content">
          
            <h1 class="title">Spark MLContext Programming Guide</h1>
          

          <!--

-->

<ul id="markdown-toc">
  <li><a href="#overview" id="markdown-toc-overview">Overview</a></li>
  <li><a href="#spark-shell-example" id="markdown-toc-spark-shell-example">Spark Shell Example</a>    <ul>
      <li><a href="#start-spark-shell-with-systemml" id="markdown-toc-start-spark-shell-with-systemml">Start Spark Shell with SystemML</a></li>
      <li><a href="#create-mlcontext" id="markdown-toc-create-mlcontext">Create MLContext</a></li>
      <li><a href="#hello-world" id="markdown-toc-hello-world">Hello World</a></li>
      <li><a href="#dataframe-example" id="markdown-toc-dataframe-example">DataFrame Example</a></li>
      <li><a href="#rdd-example" id="markdown-toc-rdd-example">RDD Example</a></li>
      <li><a href="#matrix-output" id="markdown-toc-matrix-output">Matrix Output</a></li>
      <li><a href="#univariate-statistics-on-haberman-data" id="markdown-toc-univariate-statistics-on-haberman-data">Univariate Statistics on Haberman Data</a>        <ul>
          <li><a href="#input-variables-vs-input-parameters" id="markdown-toc-input-variables-vs-input-parameters">Input Variables vs Input Parameters</a></li>
        </ul>
      </li>
      <li><a href="#script-information" id="markdown-toc-script-information">Script Information</a></li>
      <li><a href="#clearing-scripts-and-mlcontext" id="markdown-toc-clearing-scripts-and-mlcontext">Clearing Scripts and MLContext</a></li>
      <li><a href="#statistics" id="markdown-toc-statistics">Statistics</a></li>
      <li><a href="#explain" id="markdown-toc-explain">Explain</a></li>
      <li><a href="#script-creation-and-scriptfactory" id="markdown-toc-script-creation-and-scriptfactory">Script Creation and ScriptFactory</a></li>
      <li><a href="#scriptexecutor" id="markdown-toc-scriptexecutor">ScriptExecutor</a></li>
      <li><a href="#matrixmetadata" id="markdown-toc-matrixmetadata">MatrixMetadata</a></li>
      <li><a href="#matrix-data-conversions-and-performance" id="markdown-toc-matrix-data-conversions-and-performance">Matrix Data Conversions and Performance</a></li>
    </ul>
  </li>
  <li><a href="#jupyter-pyspark-notebook-example---poisson-nonnegative-matrix-factorization" id="markdown-toc-jupyter-pyspark-notebook-example---poisson-nonnegative-matrix-factorization">Jupyter (PySpark) Notebook Example - Poisson Nonnegative Matrix Factorization</a>    <ul>
      <li><a href="#set-up-the-notebook-and-download-the-data" id="markdown-toc-set-up-the-notebook-and-download-the-data">Set up the notebook and download the data</a></li>
      <li><a href="#use-pyspark-to-load-the-data-in-as-a-spark-dataframe" id="markdown-toc-use-pyspark-to-load-the-data-in-as-a-spark-dataframe">Use PySpark to load the data in as a Spark DataFrame</a></li>
      <li><a href="#create-a-systemml-mlcontext-object" id="markdown-toc-create-a-systemml-mlcontext-object">Create a SystemML MLContext object</a></li>
      <li><a href="#define-a-kernel-for-poisson-nonnegative-matrix-factorization-pnmf-in-dml" id="markdown-toc-define-a-kernel-for-poisson-nonnegative-matrix-factorization-pnmf-in-dml">Define a kernel for Poisson nonnegative matrix factorization (PNMF) in DML</a></li>
      <li><a href="#execute-the-algorithm" id="markdown-toc-execute-the-algorithm">Execute the algorithm</a></li>
      <li><a href="#retrieve-the-losses-during-training-and-plot-them" id="markdown-toc-retrieve-the-losses-during-training-and-plot-them">Retrieve the losses during training and plot them</a></li>
    </ul>
  </li>
  <li><a href="#spark-shell-example---old-api" id="markdown-toc-spark-shell-example---old-api">Spark Shell Example - OLD API</a>    <ul>
      <li><a href="#note-this-api-is-old-and-has-been-deprecated-" id="markdown-toc-note-this-api-is-old-and-has-been-deprecated-">** <strong>NOTE: This API is old and has been deprecated.</strong> **</a></li>
      <li><a href="#start-spark-shell-with-systemml-1" id="markdown-toc-start-spark-shell-with-systemml-1">Start Spark Shell with SystemML</a></li>
      <li><a href="#create-mlcontext-1" id="markdown-toc-create-mlcontext-1">Create MLContext</a></li>
      <li><a href="#create-dataframe" id="markdown-toc-create-dataframe">Create DataFrame</a></li>
      <li><a href="#helper-methods" id="markdown-toc-helper-methods">Helper Methods</a></li>
      <li><a href="#convert-dataframe-to-binary-block-matrix" id="markdown-toc-convert-dataframe-to-binary-block-matrix">Convert DataFrame to Binary-Block Matrix</a></li>
      <li><a href="#dml-script" id="markdown-toc-dml-script">DML Script</a></li>
      <li><a href="#execute-script" id="markdown-toc-execute-script">Execute Script</a></li>
      <li><a href="#dml-script-as-string" id="markdown-toc-dml-script-as-string">DML Script as String</a></li>
      <li><a href="#scala-wrapper-for-dml" id="markdown-toc-scala-wrapper-for-dml">Scala Wrapper for DML</a></li>
      <li><a href="#invoking-dml-via-scala-wrapper" id="markdown-toc-invoking-dml-via-scala-wrapper">Invoking DML via Scala Wrapper</a></li>
    </ul>
  </li>
  <li><a href="#zeppelin-notebook-example---linear-regression-algorithm---old-api" id="markdown-toc-zeppelin-notebook-example---linear-regression-algorithm---old-api">Zeppelin Notebook Example - Linear Regression Algorithm - OLD API</a>    <ul>
      <li><a href="#note-this-api-is-old-and-has-been-deprecated--1" id="markdown-toc-note-this-api-is-old-and-has-been-deprecated--1">** <strong>NOTE: This API is old and has been deprecated.</strong> **</a></li>
      <li><a href="#trigger-spark-startup" id="markdown-toc-trigger-spark-startup">Trigger Spark Startup</a></li>
      <li><a href="#generate-linear-regression-test-data" id="markdown-toc-generate-linear-regression-test-data">Generate Linear Regression Test Data</a></li>
      <li><a href="#train-using-spark-ml-linear-regression-algorithm-for-comparison" id="markdown-toc-train-using-spark-ml-linear-regression-algorithm-for-comparison">Train using Spark ML Linear Regression Algorithm for Comparison</a></li>
      <li><a href="#spark-ml-linear-regression-summary-statistics" id="markdown-toc-spark-ml-linear-regression-summary-statistics">Spark ML Linear Regression Summary Statistics</a></li>
      <li><a href="#systemml-linear-regression-algorithm" id="markdown-toc-systemml-linear-regression-algorithm">SystemML Linear Regression Algorithm</a></li>
      <li><a href="#helper-methods-1" id="markdown-toc-helper-methods-1">Helper Methods</a></li>
      <li><a href="#convert-dataframe-to-binary-block-format" id="markdown-toc-convert-dataframe-to-binary-block-format">Convert DataFrame to Binary-Block Format</a></li>
      <li><a href="#train-using-systemml-linear-regression-algorithm" id="markdown-toc-train-using-systemml-linear-regression-algorithm">Train using SystemML Linear Regression Algorithm</a></li>
      <li><a href="#systemml-linear-regression-summary-statistics" id="markdown-toc-systemml-linear-regression-summary-statistics">SystemML Linear Regression Summary Statistics</a></li>
    </ul>
  </li>
  <li><a href="#jupyter-pyspark-notebook-example---poisson-nonnegative-matrix-factorization---old-api" id="markdown-toc-jupyter-pyspark-notebook-example---poisson-nonnegative-matrix-factorization---old-api">Jupyter (PySpark) Notebook Example - Poisson Nonnegative Matrix Factorization - OLD API</a>    <ul>
      <li><a href="#note-this-api-is-old-and-has-been-deprecated--2" id="markdown-toc-note-this-api-is-old-and-has-been-deprecated--2">** <strong>NOTE: This API is old and has been deprecated.</strong> **</a></li>
      <li><a href="#set-up-the-notebook-and-download-the-data-1" id="markdown-toc-set-up-the-notebook-and-download-the-data-1">Set up the notebook and download the data</a></li>
      <li><a href="#use-pyspark-to-load-the-data-in-as-a-spark-dataframe-1" id="markdown-toc-use-pyspark-to-load-the-data-in-as-a-spark-dataframe-1">Use PySpark to load the data in as a Spark DataFrame</a></li>
      <li><a href="#create-a-systemml-mlcontext-object-1" id="markdown-toc-create-a-systemml-mlcontext-object-1">Create a SystemML MLContext object</a></li>
      <li><a href="#define-a-kernel-for-poisson-nonnegative-matrix-factorization-pnmf-in-dml-1" id="markdown-toc-define-a-kernel-for-poisson-nonnegative-matrix-factorization-pnmf-in-dml-1">Define a kernel for Poisson nonnegative matrix factorization (PNMF) in DML</a></li>
      <li><a href="#execute-the-algorithm-1" id="markdown-toc-execute-the-algorithm-1">Execute the algorithm</a></li>
      <li><a href="#retrieve-the-losses-during-training-and-plot-them-1" id="markdown-toc-retrieve-the-losses-during-training-and-plot-them-1">Retrieve the losses during training and plot them</a></li>
    </ul>
  </li>
  <li><a href="#recommended-spark-configuration-settings" id="markdown-toc-recommended-spark-configuration-settings">Recommended Spark Configuration Settings</a></li>
</ul>

<p><br /></p>

<h1 id="overview">Overview</h1>

<p>The Spark <code class="highlighter-rouge">MLContext</code> API offers a programmatic interface for interacting with SystemML from Spark using languages
such as Scala, Java, and Python. As a result, it offers a convenient way to interact with SystemML from the Spark
Shell and from Notebooks such as Jupyter and Zeppelin.</p>

<p><strong>NOTE: A new MLContext API has been redesigned for future SystemML releases. The old API is available
in previous versions of SystemML but is deprecated and will be removed soon, so please migrate to the new API.</strong></p>

<h1 id="spark-shell-example">Spark Shell Example</h1>

<h2 id="start-spark-shell-with-systemml">Start Spark Shell with SystemML</h2>

<p>To use SystemML with Spark Shell, the SystemML jar can be referenced using Spark Shell&#8217;s <code class="highlighter-rouge">--jars</code> option.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">spark-shell --executor-memory 4G --driver-memory 4G --jars SystemML.jar</code></pre></figure>

<h2 id="create-mlcontext">Create MLContext</h2>

<p>All primary classes that a user interacts with are located in the <code class="highlighter-rouge">org.apache.sysml.api.mlcontext package</code>.
For convenience, we can additionally add a static import of ScriptFactory to shorten the syntax for creating Script objects.
An <code class="highlighter-rouge">MLContext</code> object can be created by passing its constructor a reference to the <code class="highlighter-rouge">SparkContext</code>. If successful, you
should see a &#8220;<code class="highlighter-rouge">Welcome to Apache SystemML!</code>&#8221; message.</p>

<div class="codetabs">

<div data-lang="Scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">import</span> <span class="nn">org.apache.sysml.api.mlcontext._</span>
<span class="k">import</span> <span class="nn">org.apache.sysml.api.mlcontext.ScriptFactory._</span>
<span class="k">val</span> <span class="n">ml</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">MLContext</span><span class="o">(</span><span class="n">sc</span><span class="o">)</span></code></pre></figure>

  </div>

<div data-lang="Spark Shell">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="n">scala</span><span class="o">&gt;</span> <span class="k">import</span> <span class="nn">org.apache.sysml.api.mlcontext._</span>
<span class="k">import</span> <span class="nn">org.apache.sysml.api.mlcontext._</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">import</span> <span class="nn">org.apache.sysml.api.mlcontext.ScriptFactory._</span>
<span class="k">import</span> <span class="nn">org.apache.sysml.api.mlcontext.ScriptFactory._</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">ml</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">MLContext</span><span class="o">(</span><span class="n">sc</span><span class="o">)</span>

<span class="nc">Welcome</span> <span class="n">to</span> <span class="nc">Apache</span> <span class="nc">SystemML</span><span class="o">!</span>

<span class="n">ml</span><span class="k">:</span> <span class="kt">org.apache.sysml.api.mlcontext.MLContext</span> <span class="o">=</span> <span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">sysml</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">mlcontext</span><span class="o">.</span><span class="nc">MLContext</span><span class="k">@</span><span class="mf">12139d</span><span class="n">b0</span></code></pre></figure>

  </div>

</div>

<h2 id="hello-world">Hello World</h2>

<p>The ScriptFactory class allows DML and PYDML scripts to be created from Strings, Files, URLs, and InputStreams.
Here, we&#8217;ll use the <code class="highlighter-rouge">dml</code> method to create a DML &#8220;hello world&#8221; script based on a String. Notice that the script
reports that it has no inputs or outputs.</p>

<p>We execute the script using MLContext&#8217;s <code class="highlighter-rouge">execute</code> method, which displays &#8220;<code class="highlighter-rouge">hello world</code>&#8221; to the console.
The <code class="highlighter-rouge">execute</code> method returns an MLResults object, which contains no results since the script has
no outputs.</p>

<div class="codetabs">

<div data-lang="Scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">helloScript</span> <span class="k">=</span> <span class="n">dml</span><span class="o">(</span><span class="s">"print('hello world')"</span><span class="o">)</span>
<span class="n">ml</span><span class="o">.</span><span class="n">execute</span><span class="o">(</span><span class="n">helloScript</span><span class="o">)</span></code></pre></figure>

  </div>

<div data-lang="Spark Shell">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">helloScript</span> <span class="k">=</span> <span class="n">dml</span><span class="o">(</span><span class="s">"print('hello world')"</span><span class="o">)</span>
<span class="n">helloScript</span><span class="k">:</span> <span class="kt">org.apache.sysml.api.mlcontext.Script</span> <span class="o">=</span>
<span class="nc">Inputs</span><span class="k">:</span>
<span class="kt">None</span>

<span class="nc">Outputs</span><span class="k">:</span>
<span class="kt">None</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="n">ml</span><span class="o">.</span><span class="n">execute</span><span class="o">(</span><span class="n">helloScript</span><span class="o">)</span>
<span class="n">hello</span> <span class="n">world</span>
<span class="n">res0</span><span class="k">:</span> <span class="kt">org.apache.sysml.api.mlcontext.MLResults</span> <span class="o">=</span>
<span class="nc">None</span></code></pre></figure>

  </div>

</div>

<h2 id="dataframe-example">DataFrame Example</h2>

<p>For demonstration purposes, we&#8217;ll use Spark to create a <code class="highlighter-rouge">DataFrame</code> called <code class="highlighter-rouge">df</code> of random <code class="highlighter-rouge">double</code>s from 0 to 1 consisting of 10,000 rows and 1,000 columns.</p>

<div class="codetabs">

<div data-lang="Scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">import</span> <span class="nn">org.apache.spark.sql._</span>
<span class="k">import</span> <span class="nn">org.apache.spark.sql.types.</span><span class="o">{</span><span class="nc">StructType</span><span class="o">,</span><span class="nc">StructField</span><span class="o">,</span><span class="nc">DoubleType</span><span class="o">}</span>
<span class="k">import</span> <span class="nn">scala.util.Random</span>
<span class="k">val</span> <span class="n">numRows</span> <span class="k">=</span> <span class="mi">10000</span>
<span class="k">val</span> <span class="n">numCols</span> <span class="k">=</span> <span class="mi">1000</span>
<span class="k">val</span> <span class="n">data</span> <span class="k">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">parallelize</span><span class="o">(</span><span class="mi">0</span> <span class="n">to</span> <span class="n">numRows</span><span class="o">-</span><span class="mi">1</span><span class="o">).</span><span class="n">map</span> <span class="o">{</span> <span class="k">_</span> <span class="k">=&gt;</span> <span class="nc">Row</span><span class="o">.</span><span class="n">fromSeq</span><span class="o">(</span><span class="nc">Seq</span><span class="o">.</span><span class="n">fill</span><span class="o">(</span><span class="n">numCols</span><span class="o">)(</span><span class="nc">Random</span><span class="o">.</span><span class="n">nextDouble</span><span class="o">))</span> <span class="o">}</span>
<span class="k">val</span> <span class="n">schema</span> <span class="k">=</span> <span class="nc">StructType</span><span class="o">((</span><span class="mi">0</span> <span class="n">to</span> <span class="n">numCols</span><span class="o">-</span><span class="mi">1</span><span class="o">).</span><span class="n">map</span> <span class="o">{</span> <span class="n">i</span> <span class="k">=&gt;</span> <span class="nc">StructField</span><span class="o">(</span><span class="s">"C"</span> <span class="o">+</span> <span class="n">i</span><span class="o">,</span> <span class="nc">DoubleType</span><span class="o">,</span> <span class="kc">true</span><span class="o">)</span> <span class="o">}</span> <span class="o">)</span>
<span class="k">val</span> <span class="n">df</span> <span class="k">=</span> <span class="n">sqlContext</span><span class="o">.</span><span class="n">createDataFrame</span><span class="o">(</span><span class="n">data</span><span class="o">,</span> <span class="n">schema</span><span class="o">)</span></code></pre></figure>

  </div>

<div data-lang="Spark Shell">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="n">scala</span><span class="o">&gt;</span> <span class="k">import</span> <span class="nn">org.apache.spark.sql._</span>
<span class="k">import</span> <span class="nn">org.apache.spark.sql._</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">import</span> <span class="nn">org.apache.spark.sql.types.</span><span class="o">{</span><span class="nc">StructType</span><span class="o">,</span><span class="nc">StructField</span><span class="o">,</span><span class="nc">DoubleType</span><span class="o">}</span>
<span class="k">import</span> <span class="nn">org.apache.spark.sql.types.</span><span class="o">{</span><span class="nc">StructType</span><span class="o">,</span> <span class="nc">StructField</span><span class="o">,</span> <span class="nc">DoubleType</span><span class="o">}</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">import</span> <span class="nn">scala.util.Random</span>
<span class="k">import</span> <span class="nn">scala.util.Random</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">numRows</span> <span class="k">=</span> <span class="mi">10000</span>
<span class="n">numRows</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">10000</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">numCols</span> <span class="k">=</span> <span class="mi">1000</span>
<span class="n">numCols</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">1000</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">data</span> <span class="k">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">parallelize</span><span class="o">(</span><span class="mi">0</span> <span class="n">to</span> <span class="n">numRows</span><span class="o">-</span><span class="mi">1</span><span class="o">).</span><span class="n">map</span> <span class="o">{</span> <span class="k">_</span> <span class="k">=&gt;</span> <span class="nc">Row</span><span class="o">.</span><span class="n">fromSeq</span><span class="o">(</span><span class="nc">Seq</span><span class="o">.</span><span class="n">fill</span><span class="o">(</span><span class="n">numCols</span><span class="o">)(</span><span class="nc">Random</span><span class="o">.</span><span class="n">nextDouble</span><span class="o">))</span> <span class="o">}</span>
<span class="n">data</span><span class="k">:</span> <span class="kt">org.apache.spark.rdd.RDD</span><span class="o">[</span><span class="kt">org.apache.spark.sql.Row</span><span class="o">]</span> <span class="k">=</span> <span class="nc">MapPartitionsRDD</span><span class="o">[</span><span class="err">1</span><span class="o">]</span> <span class="n">at</span> <span class="n">map</span> <span class="n">at</span> <span class="o">&lt;</span><span class="n">console</span><span class="k">&gt;:</span><span class="mi">42</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">schema</span> <span class="k">=</span> <span class="nc">StructType</span><span class="o">((</span><span class="mi">0</span> <span class="n">to</span> <span class="n">numCols</span><span class="o">-</span><span class="mi">1</span><span class="o">).</span><span class="n">map</span> <span class="o">{</span> <span class="n">i</span> <span class="k">=&gt;</span> <span class="nc">StructField</span><span class="o">(</span><span class="s">"C"</span> <span class="o">+</span> <span class="n">i</span><span class="o">,</span> <span class="nc">DoubleType</span><span class="o">,</span> <span class="kc">true</span><span class="o">)</span> <span class="o">}</span> <span class="o">)</span>
<span class="n">schema</span><span class="k">:</span> <span class="kt">org.apache.spark.sql.</span><span class="k">type</span><span class="kt">s.StructType</span> <span class="o">=</span> <span class="nc">StructType</span><span class="o">(</span><span class="nc">StructField</span><span class="o">(</span><span class="n">C0</span><span class="o">,</span><span class="nc">DoubleType</span><span class="o">,</span><span class="kc">true</span><span class="o">),</span> <span class="nc">StructField</span><span class="o">(</span><span class="n">C1</span><span class="o">,</span><span class="nc">DoubleType</span><span class="o">,</span><span class="kc">true</span><span class="o">),</span> <span class="nc">StructField</span><span class="o">(</span><span class="n">C2</span><span class="o">,</span><span class="nc">DoubleType</span><span class="o">,</span><span class="kc">true</span><span class="o">),</span> <span class="nc">StructField</span><span class="o">(</span><span class="n">C3</span><span class="o">,</span><span class="nc">DoubleType</span><span class="o">,</span><span class="kc">true</span><span class="o">),</span> <span class="nc">StructField</span><span class="o">(</span><span class="n">C4</span><span class="o">,</span><span class="nc">DoubleType</span><span class="o">,</span><span class="kc">true</span><span class="o">),</span> <span class="nc">StructField</span><span class="o">(</span><span class="n">C5</span><span class="o">,</span><span class="nc">DoubleType</span><span class="o">,</span><span class="kc">true</span><span class="o">),</span> <span class="nc">StructField</span><span class="o">(</span><span class="n">C6</span><span class="o">,</span><span class="nc">DoubleType</span><span class="o">,</span><span class="kc">true</span><span class="o">),</span> <span class="nc">StructField</span><span class="o">(</span><span class="n">C7</span><span class="o">,</span><span class="nc">DoubleType</span><span class="o">,</span><span class="kc">true</span><span class="o">),</span> <span class="nc">StructField</span><span class="o">(</span><span class="n">C8</span><span class="o">,</span><span class="nc">DoubleType</span><span class="o">,</span><span class="kc">true</span><span class="o">),</span> <span class="nc">StructField</span><span class="o">(</span><span class="n">C9</span><span class="o">,</span><span class="nc">DoubleType</span><span class="o">,</span><span class="kc">true</span><span class="o">),</span> <span class="nc">StructField</span><span class="o">(</span><span class="n">C10</span><span class="o">,</span><span class="nc">DoubleType</span><span class="o">,</span><span class="kc">true</span><span class="o">),</span> <span class="nc">StructField</span><span class="o">(</span><span class="n">C11</span><span class="o">,</span><span class="nc">DoubleType</span><span class="o">,</span><span class="kc">true</span><span class="o">),</span> <span class="nc">StructField</span><span class="o">(</span><span class="n">C12</span><span class="o">,</span><span class="nc">DoubleType</span><span class="o">,</span><span class="kc">true</span><span class="o">),</span> <span class="nc">StructField</span><span class="o">(</span><span class="n">C13</span><span class="o">,</span><span class="nc">DoubleType</span><span class="o">,</span><span class="kc">true</span><span class="o">),</span> <span class="nc">StructField</span><span class="o">(</span><span class="n">C14</span><span class="o">,</span><span class="nc">DoubleType</span><span class="o">,</span><span class="kc">true</span><span class="o">),</span> <span class="nc">StructField</span><span class="o">(</span><span class="n">C15</span><span class="o">,</span><span class="nc">DoubleType</span><span class="o">,</span><span class="kc">true</span><span class="o">),</span> <span class="nc">StructField</span><span class="o">(</span><span class="n">C16</span><span class="o">,</span><span class="nc">DoubleType</span><span class="o">,</span><span class="kc">true</span><span class="o">),</span> <span class="nc">StructField</span><span class="o">(</span><span class="n">C17</span><span class="o">,</span><span class="nc">DoubleType</span><span class="o">,</span><span class="kc">true</span><span class="o">),</span> <span class="nc">StructField</span><span class="o">(</span><span class="n">C18</span><span class="o">,</span><span class="nc">DoubleType</span><span class="o">,</span><span class="kc">true</span><span class="o">),</span> <span class="nc">StructField</span><span class="o">(</span><span class="n">C19</span><span class="o">,</span><span class="nc">DoubleType</span><span class="o">,</span><span class="kc">true</span><span class="o">),</span> <span class="nc">StructField</span><span class="o">(</span><span class="n">C20</span><span class="o">,</span><span class="nc">DoubleType</span><span class="o">,</span><span class="kc">true</span><span class="o">),</span> <span class="nc">StructField</span><span class="o">(</span><span class="n">C21</span><span class="o">,</span><span class="nc">DoubleType</span><span class="o">,</span><span class="kc">true</span><span class="o">),</span> <span class="o">...</span>
<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">df</span> <span class="k">=</span> <span class="n">sqlContext</span><span class="o">.</span><span class="n">createDataFrame</span><span class="o">(</span><span class="n">data</span><span class="o">,</span> <span class="n">schema</span><span class="o">)</span>
<span class="n">df</span><span class="k">:</span> <span class="kt">org.apache.spark.sql.DataFrame</span> <span class="o">=</span> <span class="o">[</span><span class="kt">C0:</span> <span class="kt">double</span>, <span class="kt">C1:</span> <span class="kt">double</span>, <span class="kt">C2:</span> <span class="kt">double</span>, <span class="kt">C3:</span> <span class="kt">double</span>, <span class="kt">C4:</span> <span class="kt">double</span>, <span class="kt">C5:</span> <span class="kt">double</span>, <span class="kt">C6:</span> <span class="kt">double</span>, <span class="kt">C7:</span> <span class="kt">double</span>, <span class="kt">C8:</span> <span class="kt">double</span>, <span class="kt">C9:</span> <span class="kt">double</span>, <span class="kt">C10:</span> <span class="kt">double</span>, <span class="kt">C11:</span> <span class="kt">double</span>, <span class="kt">C12:</span> <span class="kt">double</span>, <span class="kt">C13:</span> <span class="kt">double</span>, <span class="kt">C14:</span> <span class="kt">double</span>, <span class="kt">C15:</span> <span class="kt">double</span>, <span class="kt">C16:</span> <span class="kt">double</span>, <span class="kt">C17:</span> <span class="kt">double</span>, <span class="kt">C18:</span> <span class="kt">double</span>, <span class="kt">C19:</span> <span class="kt">double</span>, <span class="kt">C20:</span> <span class="kt">double</span>, <span class="kt">C21:</span> <span class="kt">double</span>, <span class="kt">C22:</span> <span class="kt">double</span>, <span class="kt">C23:</span> <span class="kt">double</span>, <span class="kt">C24:</span> <span class="kt">double</span>, <span class="kt">C25:</span> <span class="kt">double</span>, <span class="kt">C26:</span> <span class="kt">double</span>, <span class="kt">C27:</span> <span class="kt">double</span>, <span class="kt">C28:</span> <span class="kt">double</span>, <span class="kt">C29:</span> <span class="kt">double</span>, <span class="kt">C30:</span> <span class="kt">double</span>, <span class="kt">C31:</span> <span class="kt">double</span>, <span class="kt">C32:</span> <span class="kt">double</span>, <span class="kt">C33:</span> <span class="kt">double</span>, <span class="kt">C34:</span> <span class="kt">double</span>, <span class="kt">C35:</span> <span class="kt">double</span>, <span class="kt">C36:</span> <span class="kt">double</span>, <span class="kt">C37:</span> <span class="kt">double</span>, <span class="kt">C38:</span> <span class="kt">double</span>, <span class="kt">C39:</span> <span class="kt">double</span>, <span class="kt">C40:</span> <span class="kt">double</span>, <span class="kt">C41:</span> <span class="kt">double</span>, <span class="kt">C42:</span> <span class="kt">double</span>, <span class="kt">C43:</span> <span class="kt">double</span>, <span class="kt">C44:</span> <span class="kt">double</span>, <span class="kt">C45:</span> <span class="kt">double</span>, <span class="kt">C46:</span> <span class="kt">double</span>, <span class="kt">C47:</span> <span class="kt">double</span>, <span class="kt">C48:</span> <span class="kt">double</span>, <span class="kt">C49:</span> <span class="kt">double</span>, <span class="kt">C50:</span> <span class="kt">double</span>, <span class="kt">C51:</span> <span class="kt">double</span>, <span class="kt">C52:</span> <span class="kt">double</span>, <span class="kt">C53:</span> <span class="kt">double</span>, <span class="kt">C54:</span> <span class="kt">double</span>, <span class="kt">C55:</span> <span class="kt">double</span>, <span class="kt">C56:</span> <span class="kt">double</span>, <span class="kt">C57:</span> <span class="kt">double</span>, <span class="kt">C58:</span> <span class="kt">double</span>, <span class="kt">C5...</span></code></pre></figure>

  </div>

</div>

<p>We&#8217;ll create a DML script to find the minimum, maximum, and mean values in a matrix. This
script has one input variable, matrix <code class="highlighter-rouge">Xin</code>, and three output variables, <code class="highlighter-rouge">minOut</code>, <code class="highlighter-rouge">maxOut</code>, and <code class="highlighter-rouge">meanOut</code>.</p>

<p>For performance, we&#8217;ll specify metadata indicating that the matrix has 10,000 rows and 1,000 columns.</p>

<p>We&#8217;ll create a DML script using the ScriptFactory <code class="highlighter-rouge">dml</code> method with the <code class="highlighter-rouge">minMaxMean</code> script String. The
input variable is specified to be our <code class="highlighter-rouge">DataFrame</code> <code class="highlighter-rouge">df</code> with <code class="highlighter-rouge">MatrixMetadata</code> <code class="highlighter-rouge">mm</code>. The output
variables are specified to be <code class="highlighter-rouge">minOut</code>, <code class="highlighter-rouge">maxOut</code>, and <code class="highlighter-rouge">meanOut</code>. Notice that inputs are supplied by the
<code class="highlighter-rouge">in</code> method, and outputs are supplied by the <code class="highlighter-rouge">out</code> method.</p>

<p>We execute the script and obtain the results as a Tuple by calling <code class="highlighter-rouge">getTuple</code> on the results, specifying
the types and names of the output variables.</p>

<div class="codetabs">

<div data-lang="Scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">minMaxMean</span> <span class="k">=</span>
<span class="s">"""
minOut = min(Xin)
maxOut = max(Xin)
meanOut = mean(Xin)
"""</span>
<span class="k">val</span> <span class="n">mm</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">MatrixMetadata</span><span class="o">(</span><span class="n">numRows</span><span class="o">,</span> <span class="n">numCols</span><span class="o">)</span>
<span class="k">val</span> <span class="n">minMaxMeanScript</span> <span class="k">=</span> <span class="n">dml</span><span class="o">(</span><span class="n">minMaxMean</span><span class="o">).</span><span class="n">in</span><span class="o">(</span><span class="s">"Xin"</span><span class="o">,</span> <span class="n">df</span><span class="o">,</span> <span class="n">mm</span><span class="o">).</span><span class="n">out</span><span class="o">(</span><span class="s">"minOut"</span><span class="o">,</span> <span class="s">"maxOut"</span><span class="o">,</span> <span class="s">"meanOut"</span><span class="o">)</span>
<span class="k">val</span> <span class="o">(</span><span class="n">min</span><span class="o">,</span> <span class="n">max</span><span class="o">,</span> <span class="n">mean</span><span class="o">)</span> <span class="k">=</span> <span class="n">ml</span><span class="o">.</span><span class="n">execute</span><span class="o">(</span><span class="n">minMaxMeanScript</span><span class="o">).</span><span class="n">getTuple</span><span class="o">[</span><span class="kt">Double</span>, <span class="kt">Double</span>, <span class="kt">Double</span><span class="o">](</span><span class="s">"minOut"</span><span class="o">,</span> <span class="s">"maxOut"</span><span class="o">,</span> <span class="s">"meanOut"</span><span class="o">)</span></code></pre></figure>

  </div>

<div data-lang="Spark Shell">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">minMaxMean</span> <span class="k">=</span>
     <span class="o">|</span> <span class="s">"""
     | minOut = min(Xin)
     | maxOut = max(Xin)
     | meanOut = mean(Xin)
     | """</span>
<span class="n">minMaxMean</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span>
<span class="s">"
minOut = min(Xin)
maxOut = max(Xin)
meanOut = mean(Xin)
"</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">mm</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">MatrixMetadata</span><span class="o">(</span><span class="n">numRows</span><span class="o">,</span> <span class="n">numCols</span><span class="o">)</span>
<span class="n">mm</span><span class="k">:</span> <span class="kt">org.apache.sysml.api.mlcontext.MatrixMetadata</span> <span class="o">=</span> <span class="n">rows</span><span class="k">:</span> <span class="err">10000</span><span class="o">,</span> <span class="n">columns</span><span class="k">:</span> <span class="err">1000</span><span class="o">,</span> <span class="n">non</span><span class="o">-</span><span class="n">zeros</span><span class="k">:</span> <span class="kt">None</span><span class="o">,</span> <span class="n">rows</span> <span class="n">per</span> <span class="n">block</span><span class="k">:</span> <span class="kt">None</span><span class="o">,</span> <span class="n">columns</span> <span class="n">per</span> <span class="n">block</span><span class="k">:</span> <span class="kt">None</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">minMaxMeanScript</span> <span class="k">=</span> <span class="n">dml</span><span class="o">(</span><span class="n">minMaxMean</span><span class="o">).</span><span class="n">in</span><span class="o">(</span><span class="s">"Xin"</span><span class="o">,</span> <span class="n">df</span><span class="o">,</span> <span class="n">mm</span><span class="o">).</span><span class="n">out</span><span class="o">(</span><span class="s">"minOut"</span><span class="o">,</span> <span class="s">"maxOut"</span><span class="o">,</span> <span class="s">"meanOut"</span><span class="o">)</span>
<span class="n">minMaxMeanScript</span><span class="k">:</span> <span class="kt">org.apache.sysml.api.mlcontext.Script</span> <span class="o">=</span>
<span class="nc">Inputs</span><span class="k">:</span>
  <span class="err">[1]</span> <span class="o">(</span><span class="kt">DataFrame</span><span class="o">)</span> <span class="kt">Xin:</span> <span class="err">[</span><span class="kt">C0:</span> <span class="kt">double</span><span class="o">,</span> <span class="n">C1</span><span class="k">:</span> <span class="kt">double</span><span class="o">,</span> <span class="n">C2</span><span class="k">:</span> <span class="kt">double</span><span class="o">,</span> <span class="n">C3</span><span class="k">:</span> <span class="kt">double</span><span class="o">,</span> <span class="n">C4</span><span class="k">:</span> <span class="kt">double</span><span class="o">,</span> <span class="n">C5</span><span class="k">:</span> <span class="kt">double</span><span class="o">,</span> <span class="n">C6</span><span class="k">:</span> <span class="kt">double</span><span class="o">,</span> <span class="n">C7</span><span class="k">:</span> <span class="kt">double</span><span class="o">,</span> <span class="o">...</span>

<span class="nc">Outputs</span><span class="k">:</span>
  <span class="err">[1]</span> <span class="kt">minOut</span>
  <span class="o">[</span><span class="err">2</span><span class="o">]</span> <span class="n">maxOut</span>
  <span class="o">[</span><span class="err">3</span><span class="o">]</span> <span class="n">meanOut</span>


<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="o">(</span><span class="n">min</span><span class="o">,</span> <span class="n">max</span><span class="o">,</span> <span class="n">mean</span><span class="o">)</span> <span class="k">=</span> <span class="n">ml</span><span class="o">.</span><span class="n">execute</span><span class="o">(</span><span class="n">minMaxMeanScript</span><span class="o">).</span><span class="n">getTuple</span><span class="o">[</span><span class="kt">Double</span>, <span class="kt">Double</span>, <span class="kt">Double</span><span class="o">](</span><span class="s">"minOut"</span><span class="o">,</span> <span class="s">"maxOut"</span><span class="o">,</span> <span class="s">"meanOut"</span><span class="o">)</span>
<span class="n">min</span><span class="k">:</span> <span class="kt">Double</span> <span class="o">=</span> <span class="mf">2.6257349849956313E-8</span>
<span class="n">max</span><span class="k">:</span> <span class="kt">Double</span> <span class="o">=</span> <span class="mf">0.9999999686609718</span>
<span class="n">mean</span><span class="k">:</span> <span class="kt">Double</span> <span class="o">=</span> <span class="mf">0.49996223966662934</span></code></pre></figure>

  </div>

</div>

<p>Many different types of input and output variables are automatically allowed. These types include
<code class="highlighter-rouge">Boolean</code>, <code class="highlighter-rouge">Long</code>, <code class="highlighter-rouge">Double</code>, <code class="highlighter-rouge">String</code>, <code class="highlighter-rouge">Array[Array[Double]]</code>, <code class="highlighter-rouge">RDD&lt;String&gt;</code> and <code class="highlighter-rouge">JavaRDD&lt;String&gt;</code>
in <code class="highlighter-rouge">CSV</code> (dense) and <code class="highlighter-rouge">IJV</code> (sparse) formats, <code class="highlighter-rouge">DataFrame</code>, <code class="highlighter-rouge">BinaryBlockMatrix</code>, <code class="highlighter-rouge">Matrix</code>, and
<code class="highlighter-rouge">Frame</code>. RDDs and JavaRDDs are assumed to be CSV format unless MatrixMetadata is supplied indicating
IJV format.</p>

<h2 id="rdd-example">RDD Example</h2>

<p>Let&#8217;s take a look at an example of input matrices as RDDs in CSV format. We&#8217;ll create two 2x2
matrices and input these into a DML script. This script will sum each matrix and create a message
based on which sum is greater. We will output the sums and the message.</p>

<p>For fun, we&#8217;ll write the script String to a file and then use ScriptFactory&#8217;s <code class="highlighter-rouge">dmlFromFile</code> method
to create the script object based on the file. We&#8217;ll also specify the inputs using a Map, although
we could have also chained together two <code class="highlighter-rouge">in</code> methods to specify the same inputs.</p>

<div class="codetabs">

<div data-lang="Scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">rdd1</span> <span class="k">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">parallelize</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span><span class="s">"1.0,2.0"</span><span class="o">,</span> <span class="s">"3.0,4.0"</span><span class="o">))</span>
<span class="k">val</span> <span class="n">rdd2</span> <span class="k">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">parallelize</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span><span class="s">"5.0,6.0"</span><span class="o">,</span> <span class="s">"7.0,8.0"</span><span class="o">))</span>
<span class="k">val</span> <span class="n">sums</span> <span class="k">=</span> <span class="s">"""
s1 = sum(m1);
s2 = sum(m2);
if (s1 &gt; s2) {
  message = "s1 is greater"
} else if (s2 &gt; s1) {
  message = "s2 is greater"
} else {
  message = "s1 and s2 are equal"
}
"""</span>
<span class="n">scala</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">nsc</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="nc">File</span><span class="o">(</span><span class="s">"sums.dml"</span><span class="o">).</span><span class="n">writeAll</span><span class="o">(</span><span class="n">sums</span><span class="o">)</span>
<span class="k">val</span> <span class="n">sumScript</span> <span class="k">=</span> <span class="n">dmlFromFile</span><span class="o">(</span><span class="s">"sums.dml"</span><span class="o">).</span><span class="n">in</span><span class="o">(</span><span class="nc">Map</span><span class="o">(</span><span class="s">"m1"</span><span class="o">-&gt;</span> <span class="n">rdd1</span><span class="o">,</span> <span class="s">"m2"</span><span class="o">-&gt;</span> <span class="n">rdd2</span><span class="o">)).</span><span class="n">out</span><span class="o">(</span><span class="s">"s1"</span><span class="o">,</span> <span class="s">"s2"</span><span class="o">,</span> <span class="s">"message"</span><span class="o">)</span>
<span class="k">val</span> <span class="n">sumResults</span> <span class="k">=</span> <span class="n">ml</span><span class="o">.</span><span class="n">execute</span><span class="o">(</span><span class="n">sumScript</span><span class="o">)</span>
<span class="k">val</span> <span class="n">s1</span> <span class="k">=</span> <span class="n">sumResults</span><span class="o">.</span><span class="n">getDouble</span><span class="o">(</span><span class="s">"s1"</span><span class="o">)</span>
<span class="k">val</span> <span class="n">s2</span> <span class="k">=</span> <span class="n">sumResults</span><span class="o">.</span><span class="n">getDouble</span><span class="o">(</span><span class="s">"s2"</span><span class="o">)</span>
<span class="k">val</span> <span class="n">message</span> <span class="k">=</span> <span class="n">sumResults</span><span class="o">.</span><span class="n">getString</span><span class="o">(</span><span class="s">"message"</span><span class="o">)</span></code></pre></figure>

  </div>

<div data-lang="Spark Shell">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">rdd1</span> <span class="k">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">parallelize</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span><span class="s">"1.0,2.0"</span><span class="o">,</span> <span class="s">"3.0,4.0"</span><span class="o">))</span>
<span class="n">rdd1</span><span class="k">:</span> <span class="kt">org.apache.spark.rdd.RDD</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="nc">ParallelCollectionRDD</span><span class="o">[</span><span class="err">42</span><span class="o">]</span> <span class="n">at</span> <span class="n">parallelize</span> <span class="n">at</span> <span class="o">&lt;</span><span class="n">console</span><span class="k">&gt;:</span><span class="mi">38</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">rdd2</span> <span class="k">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">parallelize</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span><span class="s">"5.0,6.0"</span><span class="o">,</span> <span class="s">"7.0,8.0"</span><span class="o">))</span>
<span class="n">rdd2</span><span class="k">:</span> <span class="kt">org.apache.spark.rdd.RDD</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="nc">ParallelCollectionRDD</span><span class="o">[</span><span class="err">43</span><span class="o">]</span> <span class="n">at</span> <span class="n">parallelize</span> <span class="n">at</span> <span class="o">&lt;</span><span class="n">console</span><span class="k">&gt;:</span><span class="mi">38</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">sums</span> <span class="k">=</span> <span class="s">"""
     | s1 = sum(m1);
     | s2 = sum(m2);
     | if (s1 &gt; s2) {
     |   message = "s1 is greater"
     | } else if (s2 &gt; s1) {
     |   message = "s2 is greater"
     | } else {
     |   message = "s1 and s2 are equal"
     | }
     | """</span>
<span class="n">sums</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span>
<span class="s">"
s1 = sum(m1);
s2 = sum(m2);
if (s1 &gt; s2) {
  message = "</span><span class="n">s1</span> <span class="n">is</span> <span class="n">greater</span><span class="s">"
} else if (s2 &gt; s1) {
  message = "</span><span class="n">s2</span> <span class="n">is</span> <span class="n">greater</span><span class="s">"
} else {
  message = "</span><span class="n">s1</span> <span class="n">and</span> <span class="n">s2</span> <span class="n">are</span> <span class="n">equal</span><span class="s">"
}
"</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="n">scala</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">nsc</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="nc">File</span><span class="o">(</span><span class="s">"sums.dml"</span><span class="o">).</span><span class="n">writeAll</span><span class="o">(</span><span class="n">sums</span><span class="o">)</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">sumScript</span> <span class="k">=</span> <span class="n">dmlFromFile</span><span class="o">(</span><span class="s">"sums.dml"</span><span class="o">).</span><span class="n">in</span><span class="o">(</span><span class="nc">Map</span><span class="o">(</span><span class="s">"m1"</span><span class="o">-&gt;</span> <span class="n">rdd1</span><span class="o">,</span> <span class="s">"m2"</span><span class="o">-&gt;</span> <span class="n">rdd2</span><span class="o">)).</span><span class="n">out</span><span class="o">(</span><span class="s">"s1"</span><span class="o">,</span> <span class="s">"s2"</span><span class="o">,</span> <span class="s">"message"</span><span class="o">)</span>
<span class="n">sumScript</span><span class="k">:</span> <span class="kt">org.apache.sysml.api.mlcontext.Script</span> <span class="o">=</span>
<span class="nc">Inputs</span><span class="k">:</span>
  <span class="err">[1]</span> <span class="o">(</span><span class="kt">RDD</span><span class="o">)</span> <span class="kt">m1:</span> <span class="kt">ParallelCollectionRDD</span><span class="o">[</span><span class="err">42</span><span class="o">]</span> <span class="n">at</span> <span class="n">parallelize</span> <span class="n">at</span> <span class="o">&lt;</span><span class="n">console</span><span class="k">&gt;:</span><span class="mi">38</span>
  <span class="o">[</span><span class="err">2</span><span class="o">]</span> <span class="o">(</span><span class="nc">RDD</span><span class="o">)</span> <span class="n">m2</span><span class="k">:</span> <span class="kt">ParallelCollectionRDD</span><span class="o">[</span><span class="err">43</span><span class="o">]</span> <span class="n">at</span> <span class="n">parallelize</span> <span class="n">at</span> <span class="o">&lt;</span><span class="n">console</span><span class="k">&gt;:</span><span class="mi">38</span>

<span class="nc">Outputs</span><span class="k">:</span>
  <span class="err">[1]</span> <span class="kt">s1</span>
  <span class="o">[</span><span class="err">2</span><span class="o">]</span> <span class="n">s2</span>
  <span class="o">[</span><span class="err">3</span><span class="o">]</span> <span class="n">message</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">sumResults</span> <span class="k">=</span> <span class="n">ml</span><span class="o">.</span><span class="n">execute</span><span class="o">(</span><span class="n">sumScript</span><span class="o">)</span>
<span class="n">sumResults</span><span class="k">:</span> <span class="kt">org.apache.sysml.api.mlcontext.MLResults</span> <span class="o">=</span>
  <span class="o">[</span><span class="err">1</span><span class="o">]</span> <span class="o">(</span><span class="nc">Double</span><span class="o">)</span> <span class="n">s1</span><span class="k">:</span> <span class="err">10</span><span class="kt">.</span><span class="err">0</span>
  <span class="err">[2]</span> <span class="o">(</span><span class="kt">Double</span><span class="o">)</span> <span class="kt">s2:</span> <span class="err">26</span><span class="kt">.</span><span class="err">0</span>
  <span class="err">[3]</span> <span class="o">(</span><span class="kt">String</span><span class="o">)</span> <span class="kt">message:</span> <span class="kt">s2</span> <span class="kt">is</span> <span class="kt">greater</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">s1</span> <span class="k">=</span> <span class="n">sumResults</span><span class="o">.</span><span class="n">getDouble</span><span class="o">(</span><span class="s">"s1"</span><span class="o">)</span>
<span class="n">s1</span><span class="k">:</span> <span class="kt">Double</span> <span class="o">=</span> <span class="mf">10.0</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">s2</span> <span class="k">=</span> <span class="n">sumResults</span><span class="o">.</span><span class="n">getDouble</span><span class="o">(</span><span class="s">"s2"</span><span class="o">)</span>
<span class="n">s2</span><span class="k">:</span> <span class="kt">Double</span> <span class="o">=</span> <span class="mf">26.0</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">message</span> <span class="k">=</span> <span class="n">sumResults</span><span class="o">.</span><span class="n">getString</span><span class="o">(</span><span class="s">"message"</span><span class="o">)</span>
<span class="n">message</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="n">s2</span> <span class="n">is</span> <span class="n">greater</span></code></pre></figure>

  </div>

</div>

<p>If you have metadata that you would like to supply along with the input matrices, this can be
accomplished using a Scala Seq, List, or Array.</p>

<div class="codetabs">

<div data-lang="Scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">rdd1Metadata</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">MatrixMetadata</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">2</span><span class="o">)</span>
<span class="k">val</span> <span class="n">rdd2Metadata</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">MatrixMetadata</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">2</span><span class="o">)</span>
<span class="k">val</span> <span class="n">sumScript</span> <span class="k">=</span> <span class="n">dmlFromFile</span><span class="o">(</span><span class="s">"sums.dml"</span><span class="o">).</span><span class="n">in</span><span class="o">(</span><span class="nc">Seq</span><span class="o">((</span><span class="s">"m1"</span><span class="o">,</span> <span class="n">rdd1</span><span class="o">,</span> <span class="n">rdd1Metadata</span><span class="o">),</span> <span class="o">(</span><span class="s">"m2"</span><span class="o">,</span> <span class="n">rdd2</span><span class="o">,</span> <span class="n">rdd2Metadata</span><span class="o">))).</span><span class="n">out</span><span class="o">(</span><span class="s">"s1"</span><span class="o">,</span> <span class="s">"s2"</span><span class="o">,</span> <span class="s">"message"</span><span class="o">)</span>
<span class="k">val</span> <span class="o">(</span><span class="n">firstSum</span><span class="o">,</span> <span class="n">secondSum</span><span class="o">,</span> <span class="n">sumMessage</span><span class="o">)</span> <span class="k">=</span> <span class="n">ml</span><span class="o">.</span><span class="n">execute</span><span class="o">(</span><span class="n">sumScript</span><span class="o">).</span><span class="n">getTuple</span><span class="o">[</span><span class="kt">Double</span>, <span class="kt">Double</span>, <span class="kt">String</span><span class="o">](</span><span class="s">"s1"</span><span class="o">,</span> <span class="s">"s2"</span><span class="o">,</span> <span class="s">"message"</span><span class="o">)</span></code></pre></figure>

  </div>

<div data-lang="Spark Shell">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">rdd1Metadata</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">MatrixMetadata</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">2</span><span class="o">)</span>
<span class="n">rdd1Metadata</span><span class="k">:</span> <span class="kt">org.apache.sysml.api.mlcontext.MatrixMetadata</span> <span class="o">=</span> <span class="n">rows</span><span class="k">:</span> <span class="err">2</span><span class="o">,</span> <span class="n">columns</span><span class="k">:</span> <span class="err">2</span><span class="o">,</span> <span class="n">non</span><span class="o">-</span><span class="n">zeros</span><span class="k">:</span> <span class="kt">None</span><span class="o">,</span> <span class="n">rows</span> <span class="n">per</span> <span class="n">block</span><span class="k">:</span> <span class="kt">None</span><span class="o">,</span> <span class="n">columns</span> <span class="n">per</span> <span class="n">block</span><span class="k">:</span> <span class="kt">None</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">rdd2Metadata</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">MatrixMetadata</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">2</span><span class="o">)</span>
<span class="n">rdd2Metadata</span><span class="k">:</span> <span class="kt">org.apache.sysml.api.mlcontext.MatrixMetadata</span> <span class="o">=</span> <span class="n">rows</span><span class="k">:</span> <span class="err">2</span><span class="o">,</span> <span class="n">columns</span><span class="k">:</span> <span class="err">2</span><span class="o">,</span> <span class="n">non</span><span class="o">-</span><span class="n">zeros</span><span class="k">:</span> <span class="kt">None</span><span class="o">,</span> <span class="n">rows</span> <span class="n">per</span> <span class="n">block</span><span class="k">:</span> <span class="kt">None</span><span class="o">,</span> <span class="n">columns</span> <span class="n">per</span> <span class="n">block</span><span class="k">:</span> <span class="kt">None</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">sumScript</span> <span class="k">=</span> <span class="n">dmlFromFile</span><span class="o">(</span><span class="s">"sums.dml"</span><span class="o">).</span><span class="n">in</span><span class="o">(</span><span class="nc">Seq</span><span class="o">((</span><span class="s">"m1"</span><span class="o">,</span> <span class="n">rdd1</span><span class="o">,</span> <span class="n">rdd1Metadata</span><span class="o">),</span> <span class="o">(</span><span class="s">"m2"</span><span class="o">,</span> <span class="n">rdd2</span><span class="o">,</span> <span class="n">rdd2Metadata</span><span class="o">))).</span><span class="n">out</span><span class="o">(</span><span class="s">"s1"</span><span class="o">,</span> <span class="s">"s2"</span><span class="o">,</span> <span class="s">"message"</span><span class="o">)</span>
<span class="n">sumScript</span><span class="k">:</span> <span class="kt">org.apache.sysml.api.mlcontext.Script</span> <span class="o">=</span>
<span class="nc">Inputs</span><span class="k">:</span>
  <span class="err">[1]</span> <span class="o">(</span><span class="kt">RDD</span><span class="o">)</span> <span class="kt">m1:</span> <span class="kt">ParallelCollectionRDD</span><span class="o">[</span><span class="err">42</span><span class="o">]</span> <span class="n">at</span> <span class="n">parallelize</span> <span class="n">at</span> <span class="o">&lt;</span><span class="n">console</span><span class="k">&gt;:</span><span class="mi">38</span>
  <span class="o">[</span><span class="err">2</span><span class="o">]</span> <span class="o">(</span><span class="nc">RDD</span><span class="o">)</span> <span class="n">m2</span><span class="k">:</span> <span class="kt">ParallelCollectionRDD</span><span class="o">[</span><span class="err">43</span><span class="o">]</span> <span class="n">at</span> <span class="n">parallelize</span> <span class="n">at</span> <span class="o">&lt;</span><span class="n">console</span><span class="k">&gt;:</span><span class="mi">38</span>

<span class="nc">Outputs</span><span class="k">:</span>
  <span class="err">[1]</span> <span class="kt">s1</span>
  <span class="o">[</span><span class="err">2</span><span class="o">]</span> <span class="n">s2</span>
  <span class="o">[</span><span class="err">3</span><span class="o">]</span> <span class="n">message</span>


<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="o">(</span><span class="n">firstSum</span><span class="o">,</span> <span class="n">secondSum</span><span class="o">,</span> <span class="n">sumMessage</span><span class="o">)</span> <span class="k">=</span> <span class="n">ml</span><span class="o">.</span><span class="n">execute</span><span class="o">(</span><span class="n">sumScript</span><span class="o">).</span><span class="n">getTuple</span><span class="o">[</span><span class="kt">Double</span>, <span class="kt">Double</span>, <span class="kt">String</span><span class="o">](</span><span class="s">"s1"</span><span class="o">,</span> <span class="s">"s2"</span><span class="o">,</span> <span class="s">"message"</span><span class="o">)</span>
<span class="n">firstSum</span><span class="k">:</span> <span class="kt">Double</span> <span class="o">=</span> <span class="mf">10.0</span>
<span class="n">secondSum</span><span class="k">:</span> <span class="kt">Double</span> <span class="o">=</span> <span class="mf">26.0</span>
<span class="n">sumMessage</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="n">s2</span> <span class="n">is</span> <span class="n">greater</span></code></pre></figure>

  </div>

</div>

<p>The same inputs with metadata can be supplied by chaining <code class="highlighter-rouge">in</code> methods, as in the example below, which shows that <code class="highlighter-rouge">out</code> methods can also be
chained.</p>

<div class="codetabs">

<div data-lang="Scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">sumScript</span> <span class="k">=</span> <span class="n">dmlFromFile</span><span class="o">(</span><span class="s">"sums.dml"</span><span class="o">).</span><span class="n">in</span><span class="o">(</span><span class="s">"m1"</span><span class="o">,</span> <span class="n">rdd1</span><span class="o">,</span> <span class="n">rdd1Metadata</span><span class="o">).</span><span class="n">in</span><span class="o">(</span><span class="s">"m2"</span><span class="o">,</span> <span class="n">rdd2</span><span class="o">,</span> <span class="n">rdd2Metadata</span><span class="o">).</span><span class="n">out</span><span class="o">(</span><span class="s">"s1"</span><span class="o">).</span><span class="n">out</span><span class="o">(</span><span class="s">"s2"</span><span class="o">).</span><span class="n">out</span><span class="o">(</span><span class="s">"message"</span><span class="o">)</span>
<span class="k">val</span> <span class="o">(</span><span class="n">firstSum</span><span class="o">,</span> <span class="n">secondSum</span><span class="o">,</span> <span class="n">sumMessage</span><span class="o">)</span> <span class="k">=</span> <span class="n">ml</span><span class="o">.</span><span class="n">execute</span><span class="o">(</span><span class="n">sumScript</span><span class="o">).</span><span class="n">getTuple</span><span class="o">[</span><span class="kt">Double</span>, <span class="kt">Double</span>, <span class="kt">String</span><span class="o">](</span><span class="s">"s1"</span><span class="o">,</span> <span class="s">"s2"</span><span class="o">,</span> <span class="s">"message"</span><span class="o">)</span></code></pre></figure>

  </div>

<div data-lang="Spark Shell">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">sumScript</span> <span class="k">=</span> <span class="n">dmlFromFile</span><span class="o">(</span><span class="s">"sums.dml"</span><span class="o">).</span><span class="n">in</span><span class="o">(</span><span class="s">"m1"</span><span class="o">,</span> <span class="n">rdd1</span><span class="o">,</span> <span class="n">rdd1Metadata</span><span class="o">).</span><span class="n">in</span><span class="o">(</span><span class="s">"m2"</span><span class="o">,</span> <span class="n">rdd2</span><span class="o">,</span> <span class="n">rdd2Metadata</span><span class="o">).</span><span class="n">out</span><span class="o">(</span><span class="s">"s1"</span><span class="o">).</span><span class="n">out</span><span class="o">(</span><span class="s">"s2"</span><span class="o">).</span><span class="n">out</span><span class="o">(</span><span class="s">"message"</span><span class="o">)</span>
<span class="n">sumScript</span><span class="k">:</span> <span class="kt">org.apache.sysml.api.mlcontext.Script</span> <span class="o">=</span>
<span class="nc">Inputs</span><span class="k">:</span>
  <span class="err">[1]</span> <span class="o">(</span><span class="kt">RDD</span><span class="o">)</span> <span class="kt">m1:</span> <span class="kt">ParallelCollectionRDD</span><span class="o">[</span><span class="err">42</span><span class="o">]</span> <span class="n">at</span> <span class="n">parallelize</span> <span class="n">at</span> <span class="o">&lt;</span><span class="n">console</span><span class="k">&gt;:</span><span class="mi">38</span>
  <span class="o">[</span><span class="err">2</span><span class="o">]</span> <span class="o">(</span><span class="nc">RDD</span><span class="o">)</span> <span class="n">m2</span><span class="k">:</span> <span class="kt">ParallelCollectionRDD</span><span class="o">[</span><span class="err">43</span><span class="o">]</span> <span class="n">at</span> <span class="n">parallelize</span> <span class="n">at</span> <span class="o">&lt;</span><span class="n">console</span><span class="k">&gt;:</span><span class="mi">38</span>

<span class="nc">Outputs</span><span class="k">:</span>
  <span class="err">[1]</span> <span class="kt">s1</span>
  <span class="o">[</span><span class="err">2</span><span class="o">]</span> <span class="n">s2</span>
  <span class="o">[</span><span class="err">3</span><span class="o">]</span> <span class="n">message</span>


<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="o">(</span><span class="n">firstSum</span><span class="o">,</span> <span class="n">secondSum</span><span class="o">,</span> <span class="n">sumMessage</span><span class="o">)</span> <span class="k">=</span> <span class="n">ml</span><span class="o">.</span><span class="n">execute</span><span class="o">(</span><span class="n">sumScript</span><span class="o">).</span><span class="n">getTuple</span><span class="o">[</span><span class="kt">Double</span>, <span class="kt">Double</span>, <span class="kt">String</span><span class="o">](</span><span class="s">"s1"</span><span class="o">,</span> <span class="s">"s2"</span><span class="o">,</span> <span class="s">"message"</span><span class="o">)</span>
<span class="n">firstSum</span><span class="k">:</span> <span class="kt">Double</span> <span class="o">=</span> <span class="mf">10.0</span>
<span class="n">secondSum</span><span class="k">:</span> <span class="kt">Double</span> <span class="o">=</span> <span class="mf">26.0</span>
<span class="n">sumMessage</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="n">s2</span> <span class="n">is</span> <span class="n">greater</span></code></pre></figure>

  </div>

</div>

<h2 id="matrix-output">Matrix Output</h2>

<p>Let&#8217;s look at an example of reading a matrix out of SystemML. We&#8217;ll create a DML script
in which we create a 2x2 matrix <code class="highlighter-rouge">m</code>. We&#8217;ll set the variable <code class="highlighter-rouge">n</code> to be the sum of the cells in the matrix.</p>

<p>We create a script object using String <code class="highlighter-rouge">s</code>, and we set <code class="highlighter-rouge">m</code> and <code class="highlighter-rouge">n</code> as the outputs. We execute the script, and in
the results we see we have Matrix <code class="highlighter-rouge">m</code> and Double <code class="highlighter-rouge">n</code>. The <code class="highlighter-rouge">n</code> output variable has a value of <code class="highlighter-rouge">110.0</code>.</p>

<p>We get Matrix <code class="highlighter-rouge">m</code> and Double <code class="highlighter-rouge">n</code> as a Tuple of values <code class="highlighter-rouge">x</code> and <code class="highlighter-rouge">y</code>. We then convert Matrix <code class="highlighter-rouge">m</code> to an
RDD of IJV values, an RDD of CSV values, a DataFrame, and a two-dimensional Double Array, and we display
the values in each of these data structures.</p>

<div class="codetabs">

<div data-lang="Scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">s</span> <span class="k">=</span>
<span class="s">"""
m = matrix("11 22 33 44", rows=2, cols=2)
n = sum(m)
"""</span>
<span class="k">val</span> <span class="n">scr</span> <span class="k">=</span> <span class="n">dml</span><span class="o">(</span><span class="n">s</span><span class="o">).</span><span class="n">out</span><span class="o">(</span><span class="s">"m"</span><span class="o">,</span> <span class="s">"n"</span><span class="o">);</span>
<span class="k">val</span> <span class="n">res</span> <span class="k">=</span> <span class="n">ml</span><span class="o">.</span><span class="n">execute</span><span class="o">(</span><span class="n">scr</span><span class="o">)</span>
<span class="k">val</span> <span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">)</span> <span class="k">=</span> <span class="n">res</span><span class="o">.</span><span class="n">getTuple</span><span class="o">[</span><span class="kt">Matrix</span>, <span class="kt">Double</span><span class="o">](</span><span class="s">"m"</span><span class="o">,</span> <span class="s">"n"</span><span class="o">)</span>
<span class="n">x</span><span class="o">.</span><span class="n">toRDDStringIJV</span><span class="o">.</span><span class="n">collect</span><span class="o">.</span><span class="n">foreach</span><span class="o">(</span><span class="n">println</span><span class="o">)</span>
<span class="n">x</span><span class="o">.</span><span class="n">toRDDStringCSV</span><span class="o">.</span><span class="n">collect</span><span class="o">.</span><span class="n">foreach</span><span class="o">(</span><span class="n">println</span><span class="o">)</span>
<span class="n">x</span><span class="o">.</span><span class="n">toDF</span><span class="o">.</span><span class="n">collect</span><span class="o">.</span><span class="n">foreach</span><span class="o">(</span><span class="n">println</span><span class="o">)</span>
<span class="n">x</span><span class="o">.</span><span class="n">to2DDoubleArray</span></code></pre></figure>

  </div>

<div data-lang="Spark Shell">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">s</span> <span class="k">=</span>
     <span class="o">|</span> <span class="s">"""
     | m = matrix("11 22 33 44", rows=2, cols=2)
     | n = sum(m)
     | """</span>
<span class="n">s</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span>
<span class="s">"
m = matrix("</span><span class="mi">11</span> <span class="mi">22</span> <span class="mi">33</span> <span class="mi">44</span><span class="s">", rows=2, cols=2)
n = sum(m)
"</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">scr</span> <span class="k">=</span> <span class="n">dml</span><span class="o">(</span><span class="n">s</span><span class="o">).</span><span class="n">out</span><span class="o">(</span><span class="s">"m"</span><span class="o">,</span> <span class="s">"n"</span><span class="o">);</span>
<span class="n">scr</span><span class="k">:</span> <span class="kt">org.apache.sysml.api.mlcontext.Script</span> <span class="o">=</span>
<span class="nc">Inputs</span><span class="k">:</span>
<span class="kt">None</span>

<span class="nc">Outputs</span><span class="k">:</span>
  <span class="err">[1]</span> <span class="kt">m</span>
  <span class="o">[</span><span class="err">2</span><span class="o">]</span> <span class="n">n</span>


<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">res</span> <span class="k">=</span> <span class="n">ml</span><span class="o">.</span><span class="n">execute</span><span class="o">(</span><span class="n">scr</span><span class="o">)</span>
<span class="n">res</span><span class="k">:</span> <span class="kt">org.apache.sysml.api.mlcontext.MLResults</span> <span class="o">=</span>
  <span class="o">[</span><span class="err">1</span><span class="o">]</span> <span class="o">(</span><span class="nc">Matrix</span><span class="o">)</span> <span class="n">m</span><span class="k">:</span> <span class="kt">Matrix:</span> <span class="kt">scratch_space</span><span class="c1">//_p12059_9.31.117.12//_t0/temp26_14, [2 x 2, nnz=4, blocks (1000 x 1000)], binaryblock, dirty
</span>  <span class="o">[</span><span class="err">2</span><span class="o">]</span> <span class="o">(</span><span class="nc">Double</span><span class="o">)</span> <span class="n">n</span><span class="k">:</span> <span class="err">110</span><span class="kt">.</span><span class="err">0</span>


<span class="kt">scala&gt;</span> <span class="kt">val</span> <span class="o">(</span><span class="kt">x</span><span class="o">,</span> <span class="kt">y</span><span class="o">)</span> <span class="k">=</span> <span class="n">res</span><span class="o">.</span><span class="n">getTuple</span><span class="o">[</span><span class="kt">Matrix</span>, <span class="kt">Double</span><span class="o">](</span><span class="s">"m"</span><span class="o">,</span> <span class="s">"n"</span><span class="o">)</span>
<span class="n">x</span><span class="k">:</span> <span class="kt">org.apache.sysml.api.mlcontext.Matrix</span> <span class="o">=</span> <span class="nc">Matrix</span><span class="k">:</span> <span class="kt">scratch_space</span><span class="c1">//_p12059_9.31.117.12//_t0/temp26_14, [2 x 2, nnz=4, blocks (1000 x 1000)], binaryblock, dirty
</span><span class="n">y</span><span class="k">:</span> <span class="kt">Double</span> <span class="o">=</span> <span class="mf">110.0</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="n">x</span><span class="o">.</span><span class="n">toRDDStringIJV</span><span class="o">.</span><span class="n">collect</span><span class="o">.</span><span class="n">foreach</span><span class="o">(</span><span class="n">println</span><span class="o">)</span>
<span class="mi">1</span> <span class="mi">1</span> <span class="mf">11.0</span>
<span class="mi">1</span> <span class="mi">2</span> <span class="mf">22.0</span>
<span class="mi">2</span> <span class="mi">1</span> <span class="mf">33.0</span>
<span class="mi">2</span> <span class="mi">2</span> <span class="mf">44.0</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="n">x</span><span class="o">.</span><span class="n">toRDDStringCSV</span><span class="o">.</span><span class="n">collect</span><span class="o">.</span><span class="n">foreach</span><span class="o">(</span><span class="n">println</span><span class="o">)</span>
<span class="mf">11.0</span><span class="o">,</span><span class="mf">22.0</span>
<span class="mf">33.0</span><span class="o">,</span><span class="mf">44.0</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="n">x</span><span class="o">.</span><span class="n">toDF</span><span class="o">.</span><span class="n">collect</span><span class="o">.</span><span class="n">foreach</span><span class="o">(</span><span class="n">println</span><span class="o">)</span>
<span class="o">[</span><span class="err">0</span><span class="kt">.</span><span class="err">0</span>,<span class="err">11</span><span class="kt">.</span><span class="err">0</span>,<span class="err">22</span><span class="kt">.</span><span class="err">0</span><span class="o">]</span>
<span class="o">[</span><span class="err">1</span><span class="kt">.</span><span class="err">0</span>,<span class="err">33</span><span class="kt">.</span><span class="err">0</span>,<span class="err">44</span><span class="kt">.</span><span class="err">0</span><span class="o">]</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="n">x</span><span class="o">.</span><span class="n">to2DDoubleArray</span>
<span class="n">res10</span><span class="k">:</span> <span class="kt">Array</span><span class="o">[</span><span class="kt">Array</span><span class="o">[</span><span class="kt">Double</span><span class="o">]]</span> <span class="k">=</span> <span class="nc">Array</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span><span class="mf">11.0</span><span class="o">,</span> <span class="mf">22.0</span><span class="o">),</span> <span class="nc">Array</span><span class="o">(</span><span class="mf">33.0</span><span class="o">,</span> <span class="mf">44.0</span><span class="o">))</span></code></pre></figure>

  </div>

</div>

<h2 id="univariate-statistics-on-haberman-data">Univariate Statistics on Haberman Data</h2>

<p>Our next example will involve Haberman&#8217;s Survival Data Set in CSV format from the Center for Machine Learning
and Intelligent Systems. We will run the SystemML Univariate Statistics (&#8220;Univar-Stats.dml&#8221;) script on this
data.</p>

<p>We&#8217;ll pull the data from a URL and convert it to an RDD, <code class="highlighter-rouge">habermanRDD</code>. Next, we&#8217;ll create metadata, <code class="highlighter-rouge">habermanMetadata</code>,
stating that the matrix consists of 306 rows and 4 columns.</p>

<p>As we can see from the comments in the script
<a href="https://raw.githubusercontent.com/apache/incubator-systemml/master/scripts/algorithms/Univar-Stats.dml">here</a>, the
script requires a &#8216;TYPES&#8217; input matrix that lists the types of the features (1 for scale, 2 for nominal, 3 for
ordinal), so we create a <code class="highlighter-rouge">typesRDD</code> matrix consisting of 1 row and 4 columns, with corresponding metadata, <code class="highlighter-rouge">typesMetadata</code>.</p>

<p>Next, we create the DML script object called <code class="highlighter-rouge">uni</code> using ScriptFactory&#8217;s <code class="highlighter-rouge">dmlFromUrl</code> method, specifying the GitHub URL where the
DML script is located. We bind the <code class="highlighter-rouge">habermanRDD</code> matrix to the <code class="highlighter-rouge">A</code> variable in <code class="highlighter-rouge">Univar-Stats.dml</code>, and we bind
the <code class="highlighter-rouge">typesRDD</code> matrix to the <code class="highlighter-rouge">K</code> variable. In addition, we supply a <code class="highlighter-rouge">$CONSOLE_OUTPUT</code> parameter with a Boolean value
of <code class="highlighter-rouge">true</code>, which indicates that we&#8217;d like to output labeled results to the console. We&#8217;ll explain why we bind to the <code class="highlighter-rouge">A</code> and <code class="highlighter-rouge">K</code>
variables in the <a href="spark-mlcontext-programming-guide.html#input-variables-vs-input-parameters">Input Variables vs Input Parameters</a>
section below.</p>

<div class="codetabs">

<div data-lang="Scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">habermanUrl</span> <span class="k">=</span> <span class="s">"http://archive.ics.uci.edu/ml/machine-learning-databases/haberman/haberman.data"</span>
<span class="k">val</span> <span class="n">habermanList</span> <span class="k">=</span> <span class="n">scala</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="nc">Source</span><span class="o">.</span><span class="n">fromURL</span><span class="o">(</span><span class="n">habermanUrl</span><span class="o">).</span><span class="n">mkString</span><span class="o">.</span><span class="n">split</span><span class="o">(</span><span class="s">"\n"</span><span class="o">)</span>
<span class="k">val</span> <span class="n">habermanRDD</span> <span class="k">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">parallelize</span><span class="o">(</span><span class="n">habermanList</span><span class="o">)</span>
<span class="k">val</span> <span class="n">habermanMetadata</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">MatrixMetadata</span><span class="o">(</span><span class="mi">306</span><span class="o">,</span> <span class="mi">4</span><span class="o">)</span>
<span class="k">val</span> <span class="n">typesRDD</span> <span class="k">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">parallelize</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span><span class="s">"1.0,1.0,1.0,2.0"</span><span class="o">))</span>
<span class="k">val</span> <span class="n">typesMetadata</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">MatrixMetadata</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">4</span><span class="o">)</span>
<span class="k">val</span> <span class="n">scriptUrl</span> <span class="k">=</span> <span class="s">"https://raw.githubusercontent.com/apache/incubator-systemml/master/scripts/algorithms/Univar-Stats.dml"</span>
<span class="k">val</span> <span class="n">uni</span> <span class="k">=</span> <span class="n">dmlFromUrl</span><span class="o">(</span><span class="n">scriptUrl</span><span class="o">).</span><span class="n">in</span><span class="o">(</span><span class="s">"A"</span><span class="o">,</span> <span class="n">habermanRDD</span><span class="o">,</span> <span class="n">habermanMetadata</span><span class="o">).</span><span class="n">in</span><span class="o">(</span><span class="s">"K"</span><span class="o">,</span> <span class="n">typesRDD</span><span class="o">,</span> <span class="n">typesMetadata</span><span class="o">).</span><span class="n">in</span><span class="o">(</span><span class="s">"$CONSOLE_OUTPUT"</span><span class="o">,</span> <span class="kc">true</span><span class="o">)</span>
<span class="n">ml</span><span class="o">.</span><span class="n">execute</span><span class="o">(</span><span class="n">uni</span><span class="o">)</span></code></pre></figure>

  </div>

<div data-lang="Spark Shell">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">habermanUrl</span> <span class="k">=</span> <span class="s">"http://archive.ics.uci.edu/ml/machine-learning-databases/haberman/haberman.data"</span>
<span class="n">habermanUrl</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="n">http</span><span class="o">://</span><span class="n">archive</span><span class="o">.</span><span class="n">ics</span><span class="o">.</span><span class="n">uci</span><span class="o">.</span><span class="n">edu</span><span class="o">/</span><span class="n">ml</span><span class="o">/</span><span class="n">machine</span><span class="o">-</span><span class="n">learning</span><span class="o">-</span><span class="n">databases</span><span class="o">/</span><span class="n">haberman</span><span class="o">/</span><span class="n">haberman</span><span class="o">.</span><span class="n">data</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">habermanList</span> <span class="k">=</span> <span class="n">scala</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="nc">Source</span><span class="o">.</span><span class="n">fromURL</span><span class="o">(</span><span class="n">habermanUrl</span><span class="o">).</span><span class="n">mkString</span><span class="o">.</span><span class="n">split</span><span class="o">(</span><span class="s">"\n"</span><span class="o">)</span>
<span class="n">habermanList</span><span class="k">:</span> <span class="kt">Array</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Array</span><span class="o">(</span><span class="mi">30</span><span class="o">,</span><span class="mi">64</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span> <span class="mi">30</span><span class="o">,</span><span class="mi">62</span><span class="o">,</span><span class="mi">3</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span> <span class="mi">30</span><span class="o">,</span><span class="mi">65</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span> <span class="mi">31</span><span class="o">,</span><span class="mi">59</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span> <span class="mi">31</span><span class="o">,</span><span class="mi">65</span><span class="o">,</span><span class="mi">4</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span> <span class="mi">33</span><span class="o">,</span><span class="mi">58</span><span class="o">,</span><span class="mi">10</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span> <span class="mi">33</span><span class="o">,</span><span class="mi">60</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span> <span class="mi">34</span><span class="o">,</span><span class="mi">59</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span> <span class="mi">34</span><span class="o">,</span><span class="mi">66</span><span class="o">,</span><span class="mi">9</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span> <span class="mi">34</span><span class="o">,</span><span class="mi">58</span><span class="o">,</span><span class="mi">30</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span> <span class="mi">34</span><span class="o">,</span><span class="mi">60</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span> <span class="mi">34</span><span class="o">,</span><span class="mi">61</span><span class="o">,</span><span class="mi">10</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span> <span class="mi">34</span><span class="o">,</span><span class="mi">67</span><span class="o">,</span><span class="mi">7</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span> <span class="mi">34</span><span class="o">,</span><span class="mi">60</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span> <span class="mi">35</span><span class="o">,</span><span class="mi">64</span><span class="o">,</span><span class="mi">13</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span> <span class="mi">35</span><span class="o">,</span><span class="mi">63</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span> <span class="mi">36</span><span class="o">,</span><span class="mi">60</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span> <span class="mi">36</span><span class="o">,</span><span class="mi">69</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span> <span class="mi">37</span><span class="o">,</span><span class="mi">60</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span> <span class="mi">37</span><span class="o">,</span><span class="mi">63</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span> <span class="mi">37</span><span class="o">,</span><span class="mi">58</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span> <span class="mi">37</span><span class="o">,</span><span class="mi">59</span><span class="o">,</span><span class="mi">6</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span> <span class="mi">37</span><span class="o">,</span><span class="mi">60</span><span class="o">,</span><span class="mi">15</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span> <span class="mi">37</span><span class="o">,</span><span class="mi">63</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span> <span class="mi">38</span><span class="o">,</span><span class="mi">69</span><span class="o">,</span><span class="mi">21</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span> <span class="mi">38</span><span class="o">,</span><span class="mi">59</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span> <span class="mi">38</span><span class="o">,</span><span class="mi">60</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span> <span class="mi">38</span><span class="o">,</span><span class="mi">60</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span> <span class="mi">38</span><span class="o">,</span><span class="mi">62</span><span class="o">,</span><span class="mi">3</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span> <span class="mi">38</span><span class="o">,</span><span class="mi">64</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span> <span class="mi">38</span><span class="o">,</span><span class="mi">66</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span> <span class="mi">38</span><span class="o">,</span><span class="mi">66</span><span class="o">,</span><span class="mi">11</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span> <span class="mi">38</span><span class="o">,</span><span class="mi">60</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span> <span class="mi">38</span><span class="o">,</span><span class="mi">67</span><span class="o">,</span><span class="mi">5</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span> <span class="mi">39</span><span class="o">,</span><span class="mi">66</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span> <span class="mi">39</span><span class="o">,</span><span class="mi">63</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span> <span class="mi">39</span><span class="o">,</span><span class="mi">67</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span> <span class="mi">39</span><span class="o">,</span><span class="mi">58</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span> <span class="mi">39</span><span class="o">,</span><span class="mi">59</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span> <span class="mi">39</span><span class="o">,</span><span class="mi">63</span><span class="o">,</span><span class="mi">4</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span> <span class="mi">40</span><span class="o">,</span><span class="mi">58</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span> <span class="mi">40</span><span class="o">,</span><span class="mi">58</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span> <span class="mi">40</span><span class="o">,</span><span class="mi">65</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span> <span class="mi">41</span><span class="o">,</span><span class="mi">60</span><span class="o">,</span><span class="mi">23</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span> <span class="mi">41</span><span class="o">,</span><span class="mi">64</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span> <span class="mi">41</span><span class="o">,</span><span class="mi">67</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span> <span class="mi">41</span><span class="o">,</span><span class="mi">58</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span> <span class="mi">41</span><span class="o">,</span><span class="mi">59</span><span class="o">,</span><span class="mi">8</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span> <span class="mi">41</span><span class="o">,</span><span class="mi">59</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span> <span class="mi">41</span><span class="o">,</span><span class="mi">64</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span> <span class="mi">41</span><span class="o">,</span><span class="mi">69</span><span class="o">,</span><span class="mi">8</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span> <span class="mi">41</span><span class="o">,</span><span class="mi">65</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span> <span class="mi">41</span><span class="o">,</span><span class="mi">65</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span> <span class="mi">42</span><span class="o">,</span><span class="mi">69</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span> <span class="mi">42</span><span class="o">,</span><span class="mi">59</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span> <span class="mi">42</span><span class="o">,</span><span class="mi">58</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span> <span class="mi">42</span><span class="o">,</span><span class="mi">60</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span> <span class="mi">42</span><span class="o">,</span><span class="mi">59</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span> <span class="mi">42</span><span class="o">,</span><span class="mi">61</span><span class="o">,</span><span class="mi">4</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span> <span class="mi">42</span><span class="o">,</span><span class="mi">62</span><span class="o">,</span><span class="mi">20</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span> <span class="mi">42</span><span class="o">,</span><span class="mi">65</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span> <span class="mi">42</span><span class="o">,</span><span class="mi">63</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span> <span class="mi">43</span><span class="o">,</span><span class="mi">58</span><span class="o">,</span><span class="mi">52</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span> <span class="mi">43</span><span class="o">,</span><span class="mi">59</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span> <span class="mi">43</span><span class="o">,</span><span class="mi">64</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span> <span class="mi">43</span><span class="o">,</span><span class="mi">64</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span> <span class="mi">43</span><span class="o">,</span><span class="mi">63</span><span class="o">,</span><span class="mi">14</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span> <span class="mi">43</span><span class="o">,</span><span class="mi">64</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span> <span class="mf">43.</span><span class="o">..</span>
<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">habermanRDD</span> <span class="k">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">parallelize</span><span class="o">(</span><span class="n">habermanList</span><span class="o">)</span>
<span class="n">habermanRDD</span><span class="k">:</span> <span class="kt">org.apache.spark.rdd.RDD</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="nc">ParallelCollectionRDD</span><span class="o">[</span><span class="err">159</span><span class="o">]</span> <span class="n">at</span> <span class="n">parallelize</span> <span class="n">at</span> <span class="o">&lt;</span><span class="n">console</span><span class="k">&gt;:</span><span class="mi">43</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">habermanMetadata</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">MatrixMetadata</span><span class="o">(</span><span class="mi">306</span><span class="o">,</span> <span class="mi">4</span><span class="o">)</span>
<span class="n">habermanMetadata</span><span class="k">:</span> <span class="kt">org.apache.sysml.api.mlcontext.MatrixMetadata</span> <span class="o">=</span> <span class="n">rows</span><span class="k">:</span> <span class="err">306</span><span class="o">,</span> <span class="n">columns</span><span class="k">:</span> <span class="err">4</span><span class="o">,</span> <span class="n">non</span><span class="o">-</span><span class="n">zeros</span><span class="k">:</span> <span class="kt">None</span><span class="o">,</span> <span class="n">rows</span> <span class="n">per</span> <span class="n">block</span><span class="k">:</span> <span class="kt">None</span><span class="o">,</span> <span class="n">columns</span> <span class="n">per</span> <span class="n">block</span><span class="k">:</span> <span class="kt">None</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">typesRDD</span> <span class="k">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">parallelize</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span><span class="s">"1.0,1.0,1.0,2.0"</span><span class="o">))</span>
<span class="n">typesRDD</span><span class="k">:</span> <span class="kt">org.apache.spark.rdd.RDD</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="nc">ParallelCollectionRDD</span><span class="o">[</span><span class="err">160</span><span class="o">]</span> <span class="n">at</span> <span class="n">parallelize</span> <span class="n">at</span> <span class="o">&lt;</span><span class="n">console</span><span class="k">&gt;:</span><span class="mi">39</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">typesMetadata</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">MatrixMetadata</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">4</span><span class="o">)</span>
<span class="n">typesMetadata</span><span class="k">:</span> <span class="kt">org.apache.sysml.api.mlcontext.MatrixMetadata</span> <span class="o">=</span> <span class="n">rows</span><span class="k">:</span> <span class="err">1</span><span class="o">,</span> <span class="n">columns</span><span class="k">:</span> <span class="err">4</span><span class="o">,</span> <span class="n">non</span><span class="o">-</span><span class="n">zeros</span><span class="k">:</span> <span class="kt">None</span><span class="o">,</span> <span class="n">rows</span> <span class="n">per</span> <span class="n">block</span><span class="k">:</span> <span class="kt">None</span><span class="o">,</span> <span class="n">columns</span> <span class="n">per</span> <span class="n">block</span><span class="k">:</span> <span class="kt">None</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">scriptUrl</span> <span class="k">=</span> <span class="s">"https://raw.githubusercontent.com/apache/incubator-systemml/master/scripts/algorithms/Univar-Stats.dml"</span>
<span class="n">scriptUrl</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="n">https</span><span class="o">://</span><span class="n">raw</span><span class="o">.</span><span class="n">githubusercontent</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">apache</span><span class="o">/</span><span class="n">incubator</span><span class="o">-</span><span class="n">systemml</span><span class="o">/</span><span class="n">master</span><span class="o">/</span><span class="n">scripts</span><span class="o">/</span><span class="n">algorithms</span><span class="o">/</span><span class="nc">Univar</span><span class="o">-</span><span class="nc">Stats</span><span class="o">.</span><span class="n">dml</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">uni</span> <span class="k">=</span> <span class="n">dmlFromUrl</span><span class="o">(</span><span class="n">scriptUrl</span><span class="o">).</span><span class="n">in</span><span class="o">(</span><span class="s">"A"</span><span class="o">,</span> <span class="n">habermanRDD</span><span class="o">,</span> <span class="n">habermanMetadata</span><span class="o">).</span><span class="n">in</span><span class="o">(</span><span class="s">"K"</span><span class="o">,</span> <span class="n">typesRDD</span><span class="o">,</span> <span class="n">typesMetadata</span><span class="o">).</span><span class="n">in</span><span class="o">(</span><span class="s">"$CONSOLE_OUTPUT"</span><span class="o">,</span> <span class="kc">true</span><span class="o">)</span>
<span class="n">uni</span><span class="k">:</span> <span class="kt">org.apache.sysml.api.mlcontext.Script</span> <span class="o">=</span>
<span class="nc">Inputs</span><span class="k">:</span>
  <span class="err">[1]</span> <span class="o">(</span><span class="kt">RDD</span><span class="o">)</span> <span class="kt">A:</span> <span class="kt">ParallelCollectionRDD</span><span class="o">[</span><span class="err">159</span><span class="o">]</span> <span class="n">at</span> <span class="n">parallelize</span> <span class="n">at</span> <span class="o">&lt;</span><span class="n">console</span><span class="k">&gt;:</span><span class="mi">43</span>
  <span class="o">[</span><span class="err">2</span><span class="o">]</span> <span class="o">(</span><span class="nc">RDD</span><span class="o">)</span> <span class="n">K</span><span class="k">:</span> <span class="kt">ParallelCollectionRDD</span><span class="o">[</span><span class="err">160</span><span class="o">]</span> <span class="n">at</span> <span class="n">parallelize</span> <span class="n">at</span> <span class="o">&lt;</span><span class="n">console</span><span class="k">&gt;:</span><span class="mi">39</span>
  <span class="o">[</span><span class="err">3</span><span class="o">]</span> <span class="o">(</span><span class="nc">Boolean</span><span class="o">)</span> <span class="nc">$CONSOLE_OUTPUT</span><span class="k">:</span> <span class="kt">true</span>

<span class="nc">Outputs</span><span class="k">:</span>
<span class="kt">None</span>


<span class="n">scala</span><span class="o">&gt;</span> <span class="n">ml</span><span class="o">.</span><span class="n">execute</span><span class="o">(</span><span class="n">uni</span><span class="o">)</span>
<span class="o">...</span>
<span class="o">-------------------------------------------------</span>
<span class="nc">Feature</span> <span class="o">[</span><span class="err">1</span><span class="o">]</span><span class="k">:</span> <span class="kt">Scale</span>
 <span class="o">(</span><span class="mi">01</span><span class="o">)</span> <span class="nc">Minimum</span>             <span class="o">|</span> <span class="mf">30.0</span>
 <span class="o">(</span><span class="mi">02</span><span class="o">)</span> <span class="nc">Maximum</span>             <span class="o">|</span> <span class="mf">83.0</span>
 <span class="o">(</span><span class="mi">03</span><span class="o">)</span> <span class="nc">Range</span>               <span class="o">|</span> <span class="mf">53.0</span>
 <span class="o">(</span><span class="mi">04</span><span class="o">)</span> <span class="nc">Mean</span>                <span class="o">|</span> <span class="mf">52.45751633986928</span>
 <span class="o">(</span><span class="mi">05</span><span class="o">)</span> <span class="nc">Variance</span>            <span class="o">|</span> <span class="mf">116.71458266366658</span>
 <span class="o">(</span><span class="mi">06</span><span class="o">)</span> <span class="nc">Std</span> <span class="n">deviation</span>       <span class="o">|</span> <span class="mf">10.803452349303281</span>
 <span class="o">(</span><span class="mi">07</span><span class="o">)</span> <span class="nc">Std</span> <span class="n">err</span> <span class="n">of</span> <span class="n">mean</span>     <span class="o">|</span> <span class="mf">0.6175922641866753</span>
 <span class="o">(</span><span class="mi">08</span><span class="o">)</span> <span class="nc">Coeff</span> <span class="n">of</span> <span class="n">variation</span>  <span class="o">|</span> <span class="mf">0.20594669940735139</span>
 <span class="o">(</span><span class="mi">09</span><span class="o">)</span> <span class="nc">Skewness</span>            <span class="o">|</span> <span class="mf">0.1450718616532357</span>
 <span class="o">(</span><span class="mi">10</span><span class="o">)</span> <span class="nc">Kurtosis</span>            <span class="o">|</span> <span class="o">-</span><span class="mf">0.6150152487211726</span>
 <span class="o">(</span><span class="mi">11</span><span class="o">)</span> <span class="nc">Std</span> <span class="n">err</span> <span class="n">of</span> <span class="n">skewness</span> <span class="o">|</span> <span class="mf">0.13934809593495995</span>
 <span class="o">(</span><span class="mi">12</span><span class="o">)</span> <span class="nc">Std</span> <span class="n">err</span> <span class="n">of</span> <span class="n">kurtosis</span> <span class="o">|</span> <span class="mf">0.277810485320835</span>
 <span class="o">(</span><span class="mi">13</span><span class="o">)</span> <span class="nc">Median</span>              <span class="o">|</span> <span class="mf">52.0</span>
 <span class="o">(</span><span class="mi">14</span><span class="o">)</span> <span class="nc">Interquartile</span> <span class="n">mean</span>  <span class="o">|</span> <span class="mf">52.16013071895425</span>
<span class="o">-------------------------------------------------</span>
<span class="nc">Feature</span> <span class="o">[</span><span class="err">2</span><span class="o">]</span><span class="k">:</span> <span class="kt">Scale</span>
 <span class="o">(</span><span class="mi">01</span><span class="o">)</span> <span class="nc">Minimum</span>             <span class="o">|</span> <span class="mf">58.0</span>
 <span class="o">(</span><span class="mi">02</span><span class="o">)</span> <span class="nc">Maximum</span>             <span class="o">|</span> <span class="mf">69.0</span>
 <span class="o">(</span><span class="mi">03</span><span class="o">)</span> <span class="nc">Range</span>               <span class="o">|</span> <span class="mf">11.0</span>
 <span class="o">(</span><span class="mi">04</span><span class="o">)</span> <span class="nc">Mean</span>                <span class="o">|</span> <span class="mf">62.85294117647059</span>
 <span class="o">(</span><span class="mi">05</span><span class="o">)</span> <span class="nc">Variance</span>            <span class="o">|</span> <span class="mf">10.558630665380907</span>
 <span class="o">(</span><span class="mi">06</span><span class="o">)</span> <span class="nc">Std</span> <span class="n">deviation</span>       <span class="o">|</span> <span class="mf">3.2494046632238507</span>
 <span class="o">(</span><span class="mi">07</span><span class="o">)</span> <span class="nc">Std</span> <span class="n">err</span> <span class="n">of</span> <span class="n">mean</span>     <span class="o">|</span> <span class="mf">0.18575610076612029</span>
 <span class="o">(</span><span class="mi">08</span><span class="o">)</span> <span class="nc">Coeff</span> <span class="n">of</span> <span class="n">variation</span>  <span class="o">|</span> <span class="mf">0.051698529971741194</span>
 <span class="o">(</span><span class="mi">09</span><span class="o">)</span> <span class="nc">Skewness</span>            <span class="o">|</span> <span class="mf">0.07798443581479181</span>
 <span class="o">(</span><span class="mi">10</span><span class="o">)</span> <span class="nc">Kurtosis</span>            <span class="o">|</span> <span class="o">-</span><span class="mf">1.1324380182967442</span>
 <span class="o">(</span><span class="mi">11</span><span class="o">)</span> <span class="nc">Std</span> <span class="n">err</span> <span class="n">of</span> <span class="n">skewness</span> <span class="o">|</span> <span class="mf">0.13934809593495995</span>
 <span class="o">(</span><span class="mi">12</span><span class="o">)</span> <span class="nc">Std</span> <span class="n">err</span> <span class="n">of</span> <span class="n">kurtosis</span> <span class="o">|</span> <span class="mf">0.277810485320835</span>
 <span class="o">(</span><span class="mi">13</span><span class="o">)</span> <span class="nc">Median</span>              <span class="o">|</span> <span class="mf">63.0</span>
 <span class="o">(</span><span class="mi">14</span><span class="o">)</span> <span class="nc">Interquartile</span> <span class="n">mean</span>  <span class="o">|</span> <span class="mf">62.80392156862745</span>
<span class="o">-------------------------------------------------</span>
<span class="nc">Feature</span> <span class="o">[</span><span class="err">3</span><span class="o">]</span><span class="k">:</span> <span class="kt">Scale</span>
 <span class="o">(</span><span class="mi">01</span><span class="o">)</span> <span class="nc">Minimum</span>             <span class="o">|</span> <span class="mf">0.0</span>
 <span class="o">(</span><span class="mi">02</span><span class="o">)</span> <span class="nc">Maximum</span>             <span class="o">|</span> <span class="mf">52.0</span>
 <span class="o">(</span><span class="mi">03</span><span class="o">)</span> <span class="nc">Range</span>               <span class="o">|</span> <span class="mf">52.0</span>
 <span class="o">(</span><span class="mi">04</span><span class="o">)</span> <span class="nc">Mean</span>                <span class="o">|</span> <span class="mf">4.026143790849673</span>
 <span class="o">(</span><span class="mi">05</span><span class="o">)</span> <span class="nc">Variance</span>            <span class="o">|</span> <span class="mf">51.691117539912135</span>
 <span class="o">(</span><span class="mi">06</span><span class="o">)</span> <span class="nc">Std</span> <span class="n">deviation</span>       <span class="o">|</span> <span class="mf">7.189653506248555</span>
 <span class="o">(</span><span class="mi">07</span><span class="o">)</span> <span class="nc">Std</span> <span class="n">err</span> <span class="n">of</span> <span class="n">mean</span>     <span class="o">|</span> <span class="mf">0.41100513466216837</span>
 <span class="o">(</span><span class="mi">08</span><span class="o">)</span> <span class="nc">Coeff</span> <span class="n">of</span> <span class="n">variation</span>  <span class="o">|</span> <span class="mf">1.7857418611299172</span>
 <span class="o">(</span><span class="mi">09</span><span class="o">)</span> <span class="nc">Skewness</span>            <span class="o">|</span> <span class="mf">2.954633471088322</span>
 <span class="o">(</span><span class="mi">10</span><span class="o">)</span> <span class="nc">Kurtosis</span>            <span class="o">|</span> <span class="mf">11.425776549251449</span>
 <span class="o">(</span><span class="mi">11</span><span class="o">)</span> <span class="nc">Std</span> <span class="n">err</span> <span class="n">of</span> <span class="n">skewness</span> <span class="o">|</span> <span class="mf">0.13934809593495995</span>
 <span class="o">(</span><span class="mi">12</span><span class="o">)</span> <span class="nc">Std</span> <span class="n">err</span> <span class="n">of</span> <span class="n">kurtosis</span> <span class="o">|</span> <span class="mf">0.277810485320835</span>
 <span class="o">(</span><span class="mi">13</span><span class="o">)</span> <span class="nc">Median</span>              <span class="o">|</span> <span class="mf">1.0</span>
 <span class="o">(</span><span class="mi">14</span><span class="o">)</span> <span class="nc">Interquartile</span> <span class="n">mean</span>  <span class="o">|</span> <span class="mf">1.2483660130718954</span>
<span class="o">-------------------------------------------------</span>
<span class="nc">Feature</span> <span class="o">[</span><span class="err">4</span><span class="o">]</span><span class="k">:</span> <span class="kt">Categorical</span> <span class="o">(</span><span class="kt">Nominal</span><span class="o">)</span>
 <span class="o">(</span><span class="err">15</span><span class="o">)</span> <span class="kt">Num</span> <span class="kt">of</span> <span class="kt">categories</span>   <span class="kt">|</span> <span class="err">2</span>
 <span class="o">(</span><span class="err">16</span><span class="o">)</span> <span class="kt">Mode</span>                <span class="kt">|</span> <span class="err">1</span>
 <span class="o">(</span><span class="err">17</span><span class="o">)</span> <span class="kt">Num</span> <span class="kt">of</span> <span class="kt">modes</span>        <span class="kt">|</span> <span class="err">1</span>
<span class="kt">res23:</span> <span class="kt">org.apache.sysml.api.mlcontext.MLResults</span> <span class="o">=</span>
<span class="nc">None</span></code></pre></figure>

  </div>

</div>

<p>Alternatively, we could supply a <code class="highlighter-rouge">java.net.URL</code> to the Script <code class="highlighter-rouge">in</code> method. Note that if the URL matrix data is in IJV
format, metadata needs to be supplied for the matrix.</p>

<div class="codetabs">

<div data-lang="Scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">habermanUrl</span> <span class="k">=</span> <span class="s">"http://archive.ics.uci.edu/ml/machine-learning-databases/haberman/haberman.data"</span>
<span class="k">val</span> <span class="n">typesRDD</span> <span class="k">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">parallelize</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span><span class="s">"1.0,1.0,1.0,2.0"</span><span class="o">))</span>
<span class="k">val</span> <span class="n">scriptUrl</span> <span class="k">=</span> <span class="s">"https://raw.githubusercontent.com/apache/incubator-systemml/master/scripts/algorithms/Univar-Stats.dml"</span>
<span class="k">val</span> <span class="n">uni</span> <span class="k">=</span> <span class="n">dmlFromUrl</span><span class="o">(</span><span class="n">scriptUrl</span><span class="o">).</span><span class="n">in</span><span class="o">(</span><span class="s">"A"</span><span class="o">,</span> <span class="k">new</span> <span class="n">java</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="nc">URL</span><span class="o">(</span><span class="n">habermanUrl</span><span class="o">)).</span><span class="n">in</span><span class="o">(</span><span class="s">"K"</span><span class="o">,</span> <span class="n">typesRDD</span><span class="o">).</span><span class="n">in</span><span class="o">(</span><span class="s">"$CONSOLE_OUTPUT"</span><span class="o">,</span> <span class="kc">true</span><span class="o">)</span>
<span class="n">ml</span><span class="o">.</span><span class="n">execute</span><span class="o">(</span><span class="n">uni</span><span class="o">)</span></code></pre></figure>

  </div>

<div data-lang="Spark Shell">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">habermanUrl</span> <span class="k">=</span> <span class="s">"http://archive.ics.uci.edu/ml/machine-learning-databases/haberman/haberman.data"</span>
<span class="n">habermanUrl</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="n">http</span><span class="o">://</span><span class="n">archive</span><span class="o">.</span><span class="n">ics</span><span class="o">.</span><span class="n">uci</span><span class="o">.</span><span class="n">edu</span><span class="o">/</span><span class="n">ml</span><span class="o">/</span><span class="n">machine</span><span class="o">-</span><span class="n">learning</span><span class="o">-</span><span class="n">databases</span><span class="o">/</span><span class="n">haberman</span><span class="o">/</span><span class="n">haberman</span><span class="o">.</span><span class="n">data</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">typesRDD</span> <span class="k">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">parallelize</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span><span class="s">"1.0,1.0,1.0,2.0"</span><span class="o">))</span>
<span class="n">typesRDD</span><span class="k">:</span> <span class="kt">org.apache.spark.rdd.RDD</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="nc">ParallelCollectionRDD</span><span class="o">[</span><span class="err">50</span><span class="o">]</span> <span class="n">at</span> <span class="n">parallelize</span> <span class="n">at</span> <span class="o">&lt;</span><span class="n">console</span><span class="k">&gt;:</span><span class="mi">33</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">scriptUrl</span> <span class="k">=</span> <span class="s">"https://raw.githubusercontent.com/apache/incubator-systemml/master/scripts/algorithms/Univar-Stats.dml"</span>
<span class="n">scriptUrl</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="n">https</span><span class="o">://</span><span class="n">raw</span><span class="o">.</span><span class="n">githubusercontent</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">apache</span><span class="o">/</span><span class="n">incubator</span><span class="o">-</span><span class="n">systemml</span><span class="o">/</span><span class="n">master</span><span class="o">/</span><span class="n">scripts</span><span class="o">/</span><span class="n">algorithms</span><span class="o">/</span><span class="nc">Univar</span><span class="o">-</span><span class="nc">Stats</span><span class="o">.</span><span class="n">dml</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">uni</span> <span class="k">=</span> <span class="n">dmlFromUrl</span><span class="o">(</span><span class="n">scriptUrl</span><span class="o">).</span><span class="n">in</span><span class="o">(</span><span class="s">"A"</span><span class="o">,</span> <span class="k">new</span> <span class="n">java</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="nc">URL</span><span class="o">(</span><span class="n">habermanUrl</span><span class="o">)).</span><span class="n">in</span><span class="o">(</span><span class="s">"K"</span><span class="o">,</span> <span class="n">typesRDD</span><span class="o">).</span><span class="n">in</span><span class="o">(</span><span class="s">"$CONSOLE_OUTPUT"</span><span class="o">,</span> <span class="kc">true</span><span class="o">)</span>
<span class="n">uni</span><span class="k">:</span> <span class="kt">org.apache.sysml.api.mlcontext.Script</span> <span class="o">=</span>
<span class="nc">Inputs</span><span class="k">:</span>
  <span class="err">[1]</span> <span class="o">(</span><span class="kt">URL</span><span class="o">)</span> <span class="kt">A:</span> <span class="kt">http://archive.ics.uci.edu/ml/machine-learning-databases/haberman/haberman.data</span>
  <span class="o">[</span><span class="err">2</span><span class="o">]</span> <span class="o">(</span><span class="nc">RDD</span><span class="o">)</span> <span class="n">K</span><span class="k">:</span> <span class="kt">ParallelCollectionRDD</span><span class="o">[</span><span class="err">50</span><span class="o">]</span> <span class="n">at</span> <span class="n">parallelize</span> <span class="n">at</span> <span class="o">&lt;</span><span class="n">console</span><span class="k">&gt;:</span><span class="mi">33</span>
  <span class="o">[</span><span class="err">3</span><span class="o">]</span> <span class="o">(</span><span class="nc">Boolean</span><span class="o">)</span> <span class="nc">$CONSOLE_OUTPUT</span><span class="k">:</span> <span class="kt">true</span>

<span class="nc">Outputs</span><span class="k">:</span>
<span class="kt">None</span>


<span class="n">scala</span><span class="o">&gt;</span> <span class="n">ml</span><span class="o">.</span><span class="n">execute</span><span class="o">(</span><span class="n">uni</span><span class="o">)</span>
<span class="o">...</span>
<span class="o">-------------------------------------------------</span>
 <span class="o">(</span><span class="mi">01</span><span class="o">)</span> <span class="nc">Minimum</span>             <span class="o">|</span> <span class="mf">30.0</span>
 <span class="o">(</span><span class="mi">02</span><span class="o">)</span> <span class="nc">Maximum</span>             <span class="o">|</span> <span class="mf">83.0</span>
 <span class="o">(</span><span class="mi">03</span><span class="o">)</span> <span class="nc">Range</span>               <span class="o">|</span> <span class="mf">53.0</span>
 <span class="o">(</span><span class="mi">04</span><span class="o">)</span> <span class="nc">Mean</span>                <span class="o">|</span> <span class="mf">52.45751633986928</span>
 <span class="o">(</span><span class="mi">05</span><span class="o">)</span> <span class="nc">Variance</span>            <span class="o">|</span> <span class="mf">116.71458266366658</span>
 <span class="o">(</span><span class="mi">06</span><span class="o">)</span> <span class="nc">Std</span> <span class="n">deviation</span>       <span class="o">|</span> <span class="mf">10.803452349303281</span>
 <span class="o">(</span><span class="mi">07</span><span class="o">)</span> <span class="nc">Std</span> <span class="n">err</span> <span class="n">of</span> <span class="n">mean</span>     <span class="o">|</span> <span class="mf">0.6175922641866753</span>
 <span class="o">(</span><span class="mi">08</span><span class="o">)</span> <span class="nc">Coeff</span> <span class="n">of</span> <span class="n">variation</span>  <span class="o">|</span> <span class="mf">0.20594669940735139</span>
 <span class="o">(</span><span class="mi">09</span><span class="o">)</span> <span class="nc">Skewness</span>            <span class="o">|</span> <span class="mf">0.1450718616532357</span>
 <span class="o">(</span><span class="mi">10</span><span class="o">)</span> <span class="nc">Kurtosis</span>            <span class="o">|</span> <span class="o">-</span><span class="mf">0.6150152487211726</span>
 <span class="o">(</span><span class="mi">11</span><span class="o">)</span> <span class="nc">Std</span> <span class="n">err</span> <span class="n">of</span> <span class="n">skewness</span> <span class="o">|</span> <span class="mf">0.13934809593495995</span>
 <span class="o">(</span><span class="mi">12</span><span class="o">)</span> <span class="nc">Std</span> <span class="n">err</span> <span class="n">of</span> <span class="n">kurtosis</span> <span class="o">|</span> <span class="mf">0.277810485320835</span>
 <span class="o">(</span><span class="mi">13</span><span class="o">)</span> <span class="nc">Median</span>              <span class="o">|</span> <span class="mf">52.0</span>
 <span class="o">(</span><span class="mi">14</span><span class="o">)</span> <span class="nc">Interquartile</span> <span class="n">mean</span>  <span class="o">|</span> <span class="mf">52.16013071895425</span>
<span class="nc">Feature</span> <span class="o">[</span><span class="err">1</span><span class="o">]</span><span class="k">:</span> <span class="kt">Scale</span>
<span class="o">-------------------------------------------------</span>
 <span class="o">(</span><span class="mi">01</span><span class="o">)</span> <span class="nc">Minimum</span>             <span class="o">|</span> <span class="mf">58.0</span>
 <span class="o">(</span><span class="mi">02</span><span class="o">)</span> <span class="nc">Maximum</span>             <span class="o">|</span> <span class="mf">69.0</span>
 <span class="o">(</span><span class="mi">03</span><span class="o">)</span> <span class="nc">Range</span>               <span class="o">|</span> <span class="mf">11.0</span>
 <span class="o">(</span><span class="mi">04</span><span class="o">)</span> <span class="nc">Mean</span>                <span class="o">|</span> <span class="mf">62.85294117647059</span>
 <span class="o">(</span><span class="mi">05</span><span class="o">)</span> <span class="nc">Variance</span>            <span class="o">|</span> <span class="mf">10.558630665380907</span>
 <span class="o">(</span><span class="mi">06</span><span class="o">)</span> <span class="nc">Std</span> <span class="n">deviation</span>       <span class="o">|</span> <span class="mf">3.2494046632238507</span>
 <span class="o">(</span><span class="mi">07</span><span class="o">)</span> <span class="nc">Std</span> <span class="n">err</span> <span class="n">of</span> <span class="n">mean</span>     <span class="o">|</span> <span class="mf">0.18575610076612029</span>
 <span class="o">(</span><span class="mi">08</span><span class="o">)</span> <span class="nc">Coeff</span> <span class="n">of</span> <span class="n">variation</span>  <span class="o">|</span> <span class="mf">0.051698529971741194</span>
 <span class="o">(</span><span class="mi">09</span><span class="o">)</span> <span class="nc">Skewness</span>            <span class="o">|</span> <span class="mf">0.07798443581479181</span>
 <span class="o">(</span><span class="mi">10</span><span class="o">)</span> <span class="nc">Kurtosis</span>            <span class="o">|</span> <span class="o">-</span><span class="mf">1.1324380182967442</span>
 <span class="o">(</span><span class="mi">11</span><span class="o">)</span> <span class="nc">Std</span> <span class="n">err</span> <span class="n">of</span> <span class="n">skewness</span> <span class="o">|</span> <span class="mf">0.13934809593495995</span>
 <span class="o">(</span><span class="mi">12</span><span class="o">)</span> <span class="nc">Std</span> <span class="n">err</span> <span class="n">of</span> <span class="n">kurtosis</span> <span class="o">|</span> <span class="mf">0.277810485320835</span>
 <span class="o">(</span><span class="mi">13</span><span class="o">)</span> <span class="nc">Median</span>              <span class="o">|</span> <span class="mf">63.0</span>
 <span class="o">(</span><span class="mi">14</span><span class="o">)</span> <span class="nc">Interquartile</span> <span class="n">mean</span>  <span class="o">|</span> <span class="mf">62.80392156862745</span>
<span class="nc">Feature</span> <span class="o">[</span><span class="err">2</span><span class="o">]</span><span class="k">:</span> <span class="kt">Scale</span>
<span class="o">-------------------------------------------------</span>
 <span class="o">(</span><span class="mi">01</span><span class="o">)</span> <span class="nc">Minimum</span>             <span class="o">|</span> <span class="mf">0.0</span>
 <span class="o">(</span><span class="mi">02</span><span class="o">)</span> <span class="nc">Maximum</span>             <span class="o">|</span> <span class="mf">52.0</span>
 <span class="o">(</span><span class="mi">03</span><span class="o">)</span> <span class="nc">Range</span>               <span class="o">|</span> <span class="mf">52.0</span>
 <span class="o">(</span><span class="mi">04</span><span class="o">)</span> <span class="nc">Mean</span>                <span class="o">|</span> <span class="mf">4.026143790849673</span>
 <span class="o">(</span><span class="mi">05</span><span class="o">)</span> <span class="nc">Variance</span>            <span class="o">|</span> <span class="mf">51.691117539912135</span>
 <span class="o">(</span><span class="mi">06</span><span class="o">)</span> <span class="nc">Std</span> <span class="n">deviation</span>       <span class="o">|</span> <span class="mf">7.189653506248555</span>
 <span class="o">(</span><span class="mi">07</span><span class="o">)</span> <span class="nc">Std</span> <span class="n">err</span> <span class="n">of</span> <span class="n">mean</span>     <span class="o">|</span> <span class="mf">0.41100513466216837</span>
 <span class="o">(</span><span class="mi">08</span><span class="o">)</span> <span class="nc">Coeff</span> <span class="n">of</span> <span class="n">variation</span>  <span class="o">|</span> <span class="mf">1.7857418611299172</span>
 <span class="o">(</span><span class="mi">09</span><span class="o">)</span> <span class="nc">Skewness</span>            <span class="o">|</span> <span class="mf">2.954633471088322</span>
 <span class="o">(</span><span class="mi">10</span><span class="o">)</span> <span class="nc">Kurtosis</span>            <span class="o">|</span> <span class="mf">11.425776549251449</span>
 <span class="o">(</span><span class="mi">11</span><span class="o">)</span> <span class="nc">Std</span> <span class="n">err</span> <span class="n">of</span> <span class="n">skewness</span> <span class="o">|</span> <span class="mf">0.13934809593495995</span>
 <span class="o">(</span><span class="mi">12</span><span class="o">)</span> <span class="nc">Std</span> <span class="n">err</span> <span class="n">of</span> <span class="n">kurtosis</span> <span class="o">|</span> <span class="mf">0.277810485320835</span>
 <span class="o">(</span><span class="mi">13</span><span class="o">)</span> <span class="nc">Median</span>              <span class="o">|</span> <span class="mf">1.0</span>
 <span class="o">(</span><span class="mi">14</span><span class="o">)</span> <span class="nc">Interquartile</span> <span class="n">mean</span>  <span class="o">|</span> <span class="mf">1.2483660130718954</span>
<span class="nc">Feature</span> <span class="o">[</span><span class="err">3</span><span class="o">]</span><span class="k">:</span> <span class="kt">Scale</span>
<span class="o">-------------------------------------------------</span>
<span class="nc">Feature</span> <span class="o">[</span><span class="err">4</span><span class="o">]</span><span class="k">:</span> <span class="kt">Categorical</span> <span class="o">(</span><span class="kt">Nominal</span><span class="o">)</span>
 <span class="o">(</span><span class="err">15</span><span class="o">)</span> <span class="kt">Num</span> <span class="kt">of</span> <span class="kt">categories</span>   <span class="kt">|</span> <span class="err">2</span>
 <span class="o">(</span><span class="err">16</span><span class="o">)</span> <span class="kt">Mode</span>                <span class="kt">|</span> <span class="err">1</span>
 <span class="o">(</span><span class="err">17</span><span class="o">)</span> <span class="kt">Num</span> <span class="kt">of</span> <span class="kt">modes</span>        <span class="kt">|</span> <span class="err">1</span>
<span class="kt">res5:</span> <span class="kt">org.apache.sysml.api.mlcontext.MLResults</span> <span class="o">=</span>
<span class="nc">None</span></code></pre></figure>

  </div>

</div>

<h3 id="input-variables-vs-input-parameters">Input Variables vs Input Parameters</h3>

<p>If we examine the
<a href="https://raw.githubusercontent.com/apache/incubator-systemml/master/scripts/algorithms/Univar-Stats.dml"><code class="highlighter-rouge">Univar-Stats.dml</code></a>
file, we see in the comments that it can take 4 input
parameters, <code class="highlighter-rouge">$X</code>, <code class="highlighter-rouge">$TYPES</code>, <code class="highlighter-rouge">$CONSOLE_OUTPUT</code>, and <code class="highlighter-rouge">$STATS</code>. Input parameters are typically useful when
executing SystemML in Standalone mode, Spark batch mode, or Hadoop batch mode. For example, <code class="highlighter-rouge">$X</code> specifies
the location in the file system where the input data matrix is located, <code class="highlighter-rouge">$TYPES</code> specifies the location in the file system
where the input types matrix is located, <code class="highlighter-rouge">$CONSOLE_OUTPUT</code> specifies whether or not labeled statistics should be
output to the console, and <code class="highlighter-rouge">$STATS</code> specifies the location in the file system where the output matrix should be written.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="k">...</span>
<span class="c1"># INPUT PARAMETERS:
# -------------------------------------------------------------------------------------------------
# NAME           TYPE     DEFAULT  MEANING
# -------------------------------------------------------------------------------------------------
# X              String   ---      Location of INPUT data matrix
# TYPES          String   ---      Location of INPUT matrix that lists the types of the features:
#                                     1 for scale, 2 for nominal, 3 for ordinal
# CONSOLE_OUTPUT Boolean  FALSE    If TRUE, print summary statistics to console
# STATS          String   ---      Location of OUTPUT matrix with summary statistics computed for
#                                  all features (17 statistics - 14 scale, 3 categorical)
# -------------------------------------------------------------------------------------------------
# OUTPUT: Matrix of summary statistics
</span><span class="k">...</span>
<span class="n">consoleOutput</span> <span class="o">=</span> <span class="n">ifdef</span><span class="p">(</span><span class="o">$</span><span class="n">CONSOLE_OUTPUT</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">);</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="o">$</span><span class="n">X</span><span class="p">);</span> <span class="c1"># data file
</span><span class="n">K</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="o">$</span><span class="n">TYPES</span><span class="p">);</span> <span class="c1"># attribute kind file
</span><span class="k">...</span>
<span class="n">write</span><span class="p">(</span><span class="n">baseStats</span><span class="p">,</span> <span class="o">$</span><span class="n">STATS</span><span class="p">);</span>
<span class="k">...</span></code></pre></figure>

<p>Because MLContext is a programmatic interface, it offers more flexibility. You can still use input parameters
and files in the file system, such as this example that specifies file paths to the input matrices and the output matrix:</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">script</span> <span class="k">=</span> <span class="n">dmlFromFile</span><span class="o">(</span><span class="s">"scripts/algorithms/Univar-Stats.dml"</span><span class="o">).</span><span class="n">in</span><span class="o">(</span><span class="s">"$X"</span><span class="o">,</span> <span class="s">"data/haberman.data"</span><span class="o">).</span><span class="n">in</span><span class="o">(</span><span class="s">"$TYPES"</span><span class="o">,</span> <span class="s">"data/types.csv"</span><span class="o">).</span><span class="n">in</span><span class="o">(</span><span class="s">"$STATS"</span><span class="o">,</span> <span class="s">"data/univarOut.mtx"</span><span class="o">).</span><span class="n">in</span><span class="o">(</span><span class="s">"$CONSOLE_OUTPUT"</span><span class="o">,</span> <span class="kc">true</span><span class="o">)</span>
<span class="n">ml</span><span class="o">.</span><span class="n">execute</span><span class="o">(</span><span class="n">script</span><span class="o">)</span></code></pre></figure>

<p>Using the MLContext API, rather than relying solely on input parameters, we can bind to the variables associated
with the <code class="highlighter-rouge">read</code> and <code class="highlighter-rouge">write</code> statements. In the fragment of <code class="highlighter-rouge">Univar-Stats.dml</code> above, notice that the matrix at
path <code class="highlighter-rouge">$X</code> is read to variable <code class="highlighter-rouge">A</code>, <code class="highlighter-rouge">$TYPES</code> is read to variable
<code class="highlighter-rouge">K</code>, and <code class="highlighter-rouge">baseStats</code> is written to path <code class="highlighter-rouge">$STATS</code>. Therefore, we can bind the Haberman input data matrix to the <code class="highlighter-rouge">A</code> variable,
the input types matrix to the <code class="highlighter-rouge">K</code> variable, and the output matrix to the <code class="highlighter-rouge">baseStats</code> variable.</p>

<div class="codetabs">

<div data-lang="Scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">uni</span> <span class="k">=</span> <span class="n">dmlFromUrl</span><span class="o">(</span><span class="n">scriptUrl</span><span class="o">).</span><span class="n">in</span><span class="o">(</span><span class="s">"A"</span><span class="o">,</span> <span class="n">habermanRDD</span><span class="o">,</span> <span class="n">habermanMetadata</span><span class="o">).</span><span class="n">in</span><span class="o">(</span><span class="s">"K"</span><span class="o">,</span> <span class="n">typesRDD</span><span class="o">,</span> <span class="n">typesMetadata</span><span class="o">).</span><span class="n">out</span><span class="o">(</span><span class="s">"baseStats"</span><span class="o">)</span>
<span class="k">val</span> <span class="n">baseStats</span> <span class="k">=</span> <span class="n">ml</span><span class="o">.</span><span class="n">execute</span><span class="o">(</span><span class="n">uni</span><span class="o">).</span><span class="n">getMatrix</span><span class="o">(</span><span class="s">"baseStats"</span><span class="o">)</span>
<span class="n">baseStats</span><span class="o">.</span><span class="n">toRDDStringIJV</span><span class="o">.</span><span class="n">collect</span><span class="o">.</span><span class="n">slice</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span><span class="mi">9</span><span class="o">).</span><span class="n">foreach</span><span class="o">(</span><span class="n">println</span><span class="o">)</span></code></pre></figure>

  </div>

<div data-lang="Spark Shell">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">uni</span> <span class="k">=</span> <span class="n">dmlFromUrl</span><span class="o">(</span><span class="n">scriptUrl</span><span class="o">).</span><span class="n">in</span><span class="o">(</span><span class="s">"A"</span><span class="o">,</span> <span class="n">habermanRDD</span><span class="o">,</span> <span class="n">habermanMetadata</span><span class="o">).</span><span class="n">in</span><span class="o">(</span><span class="s">"K"</span><span class="o">,</span> <span class="n">typesRDD</span><span class="o">,</span> <span class="n">typesMetadata</span><span class="o">).</span><span class="n">out</span><span class="o">(</span><span class="s">"baseStats"</span><span class="o">)</span>
<span class="n">uni</span><span class="k">:</span> <span class="kt">org.apache.sysml.api.mlcontext.Script</span> <span class="o">=</span>
<span class="nc">Inputs</span><span class="k">:</span>
  <span class="err">[1]</span> <span class="o">(</span><span class="kt">RDD</span><span class="o">)</span> <span class="kt">A:</span> <span class="kt">ParallelCollectionRDD</span><span class="o">[</span><span class="err">159</span><span class="o">]</span> <span class="n">at</span> <span class="n">parallelize</span> <span class="n">at</span> <span class="o">&lt;</span><span class="n">console</span><span class="k">&gt;:</span><span class="mi">43</span>
  <span class="o">[</span><span class="err">2</span><span class="o">]</span> <span class="o">(</span><span class="nc">RDD</span><span class="o">)</span> <span class="n">K</span><span class="k">:</span> <span class="kt">ParallelCollectionRDD</span><span class="o">[</span><span class="err">160</span><span class="o">]</span> <span class="n">at</span> <span class="n">parallelize</span> <span class="n">at</span> <span class="o">&lt;</span><span class="n">console</span><span class="k">&gt;:</span><span class="mi">39</span>

<span class="nc">Outputs</span><span class="k">:</span>
  <span class="err">[1]</span> <span class="kt">baseStats</span>


<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">baseStats</span> <span class="k">=</span> <span class="n">ml</span><span class="o">.</span><span class="n">execute</span><span class="o">(</span><span class="n">uni</span><span class="o">).</span><span class="n">getMatrix</span><span class="o">(</span><span class="s">"baseStats"</span><span class="o">)</span>
<span class="o">...</span>
<span class="n">baseStats</span><span class="k">:</span> <span class="kt">org.apache.sysml.api.mlcontext.Matrix</span> <span class="o">=</span> <span class="nc">Matrix</span><span class="k">:</span> <span class="kt">scratch_space/</span><span class="k">_</span><span class="kt">p12059_9.</span><span class="err">31</span><span class="kt">.</span><span class="err">117</span><span class="kt">.</span><span class="err">12</span><span class="kt">/parfor/</span><span class="err">4</span><span class="k">_</span><span class="kt">resultmerge1</span><span class="o">,</span> <span class="o">[</span><span class="err">17</span> <span class="kt">x</span> <span class="err">4</span>, <span class="kt">nnz=</span><span class="err">44</span>, <span class="kt">blocks</span> <span class="o">(</span><span class="err">1000</span> <span class="kt">x</span> <span class="err">1000</span><span class="o">)],</span> <span class="n">binaryblock</span><span class="o">,</span> <span class="n">dirty</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="n">baseStats</span><span class="o">.</span><span class="n">toRDDStringIJV</span><span class="o">.</span><span class="n">collect</span><span class="o">.</span><span class="n">slice</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span><span class="mi">9</span><span class="o">).</span><span class="n">foreach</span><span class="o">(</span><span class="n">println</span><span class="o">)</span>
<span class="mi">1</span> <span class="mi">1</span> <span class="mf">30.0</span>
<span class="mi">1</span> <span class="mi">2</span> <span class="mf">58.0</span>
<span class="mi">1</span> <span class="mi">3</span> <span class="mf">0.0</span>
<span class="mi">1</span> <span class="mi">4</span> <span class="mf">0.0</span>
<span class="mi">2</span> <span class="mi">1</span> <span class="mf">83.0</span>
<span class="mi">2</span> <span class="mi">2</span> <span class="mf">69.0</span>
<span class="mi">2</span> <span class="mi">3</span> <span class="mf">52.0</span>
<span class="mi">2</span> <span class="mi">4</span> <span class="mf">0.0</span>
<span class="mi">3</span> <span class="mi">1</span> <span class="mf">53.0</span></code></pre></figure>

  </div>

</div>

<h2 id="script-information">Script Information</h2>

<p>The <code class="highlighter-rouge">info</code> method on a Script object can provide useful information about a DML or PyDML script, such as
the inputs, output, symbol table, script string, and the script execution string that is passed to the internals of
SystemML.</p>

<div class="codetabs">

<div data-lang="Scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">minMaxMean</span> <span class="k">=</span>
<span class="s">"""
minOut = min(Xin)
maxOut = max(Xin)
meanOut = mean(Xin)
"""</span>
<span class="k">val</span> <span class="n">minMaxMeanScript</span> <span class="k">=</span> <span class="n">dml</span><span class="o">(</span><span class="n">minMaxMean</span><span class="o">).</span><span class="n">in</span><span class="o">(</span><span class="s">"Xin"</span><span class="o">,</span> <span class="n">df</span><span class="o">,</span> <span class="n">mm</span><span class="o">).</span><span class="n">out</span><span class="o">(</span><span class="s">"minOut"</span><span class="o">,</span> <span class="s">"maxOut"</span><span class="o">,</span> <span class="s">"meanOut"</span><span class="o">)</span>
<span class="k">val</span> <span class="o">(</span><span class="n">min</span><span class="o">,</span> <span class="n">max</span><span class="o">,</span> <span class="n">mean</span><span class="o">)</span> <span class="k">=</span> <span class="n">ml</span><span class="o">.</span><span class="n">execute</span><span class="o">(</span><span class="n">minMaxMeanScript</span><span class="o">).</span><span class="n">getTuple</span><span class="o">[</span><span class="kt">Double</span>, <span class="kt">Double</span>, <span class="kt">Double</span><span class="o">](</span><span class="s">"minOut"</span><span class="o">,</span> <span class="s">"maxOut"</span><span class="o">,</span> <span class="s">"meanOut"</span><span class="o">)</span>
<span class="n">println</span><span class="o">(</span><span class="n">minMaxMeanScript</span><span class="o">.</span><span class="n">info</span><span class="o">)</span></code></pre></figure>

  </div>

<div data-lang="Spark Shell">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">minMaxMean</span> <span class="k">=</span>
     <span class="o">|</span> <span class="s">"""
     | minOut = min(Xin)
     | maxOut = max(Xin)
     | meanOut = mean(Xin)
     | """</span>
<span class="n">minMaxMean</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span>
<span class="s">"
minOut = min(Xin)
maxOut = max(Xin)
meanOut = mean(Xin)
"</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">minMaxMeanScript</span> <span class="k">=</span> <span class="n">dml</span><span class="o">(</span><span class="n">minMaxMean</span><span class="o">).</span><span class="n">in</span><span class="o">(</span><span class="s">"Xin"</span><span class="o">,</span> <span class="n">df</span><span class="o">,</span> <span class="n">mm</span><span class="o">).</span><span class="n">out</span><span class="o">(</span><span class="s">"minOut"</span><span class="o">,</span> <span class="s">"maxOut"</span><span class="o">,</span> <span class="s">"meanOut"</span><span class="o">)</span>
<span class="n">minMaxMeanScript</span><span class="k">:</span> <span class="kt">org.apache.sysml.api.mlcontext.Script</span> <span class="o">=</span>
<span class="nc">Inputs</span><span class="k">:</span>
  <span class="err">[1]</span> <span class="o">(</span><span class="kt">DataFrame</span><span class="o">)</span> <span class="kt">Xin:</span> <span class="err">[</span><span class="kt">C0:</span> <span class="kt">double</span><span class="o">,</span> <span class="n">C1</span><span class="k">:</span> <span class="kt">double</span><span class="o">,</span> <span class="n">C2</span><span class="k">:</span> <span class="kt">double</span><span class="o">,</span> <span class="n">C3</span><span class="k">:</span> <span class="kt">double</span><span class="o">,</span> <span class="n">C4</span><span class="k">:</span> <span class="kt">double</span><span class="o">,</span> <span class="n">C5</span><span class="k">:</span> <span class="kt">double</span><span class="o">,</span> <span class="n">C6</span><span class="k">:</span> <span class="kt">double</span><span class="o">,</span> <span class="n">C7</span><span class="k">:</span> <span class="kt">double</span><span class="o">,</span> <span class="o">...</span>

<span class="nc">Outputs</span><span class="k">:</span>
  <span class="err">[1]</span> <span class="kt">minOut</span>
  <span class="o">[</span><span class="err">2</span><span class="o">]</span> <span class="n">maxOut</span>
  <span class="o">[</span><span class="err">3</span><span class="o">]</span> <span class="n">meanOut</span>


<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="o">(</span><span class="n">min</span><span class="o">,</span> <span class="n">max</span><span class="o">,</span> <span class="n">mean</span><span class="o">)</span> <span class="k">=</span> <span class="n">ml</span><span class="o">.</span><span class="n">execute</span><span class="o">(</span><span class="n">minMaxMeanScript</span><span class="o">).</span><span class="n">getTuple</span><span class="o">[</span><span class="kt">Double</span>, <span class="kt">Double</span>, <span class="kt">Double</span><span class="o">](</span><span class="s">"minOut"</span><span class="o">,</span> <span class="s">"maxOut"</span><span class="o">,</span> <span class="s">"meanOut"</span><span class="o">)</span>
<span class="n">min</span><span class="k">:</span> <span class="kt">Double</span> <span class="o">=</span> <span class="mf">1.4149740823476975E-7</span>
<span class="n">max</span><span class="k">:</span> <span class="kt">Double</span> <span class="o">=</span> <span class="mf">0.9999999956646207</span>
<span class="n">mean</span><span class="k">:</span> <span class="kt">Double</span> <span class="o">=</span> <span class="mf">0.5000954668004209</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="n">println</span><span class="o">(</span><span class="n">minMaxMeanScript</span><span class="o">.</span><span class="n">info</span><span class="o">)</span>
<span class="nc">Script</span> <span class="nc">Type</span><span class="k">:</span> <span class="kt">DML</span>

<span class="nc">Inputs</span><span class="k">:</span>
  <span class="err">[1]</span> <span class="o">(</span><span class="kt">DataFrame</span><span class="o">)</span> <span class="kt">Xin:</span> <span class="err">[</span><span class="kt">C0:</span> <span class="kt">double</span><span class="o">,</span> <span class="n">C1</span><span class="k">:</span> <span class="kt">double</span><span class="o">,</span> <span class="n">C2</span><span class="k">:</span> <span class="kt">double</span><span class="o">,</span> <span class="n">C3</span><span class="k">:</span> <span class="kt">double</span><span class="o">,</span> <span class="n">C4</span><span class="k">:</span> <span class="kt">double</span><span class="o">,</span> <span class="n">C5</span><span class="k">:</span> <span class="kt">double</span><span class="o">,</span> <span class="n">C6</span><span class="k">:</span> <span class="kt">double</span><span class="o">,</span> <span class="n">C7</span><span class="k">:</span> <span class="kt">double</span><span class="o">,</span> <span class="o">...</span>

<span class="nc">Outputs</span><span class="k">:</span>
  <span class="err">[1]</span> <span class="o">(</span><span class="kt">Double</span><span class="o">)</span> <span class="kt">minOut:</span> <span class="err">1</span><span class="kt">.</span><span class="err">4149740823476975</span><span class="kt">E-</span><span class="err">7</span>
  <span class="err">[2]</span> <span class="o">(</span><span class="kt">Double</span><span class="o">)</span> <span class="kt">maxOut:</span> <span class="err">0</span><span class="kt">.</span><span class="err">9999999956646207</span>
  <span class="err">[3]</span> <span class="o">(</span><span class="kt">Double</span><span class="o">)</span> <span class="kt">meanOut:</span> <span class="err">0</span><span class="kt">.</span><span class="err">5000954668004209</span>

<span class="kt">Input</span> <span class="kt">Parameters:</span>
<span class="kt">None</span>

<span class="nc">Input</span> <span class="nc">Variables</span><span class="k">:</span>
  <span class="err">[1]</span> <span class="kt">Xin</span>

<span class="nc">Output</span> <span class="nc">Variables</span><span class="k">:</span>
  <span class="err">[1]</span> <span class="kt">minOut</span>
  <span class="o">[</span><span class="err">2</span><span class="o">]</span> <span class="n">maxOut</span>
  <span class="o">[</span><span class="err">3</span><span class="o">]</span> <span class="n">meanOut</span>

<span class="nc">Symbol</span> <span class="nc">Table</span><span class="k">:</span>
  <span class="err">[1]</span> <span class="o">(</span><span class="kt">Double</span><span class="o">)</span> <span class="kt">meanOut:</span> <span class="err">0</span><span class="kt">.</span><span class="err">5000954668004209</span>
  <span class="err">[2]</span> <span class="o">(</span><span class="kt">Double</span><span class="o">)</span> <span class="kt">maxOut:</span> <span class="err">0</span><span class="kt">.</span><span class="err">9999999956646207</span>
  <span class="err">[3]</span> <span class="o">(</span><span class="kt">Double</span><span class="o">)</span> <span class="kt">minOut:</span> <span class="err">1</span><span class="kt">.</span><span class="err">4149740823476975</span><span class="kt">E-</span><span class="err">7</span>
  <span class="err">[4]</span> <span class="o">(</span><span class="kt">Matrix</span><span class="o">)</span> <span class="kt">Xin:</span> <span class="kt">Matrix:</span> <span class="kt">scratch_space/temp_1166464711339222</span><span class="o">,</span> <span class="o">[</span><span class="err">10000</span> <span class="kt">x</span> <span class="err">1000</span>, <span class="kt">nnz=</span><span class="err">10000000</span>, <span class="kt">blocks</span> <span class="o">(</span><span class="err">1000</span> <span class="kt">x</span> <span class="err">1000</span><span class="o">)],</span> <span class="n">binaryblock</span><span class="o">,</span> <span class="n">not</span><span class="o">-</span><span class="n">dirty</span>

<span class="nc">Script</span> <span class="nc">String</span><span class="k">:</span>

<span class="kt">minOut</span> <span class="o">=</span> <span class="n">min</span><span class="o">(</span><span class="nc">Xin</span><span class="o">)</span>
<span class="n">maxOut</span> <span class="k">=</span> <span class="n">max</span><span class="o">(</span><span class="nc">Xin</span><span class="o">)</span>
<span class="n">meanOut</span> <span class="k">=</span> <span class="n">mean</span><span class="o">(</span><span class="nc">Xin</span><span class="o">)</span>

<span class="nc">Script</span> <span class="nc">Execution</span> <span class="nc">String</span><span class="k">:</span>
<span class="kt">Xin</span> <span class="o">=</span> <span class="n">read</span><span class="o">('');</span>

<span class="n">minOut</span> <span class="k">=</span> <span class="n">min</span><span class="o">(</span><span class="nc">Xin</span><span class="o">)</span>
<span class="n">maxOut</span> <span class="k">=</span> <span class="n">max</span><span class="o">(</span><span class="nc">Xin</span><span class="o">)</span>
<span class="n">meanOut</span> <span class="k">=</span> <span class="n">mean</span><span class="o">(</span><span class="nc">Xin</span><span class="o">)</span>
<span class="n">write</span><span class="o">(</span><span class="n">minOut</span><span class="o">,</span> <span class="o">'');</span>
<span class="n">write</span><span class="o">(</span><span class="n">maxOut</span><span class="o">,</span> <span class="o">'');</span>
<span class="n">write</span><span class="o">(</span><span class="n">meanOut</span><span class="o">,</span> <span class="o">'');</span></code></pre></figure>

  </div>

</div>

<h2 id="clearing-scripts-and-mlcontext">Clearing Scripts and MLContext</h2>

<p>Dealing with large matrices can require a significant amount of memory. To deal help deal with this, you
can call a Script object&#8217;s <code class="highlighter-rouge">clearAll</code> method to clear the inputs, outputs, symbol table, and script string.
In terms of memory, the symbol table is most important because it holds references to matrices.</p>

<p>In this example, we display the symbol table of the <code class="highlighter-rouge">minMaxMeanScript</code>, call <code class="highlighter-rouge">clearAll</code> on the script, and
then display the symbol table, which is empty.</p>

<div class="codetabs">

<div data-lang="Scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="n">println</span><span class="o">(</span><span class="n">minMaxMeanScript</span><span class="o">.</span><span class="n">displaySymbolTable</span><span class="o">)</span>
<span class="n">minMaxMeanScript</span><span class="o">.</span><span class="n">clearAll</span>
<span class="n">println</span><span class="o">(</span><span class="n">minMaxMeanScript</span><span class="o">.</span><span class="n">displaySymbolTable</span><span class="o">)</span></code></pre></figure>

  </div>

<div data-lang="Spark Shell">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="n">scala</span><span class="o">&gt;</span> <span class="n">println</span><span class="o">(</span><span class="n">minMaxMeanScript</span><span class="o">.</span><span class="n">displaySymbolTable</span><span class="o">)</span>
<span class="nc">Symbol</span> <span class="nc">Table</span><span class="k">:</span>
  <span class="err">[1]</span> <span class="o">(</span><span class="kt">Double</span><span class="o">)</span> <span class="kt">meanOut:</span> <span class="err">0</span><span class="kt">.</span><span class="err">5000954668004209</span>
  <span class="err">[2]</span> <span class="o">(</span><span class="kt">Double</span><span class="o">)</span> <span class="kt">maxOut:</span> <span class="err">0</span><span class="kt">.</span><span class="err">9999999956646207</span>
  <span class="err">[3]</span> <span class="o">(</span><span class="kt">Double</span><span class="o">)</span> <span class="kt">minOut:</span> <span class="err">1</span><span class="kt">.</span><span class="err">4149740823476975</span><span class="kt">E-</span><span class="err">7</span>
  <span class="err">[4]</span> <span class="o">(</span><span class="kt">Matrix</span><span class="o">)</span> <span class="kt">Xin:</span> <span class="kt">Matrix:</span> <span class="kt">scratch_space/temp_1166464711339222</span><span class="o">,</span> <span class="o">[</span><span class="err">10000</span> <span class="kt">x</span> <span class="err">1000</span>, <span class="kt">nnz=</span><span class="err">10000000</span>, <span class="kt">blocks</span> <span class="o">(</span><span class="err">1000</span> <span class="kt">x</span> <span class="err">1000</span><span class="o">)],</span> <span class="n">binaryblock</span><span class="o">,</span> <span class="n">not</span><span class="o">-</span><span class="n">dirty</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="n">minMaxMeanScript</span><span class="o">.</span><span class="n">clearAll</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="n">println</span><span class="o">(</span><span class="n">minMaxMeanScript</span><span class="o">.</span><span class="n">displaySymbolTable</span><span class="o">)</span>
<span class="nc">Symbol</span> <span class="nc">Table</span><span class="k">:</span>
<span class="kt">None</span></code></pre></figure>

  </div>

</div>

<p>The MLContext object holds references to the scripts that have been executed. Calling <code class="highlighter-rouge">clear</code> on
the MLContext clears all scripts that it has references to and then removes the references to these
scripts.</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="n">ml</span><span class="o">.</span><span class="n">clear</span></code></pre></figure>

<h2 id="statistics">Statistics</h2>

<p>Statistics about script executions can be output to the console by calling MLContext&#8217;s <code class="highlighter-rouge">setStatistics</code>
method with a value of <code class="highlighter-rouge">true</code>.</p>

<div class="codetabs">

<div data-lang="Scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="n">ml</span><span class="o">.</span><span class="n">setStatistics</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
<span class="k">val</span> <span class="n">minMaxMean</span> <span class="k">=</span>
<span class="s">"""
minOut = min(Xin)
maxOut = max(Xin)
meanOut = mean(Xin)
"""</span>
<span class="k">val</span> <span class="n">minMaxMeanScript</span> <span class="k">=</span> <span class="n">dml</span><span class="o">(</span><span class="n">minMaxMean</span><span class="o">).</span><span class="n">in</span><span class="o">(</span><span class="s">"Xin"</span><span class="o">,</span> <span class="n">df</span><span class="o">,</span> <span class="n">mm</span><span class="o">).</span><span class="n">out</span><span class="o">(</span><span class="s">"minOut"</span><span class="o">,</span> <span class="s">"maxOut"</span><span class="o">,</span> <span class="s">"meanOut"</span><span class="o">)</span>
<span class="k">val</span> <span class="o">(</span><span class="n">min</span><span class="o">,</span> <span class="n">max</span><span class="o">,</span> <span class="n">mean</span><span class="o">)</span> <span class="k">=</span> <span class="n">ml</span><span class="o">.</span><span class="n">execute</span><span class="o">(</span><span class="n">minMaxMeanScript</span><span class="o">).</span><span class="n">getTuple</span><span class="o">[</span><span class="kt">Double</span>, <span class="kt">Double</span>, <span class="kt">Double</span><span class="o">](</span><span class="s">"minOut"</span><span class="o">,</span> <span class="s">"maxOut"</span><span class="o">,</span> <span class="s">"meanOut"</span><span class="o">)</span></code></pre></figure>

  </div>

<div data-lang="Spark Shell">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="n">scala</span><span class="o">&gt;</span> <span class="n">ml</span><span class="o">.</span><span class="n">setStatistics</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">minMaxMean</span> <span class="k">=</span>
     <span class="o">|</span> <span class="s">"""
     | minOut = min(Xin)
     | maxOut = max(Xin)
     | meanOut = mean(Xin)
     | """</span>
<span class="n">minMaxMean</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span>
<span class="s">"
minOut = min(Xin)
maxOut = max(Xin)
meanOut = mean(Xin)
"</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">minMaxMeanScript</span> <span class="k">=</span> <span class="n">dml</span><span class="o">(</span><span class="n">minMaxMean</span><span class="o">).</span><span class="n">in</span><span class="o">(</span><span class="s">"Xin"</span><span class="o">,</span> <span class="n">df</span><span class="o">,</span> <span class="n">mm</span><span class="o">).</span><span class="n">out</span><span class="o">(</span><span class="s">"minOut"</span><span class="o">,</span> <span class="s">"maxOut"</span><span class="o">,</span> <span class="s">"meanOut"</span><span class="o">)</span>
<span class="n">minMaxMeanScript</span><span class="k">:</span> <span class="kt">org.apache.sysml.api.mlcontext.Script</span> <span class="o">=</span>
<span class="nc">Inputs</span><span class="k">:</span>
  <span class="err">[1]</span> <span class="o">(</span><span class="kt">DataFrame</span><span class="o">)</span> <span class="kt">Xin:</span> <span class="err">[</span><span class="kt">C0:</span> <span class="kt">double</span><span class="o">,</span> <span class="n">C1</span><span class="k">:</span> <span class="kt">double</span><span class="o">,</span> <span class="n">C2</span><span class="k">:</span> <span class="kt">double</span><span class="o">,</span> <span class="n">C3</span><span class="k">:</span> <span class="kt">double</span><span class="o">,</span> <span class="n">C4</span><span class="k">:</span> <span class="kt">double</span><span class="o">,</span> <span class="n">C5</span><span class="k">:</span> <span class="kt">double</span><span class="o">,</span> <span class="n">C6</span><span class="k">:</span> <span class="kt">double</span><span class="o">,</span> <span class="n">C7</span><span class="k">:</span> <span class="kt">double</span><span class="o">,</span> <span class="o">...</span>

<span class="nc">Outputs</span><span class="k">:</span>
  <span class="err">[1]</span> <span class="kt">minOut</span>
  <span class="o">[</span><span class="err">2</span><span class="o">]</span> <span class="n">maxOut</span>
  <span class="o">[</span><span class="err">3</span><span class="o">]</span> <span class="n">meanOut</span>


<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="o">(</span><span class="n">min</span><span class="o">,</span> <span class="n">max</span><span class="o">,</span> <span class="n">mean</span><span class="o">)</span> <span class="k">=</span> <span class="n">ml</span><span class="o">.</span><span class="n">execute</span><span class="o">(</span><span class="n">minMaxMeanScript</span><span class="o">).</span><span class="n">getTuple</span><span class="o">[</span><span class="kt">Double</span>, <span class="kt">Double</span>, <span class="kt">Double</span><span class="o">](</span><span class="s">"minOut"</span><span class="o">,</span> <span class="s">"maxOut"</span><span class="o">,</span> <span class="s">"meanOut"</span><span class="o">)</span>
<span class="nc">SystemML</span> <span class="nc">Statistics</span><span class="k">:</span>
<span class="kt">Total</span> <span class="kt">elapsed</span> <span class="kt">time:</span>		<span class="err">0</span><span class="kt">.</span><span class="err">000</span> <span class="kt">sec.</span>
<span class="kt">Total</span> <span class="kt">compilation</span> <span class="kt">time:</span>		<span class="err">0</span><span class="kt">.</span><span class="err">000</span> <span class="kt">sec.</span>
<span class="kt">Total</span> <span class="kt">execution</span> <span class="kt">time:</span>		<span class="err">0</span><span class="kt">.</span><span class="err">000</span> <span class="kt">sec.</span>
<span class="kt">Number</span> <span class="kt">of</span> <span class="kt">compiled</span> <span class="kt">Spark</span> <span class="kt">inst:</span>	<span class="err">0</span><span class="kt">.</span>
<span class="kt">Number</span> <span class="kt">of</span> <span class="kt">executed</span> <span class="kt">Spark</span> <span class="kt">inst:</span>	<span class="err">0</span><span class="kt">.</span>
<span class="kt">Cache</span> <span class="kt">hits</span> <span class="o">(</span><span class="kt">Mem</span><span class="o">,</span> <span class="kt">WB</span><span class="o">,</span> <span class="nc">FS</span><span class="o">,</span> <span class="nc">HDFS</span><span class="o">)</span><span class="k">:</span>	<span class="err">2</span><span class="kt">/</span><span class="err">0</span><span class="kt">/</span><span class="err">0</span><span class="kt">/</span><span class="err">1</span><span class="kt">.</span>
<span class="kt">Cache</span> <span class="kt">writes</span> <span class="o">(</span><span class="kt">WB</span><span class="o">,</span> <span class="kt">FS</span><span class="o">,</span> <span class="nc">HDFS</span><span class="o">)</span><span class="k">:</span>	<span class="err">1</span><span class="kt">/</span><span class="err">0</span><span class="kt">/</span><span class="err">0</span><span class="kt">.</span>
<span class="kt">Cache</span> <span class="kt">times</span> <span class="o">(</span><span class="kt">ACQr/m</span><span class="o">,</span> <span class="kt">RLS</span><span class="o">,</span> <span class="nc">EXP</span><span class="o">)</span><span class="k">:</span>	<span class="err">3</span><span class="kt">.</span><span class="err">137</span><span class="kt">/</span><span class="err">0</span><span class="kt">.</span><span class="err">000</span><span class="kt">/</span><span class="err">0</span><span class="kt">.</span><span class="err">001</span><span class="kt">/</span><span class="err">0</span><span class="kt">.</span><span class="err">000</span> <span class="kt">sec.</span>
<span class="kt">HOP</span> <span class="kt">DAGs</span> <span class="kt">recompiled</span> <span class="o">(</span><span class="kt">PRED</span><span class="o">,</span> <span class="kt">SB</span><span class="o">)</span><span class="k">:</span>	<span class="err">0</span><span class="kt">/</span><span class="err">0</span><span class="kt">.</span>
<span class="kt">HOP</span> <span class="kt">DAGs</span> <span class="kt">recompile</span> <span class="kt">time:</span>	<span class="err">0</span><span class="kt">.</span><span class="err">000</span> <span class="kt">sec.</span>
<span class="kt">Spark</span> <span class="kt">ctx</span> <span class="kt">create</span> <span class="kt">time</span> <span class="o">(</span><span class="kt">lazy</span><span class="o">)</span><span class="kt">:</span>	<span class="err">0</span><span class="kt">.</span><span class="err">000</span> <span class="kt">sec.</span>
<span class="kt">Spark</span> <span class="kt">trans</span> <span class="kt">counts</span> <span class="o">(</span><span class="kt">par</span><span class="o">,</span><span class="kt">bc</span><span class="o">,</span><span class="n">col</span><span class="o">)</span><span class="k">:</span><span class="err">0</span><span class="kt">/</span><span class="err">0</span><span class="kt">/</span><span class="err">2</span><span class="kt">.</span>
<span class="kt">Spark</span> <span class="kt">trans</span> <span class="kt">times</span> <span class="o">(</span><span class="kt">par</span><span class="o">,</span><span class="kt">bc</span><span class="o">,</span><span class="n">col</span><span class="o">)</span><span class="k">:</span>	<span class="err">0</span><span class="kt">.</span><span class="err">000</span><span class="kt">/</span><span class="err">0</span><span class="kt">.</span><span class="err">000</span><span class="kt">/</span><span class="err">6</span><span class="kt">.</span><span class="err">434</span> <span class="kt">secs.</span>
<span class="kt">Total</span> <span class="kt">JIT</span> <span class="kt">compile</span> <span class="kt">time:</span>		<span class="err">112</span><span class="kt">.</span><span class="err">372</span> <span class="kt">sec.</span>
<span class="kt">Total</span> <span class="kt">JVM</span> <span class="kt">GC</span> <span class="kt">count:</span>		<span class="err">54</span><span class="kt">.</span>
<span class="kt">Total</span> <span class="kt">JVM</span> <span class="kt">GC</span> <span class="kt">time:</span>		<span class="err">9</span><span class="kt">.</span><span class="err">664</span> <span class="kt">sec.</span>
<span class="kt">Heavy</span> <span class="kt">hitter</span> <span class="kt">instructions</span> <span class="o">(</span><span class="kt">name</span><span class="o">,</span> <span class="kt">time</span><span class="o">,</span> <span class="n">count</span><span class="o">)</span><span class="k">:</span>
<span class="kt">--</span> <span class="err">1</span><span class="o">)</span> 	<span class="n">uamin</span> 	<span class="mf">3.150</span> <span class="n">sec</span> 	<span class="mi">1</span>
<span class="o">--</span> <span class="mi">2</span><span class="o">)</span> 	<span class="n">uamean</span> 	<span class="mf">0.021</span> <span class="n">sec</span> 	<span class="mi">1</span>
<span class="o">--</span> <span class="mi">3</span><span class="o">)</span> 	<span class="n">uamax</span> 	<span class="mf">0.017</span> <span class="n">sec</span> 	<span class="mi">1</span>
<span class="o">--</span> <span class="mi">4</span><span class="o">)</span> 	<span class="n">rmvar</span> 	<span class="mf">0.000</span> <span class="n">sec</span> 	<span class="mi">3</span>
<span class="o">--</span> <span class="mi">5</span><span class="o">)</span> 	<span class="n">assignvar</span> 	<span class="mf">0.000</span> <span class="n">sec</span> 	<span class="mi">3</span>

<span class="n">min</span><span class="k">:</span> <span class="kt">Double</span> <span class="o">=</span> <span class="mf">2.4982850344024143E-8</span>
<span class="n">max</span><span class="k">:</span> <span class="kt">Double</span> <span class="o">=</span> <span class="mf">0.9999997007231808</span>
<span class="n">mean</span><span class="k">:</span> <span class="kt">Double</span> <span class="o">=</span> <span class="mf">0.5002109404821844</span></code></pre></figure>

  </div>

</div>

<h2 id="explain">Explain</h2>

<p>A DML or PyDML script is converted into a SystemML program during script execution. Information
about this program can be displayed by calling MLContext&#8217;s <code class="highlighter-rouge">setExplain</code> method with a value
of <code class="highlighter-rouge">true</code>.</p>

<div class="codetabs">

<div data-lang="Scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="n">ml</span><span class="o">.</span><span class="n">setExplain</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
<span class="k">val</span> <span class="n">minMaxMean</span> <span class="k">=</span>
<span class="s">"""
minOut = min(Xin)
maxOut = max(Xin)
meanOut = mean(Xin)
"""</span>
<span class="k">val</span> <span class="n">mm</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">MatrixMetadata</span><span class="o">(</span><span class="n">numRows</span><span class="o">,</span> <span class="n">numCols</span><span class="o">)</span>
<span class="k">val</span> <span class="n">minMaxMeanScript</span> <span class="k">=</span> <span class="n">dml</span><span class="o">(</span><span class="n">minMaxMean</span><span class="o">).</span><span class="n">in</span><span class="o">(</span><span class="s">"Xin"</span><span class="o">,</span> <span class="n">df</span><span class="o">,</span> <span class="n">mm</span><span class="o">).</span><span class="n">out</span><span class="o">(</span><span class="s">"minOut"</span><span class="o">,</span> <span class="s">"maxOut"</span><span class="o">,</span> <span class="s">"meanOut"</span><span class="o">)</span>
<span class="k">val</span> <span class="o">(</span><span class="n">min</span><span class="o">,</span> <span class="n">max</span><span class="o">,</span> <span class="n">mean</span><span class="o">)</span> <span class="k">=</span> <span class="n">ml</span><span class="o">.</span><span class="n">execute</span><span class="o">(</span><span class="n">minMaxMeanScript</span><span class="o">).</span><span class="n">getTuple</span><span class="o">[</span><span class="kt">Double</span>, <span class="kt">Double</span>, <span class="kt">Double</span><span class="o">](</span><span class="s">"minOut"</span><span class="o">,</span> <span class="s">"maxOut"</span><span class="o">,</span> <span class="s">"meanOut"</span><span class="o">)</span></code></pre></figure>

  </div>

<div data-lang="Spark Shell">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="n">scala</span><span class="o">&gt;</span> <span class="n">ml</span><span class="o">.</span><span class="n">setExplain</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">minMaxMean</span> <span class="k">=</span>
     <span class="o">|</span> <span class="s">"""
     | minOut = min(Xin)
     | maxOut = max(Xin)
     | meanOut = mean(Xin)
     | """</span>
<span class="n">minMaxMean</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span>
<span class="s">"
minOut = min(Xin)
maxOut = max(Xin)
meanOut = mean(Xin)
"</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">mm</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">MatrixMetadata</span><span class="o">(</span><span class="n">numRows</span><span class="o">,</span> <span class="n">numCols</span><span class="o">)</span>
<span class="n">mm</span><span class="k">:</span> <span class="kt">org.apache.sysml.api.mlcontext.MatrixMetadata</span> <span class="o">=</span> <span class="n">rows</span><span class="k">:</span> <span class="err">10000</span><span class="o">,</span> <span class="n">columns</span><span class="k">:</span> <span class="err">1000</span><span class="o">,</span> <span class="n">non</span><span class="o">-</span><span class="n">zeros</span><span class="k">:</span> <span class="kt">None</span><span class="o">,</span> <span class="n">rows</span> <span class="n">per</span> <span class="n">block</span><span class="k">:</span> <span class="kt">None</span><span class="o">,</span> <span class="n">columns</span> <span class="n">per</span> <span class="n">block</span><span class="k">:</span> <span class="kt">None</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">minMaxMeanScript</span> <span class="k">=</span> <span class="n">dml</span><span class="o">(</span><span class="n">minMaxMean</span><span class="o">).</span><span class="n">in</span><span class="o">(</span><span class="s">"Xin"</span><span class="o">,</span> <span class="n">df</span><span class="o">,</span> <span class="n">mm</span><span class="o">).</span><span class="n">out</span><span class="o">(</span><span class="s">"minOut"</span><span class="o">,</span> <span class="s">"maxOut"</span><span class="o">,</span> <span class="s">"meanOut"</span><span class="o">)</span>
<span class="n">minMaxMeanScript</span><span class="k">:</span> <span class="kt">org.apache.sysml.api.mlcontext.Script</span> <span class="o">=</span>
<span class="nc">Inputs</span><span class="k">:</span>
  <span class="err">[1]</span> <span class="o">(</span><span class="kt">DataFrame</span><span class="o">)</span> <span class="kt">Xin:</span> <span class="err">[</span><span class="kt">C0:</span> <span class="kt">double</span><span class="o">,</span> <span class="n">C1</span><span class="k">:</span> <span class="kt">double</span><span class="o">,</span> <span class="n">C2</span><span class="k">:</span> <span class="kt">double</span><span class="o">,</span> <span class="n">C3</span><span class="k">:</span> <span class="kt">double</span><span class="o">,</span> <span class="n">C4</span><span class="k">:</span> <span class="kt">double</span><span class="o">,</span> <span class="n">C5</span><span class="k">:</span> <span class="kt">double</span><span class="o">,</span> <span class="n">C6</span><span class="k">:</span> <span class="kt">double</span><span class="o">,</span> <span class="n">C7</span><span class="k">:</span> <span class="kt">double</span><span class="o">,</span> <span class="o">...</span>

<span class="nc">Outputs</span><span class="k">:</span>
  <span class="err">[1]</span> <span class="kt">minOut</span>
  <span class="o">[</span><span class="err">2</span><span class="o">]</span> <span class="n">maxOut</span>
  <span class="o">[</span><span class="err">3</span><span class="o">]</span> <span class="n">meanOut</span>


<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="o">(</span><span class="n">min</span><span class="o">,</span> <span class="n">max</span><span class="o">,</span> <span class="n">mean</span><span class="o">)</span> <span class="k">=</span> <span class="n">ml</span><span class="o">.</span><span class="n">execute</span><span class="o">(</span><span class="n">minMaxMeanScript</span><span class="o">).</span><span class="n">getTuple</span><span class="o">[</span><span class="kt">Double</span>, <span class="kt">Double</span>, <span class="kt">Double</span><span class="o">](</span><span class="s">"minOut"</span><span class="o">,</span> <span class="s">"maxOut"</span><span class="o">,</span> <span class="s">"meanOut"</span><span class="o">)</span>

<span class="nc">PROGRAM</span>
<span class="o">--</span><span class="nc">MAIN</span> <span class="nc">PROGRAM</span>
<span class="o">----</span><span class="nc">GENERIC</span> <span class="o">(</span><span class="n">lines</span> <span class="mi">1</span><span class="o">-</span><span class="mi">8</span><span class="o">)</span> <span class="o">[</span><span class="kt">recompile=false</span><span class="o">]</span>
<span class="o">------(</span><span class="mi">12</span><span class="o">)</span> <span class="nc">TRead</span> <span class="nc">Xin</span> <span class="o">[</span><span class="err">10000</span>,<span class="err">1000</span>,<span class="err">1000</span>,<span class="err">1000</span>,<span class="err">10000000</span><span class="o">]</span> <span class="o">[</span><span class="err">0</span>,<span class="err">0</span>,<span class="err">76</span> <span class="kt">-&gt;</span> <span class="err">76</span><span class="kt">MB</span><span class="o">]</span> <span class="o">[</span><span class="kt">chkpt</span><span class="o">],</span> <span class="nc">CP</span>
<span class="o">------(</span><span class="mi">13</span><span class="o">)</span> <span class="n">ua</span><span class="o">(</span><span class="n">minRC</span><span class="o">)</span> <span class="o">(</span><span class="mi">12</span><span class="o">)</span> <span class="o">[</span><span class="err">0</span>,<span class="err">0</span>,<span class="kt">-</span><span class="err">1</span>,<span class="kt">-</span><span class="err">1</span>,<span class="kt">-</span><span class="err">1</span><span class="o">]</span> <span class="o">[</span><span class="err">76</span>,<span class="err">0</span>,<span class="err">0</span> <span class="kt">-&gt;</span> <span class="err">76</span><span class="kt">MB</span><span class="o">],</span> <span class="nc">CP</span>
<span class="o">------(</span><span class="mi">21</span><span class="o">)</span> <span class="nc">TWrite</span> <span class="n">minOut</span> <span class="o">(</span><span class="mi">13</span><span class="o">)</span> <span class="o">[</span><span class="err">0</span>,<span class="err">0</span>,<span class="kt">-</span><span class="err">1</span>,<span class="kt">-</span><span class="err">1</span>,<span class="kt">-</span><span class="err">1</span><span class="o">]</span> <span class="o">[</span><span class="err">0</span>,<span class="err">0</span>,<span class="err">0</span> <span class="kt">-&gt;</span> <span class="err">0</span><span class="kt">MB</span><span class="o">],</span> <span class="nc">CP</span>
<span class="o">------(</span><span class="mi">14</span><span class="o">)</span> <span class="n">ua</span><span class="o">(</span><span class="n">maxRC</span><span class="o">)</span> <span class="o">(</span><span class="mi">12</span><span class="o">)</span> <span class="o">[</span><span class="err">0</span>,<span class="err">0</span>,<span class="kt">-</span><span class="err">1</span>,<span class="kt">-</span><span class="err">1</span>,<span class="kt">-</span><span class="err">1</span><span class="o">]</span> <span class="o">[</span><span class="err">76</span>,<span class="err">0</span>,<span class="err">0</span> <span class="kt">-&gt;</span> <span class="err">76</span><span class="kt">MB</span><span class="o">],</span> <span class="nc">CP</span>
<span class="o">------(</span><span class="mi">27</span><span class="o">)</span> <span class="nc">TWrite</span> <span class="n">maxOut</span> <span class="o">(</span><span class="mi">14</span><span class="o">)</span> <span class="o">[</span><span class="err">0</span>,<span class="err">0</span>,<span class="kt">-</span><span class="err">1</span>,<span class="kt">-</span><span class="err">1</span>,<span class="kt">-</span><span class="err">1</span><span class="o">]</span> <span class="o">[</span><span class="err">0</span>,<span class="err">0</span>,<span class="err">0</span> <span class="kt">-&gt;</span> <span class="err">0</span><span class="kt">MB</span><span class="o">],</span> <span class="nc">CP</span>
<span class="o">------(</span><span class="mi">15</span><span class="o">)</span> <span class="n">ua</span><span class="o">(</span><span class="n">meanRC</span><span class="o">)</span> <span class="o">(</span><span class="mi">12</span><span class="o">)</span> <span class="o">[</span><span class="err">0</span>,<span class="err">0</span>,<span class="kt">-</span><span class="err">1</span>,<span class="kt">-</span><span class="err">1</span>,<span class="kt">-</span><span class="err">1</span><span class="o">]</span> <span class="o">[</span><span class="err">76</span>,<span class="err">0</span>,<span class="err">0</span> <span class="kt">-&gt;</span> <span class="err">76</span><span class="kt">MB</span><span class="o">],</span> <span class="nc">CP</span>
<span class="o">------(</span><span class="mi">33</span><span class="o">)</span> <span class="nc">TWrite</span> <span class="n">meanOut</span> <span class="o">(</span><span class="mi">15</span><span class="o">)</span> <span class="o">[</span><span class="err">0</span>,<span class="err">0</span>,<span class="kt">-</span><span class="err">1</span>,<span class="kt">-</span><span class="err">1</span>,<span class="kt">-</span><span class="err">1</span><span class="o">]</span> <span class="o">[</span><span class="err">0</span>,<span class="err">0</span>,<span class="err">0</span> <span class="kt">-&gt;</span> <span class="err">0</span><span class="kt">MB</span><span class="o">],</span> <span class="nc">CP</span>

<span class="n">min</span><span class="k">:</span> <span class="kt">Double</span> <span class="o">=</span> <span class="mf">5.16651366133658E-9</span>
<span class="n">max</span><span class="k">:</span> <span class="kt">Double</span> <span class="o">=</span> <span class="mf">0.9999999368927975</span>
<span class="n">mean</span><span class="k">:</span> <span class="kt">Double</span> <span class="o">=</span> <span class="mf">0.5001096515241128</span></code></pre></figure>

  </div>

</div>

<p>Different explain levels can be set. The explain levels are NONE, HOPS, RUNTIME, RECOMPILE_HOPS, and RECOMPILE_RUNTIME.</p>

<div class="codetabs">

<div data-lang="Scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="n">ml</span><span class="o">.</span><span class="n">setExplainLevel</span><span class="o">(</span><span class="nc">MLContext</span><span class="o">.</span><span class="nc">ExplainLevel</span><span class="o">.</span><span class="nc">RUNTIME</span><span class="o">)</span>
<span class="k">val</span> <span class="o">(</span><span class="n">min</span><span class="o">,</span> <span class="n">max</span><span class="o">,</span> <span class="n">mean</span><span class="o">)</span> <span class="k">=</span> <span class="n">ml</span><span class="o">.</span><span class="n">execute</span><span class="o">(</span><span class="n">minMaxMeanScript</span><span class="o">).</span><span class="n">getTuple</span><span class="o">[</span><span class="kt">Double</span>, <span class="kt">Double</span>, <span class="kt">Double</span><span class="o">](</span><span class="s">"minOut"</span><span class="o">,</span> <span class="s">"maxOut"</span><span class="o">,</span> <span class="s">"meanOut"</span><span class="o">)</span></code></pre></figure>

  </div>

<div data-lang="Spark Shell">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="n">scala</span><span class="o">&gt;</span> <span class="n">ml</span><span class="o">.</span><span class="n">setExplainLevel</span><span class="o">(</span><span class="nc">MLContext</span><span class="o">.</span><span class="nc">ExplainLevel</span><span class="o">.</span><span class="nc">RUNTIME</span><span class="o">)</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="o">(</span><span class="n">min</span><span class="o">,</span> <span class="n">max</span><span class="o">,</span> <span class="n">mean</span><span class="o">)</span> <span class="k">=</span> <span class="n">ml</span><span class="o">.</span><span class="n">execute</span><span class="o">(</span><span class="n">minMaxMeanScript</span><span class="o">).</span><span class="n">getTuple</span><span class="o">[</span><span class="kt">Double</span>, <span class="kt">Double</span>, <span class="kt">Double</span><span class="o">](</span><span class="s">"minOut"</span><span class="o">,</span> <span class="s">"maxOut"</span><span class="o">,</span> <span class="s">"meanOut"</span><span class="o">)</span>

<span class="nc">PROGRAM</span> <span class="o">(</span> <span class="n">size</span> <span class="nc">CP</span><span class="o">/</span><span class="nc">SP</span> <span class="k">=</span> <span class="mi">9</span><span class="o">/</span><span class="mi">0</span> <span class="o">)</span>
<span class="o">--</span><span class="nc">MAIN</span> <span class="nc">PROGRAM</span>
<span class="o">----</span><span class="nc">GENERIC</span> <span class="o">(</span><span class="n">lines</span> <span class="mi">1</span><span class="o">-</span><span class="mi">8</span><span class="o">)</span> <span class="o">[</span><span class="kt">recompile=false</span><span class="o">]</span>
<span class="o">------</span><span class="nc">CP</span> <span class="n">uamin</span> <span class="nc">Xin</span><span class="o">.</span><span class="nc">MATRIX</span><span class="o">.</span><span class="nc">DOUBLE</span> <span class="nc">_Var8</span><span class="o">.</span><span class="nc">SCALAR</span><span class="o">.</span><span class="nc">DOUBLE</span> <span class="mi">8</span>
<span class="o">------</span><span class="nc">CP</span> <span class="n">uamax</span> <span class="nc">Xin</span><span class="o">.</span><span class="nc">MATRIX</span><span class="o">.</span><span class="nc">DOUBLE</span> <span class="nc">_Var9</span><span class="o">.</span><span class="nc">SCALAR</span><span class="o">.</span><span class="nc">DOUBLE</span> <span class="mi">8</span>
<span class="o">------</span><span class="nc">CP</span> <span class="n">uamean</span> <span class="nc">Xin</span><span class="o">.</span><span class="nc">MATRIX</span><span class="o">.</span><span class="nc">DOUBLE</span> <span class="nc">_Var10</span><span class="o">.</span><span class="nc">SCALAR</span><span class="o">.</span><span class="nc">DOUBLE</span> <span class="mi">8</span>
<span class="o">------</span><span class="nc">CP</span> <span class="n">assignvar</span> <span class="nc">_Var8</span><span class="o">.</span><span class="nc">SCALAR</span><span class="o">.</span><span class="nc">DOUBLE</span><span class="o">.</span><span class="kc">false</span> <span class="n">minOut</span><span class="o">.</span><span class="nc">SCALAR</span><span class="o">.</span><span class="nc">DOUBLE</span>
<span class="o">------</span><span class="nc">CP</span> <span class="n">assignvar</span> <span class="nc">_Var9</span><span class="o">.</span><span class="nc">SCALAR</span><span class="o">.</span><span class="nc">DOUBLE</span><span class="o">.</span><span class="kc">false</span> <span class="n">maxOut</span><span class="o">.</span><span class="nc">SCALAR</span><span class="o">.</span><span class="nc">DOUBLE</span>
<span class="o">------</span><span class="nc">CP</span> <span class="n">assignvar</span> <span class="nc">_Var10</span><span class="o">.</span><span class="nc">SCALAR</span><span class="o">.</span><span class="nc">DOUBLE</span><span class="o">.</span><span class="kc">false</span> <span class="n">meanOut</span><span class="o">.</span><span class="nc">SCALAR</span><span class="o">.</span><span class="nc">DOUBLE</span>
<span class="o">------</span><span class="nc">CP</span> <span class="n">rmvar</span> <span class="nc">_Var8</span>
<span class="o">------</span><span class="nc">CP</span> <span class="n">rmvar</span> <span class="nc">_Var9</span>
<span class="o">------</span><span class="nc">CP</span> <span class="n">rmvar</span> <span class="nc">_Var10</span>

<span class="n">min</span><span class="k">:</span> <span class="kt">Double</span> <span class="o">=</span> <span class="mf">5.16651366133658E-9</span>
<span class="n">max</span><span class="k">:</span> <span class="kt">Double</span> <span class="o">=</span> <span class="mf">0.9999999368927975</span>
<span class="n">mean</span><span class="k">:</span> <span class="kt">Double</span> <span class="o">=</span> <span class="mf">0.5001096515241128</span></code></pre></figure>

  </div>

</div>

<h2 id="script-creation-and-scriptfactory">Script Creation and ScriptFactory</h2>

<p>Script objects can be created using standard Script constructors. A Script can be
of two types: DML (R-based syntax) and PYDML (Python-based syntax). If no ScriptType
is specified, the default Script type is DML.</p>

<div class="codetabs">

<div data-lang="Scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">script</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Script</span><span class="o">()</span>
<span class="n">println</span><span class="o">(</span><span class="n">script</span><span class="o">.</span><span class="n">getScriptType</span><span class="o">)</span>
<span class="k">val</span> <span class="n">script</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Script</span><span class="o">(</span><span class="nc">ScriptType</span><span class="o">.</span><span class="nc">PYDML</span><span class="o">)</span>
<span class="n">println</span><span class="o">(</span><span class="n">script</span><span class="o">.</span><span class="n">getScriptType</span><span class="o">)</span></code></pre></figure>

  </div>

<div data-lang="Spark Shell">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">script</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Script</span><span class="o">();</span>
<span class="o">...</span>
<span class="n">scala</span><span class="o">&gt;</span> <span class="n">println</span><span class="o">(</span><span class="n">script</span><span class="o">.</span><span class="n">getScriptType</span><span class="o">)</span>
<span class="nc">DML</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">script</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Script</span><span class="o">(</span><span class="nc">ScriptType</span><span class="o">.</span><span class="nc">PYDML</span><span class="o">);</span>
<span class="o">...</span>
<span class="n">scala</span><span class="o">&gt;</span> <span class="n">println</span><span class="o">(</span><span class="n">script</span><span class="o">.</span><span class="n">getScriptType</span><span class="o">)</span>
<span class="nc">PYDML</span></code></pre></figure>

  </div>

</div>

<p>The ScriptFactory class offers convenient methods for creating DML and PYDML scripts from a variety of sources.
ScriptFactory can create a script object from a String, File, URL, or InputStream.</p>

<p><strong>Script from URL:</strong></p>

<p>Here we create Script object <code class="highlighter-rouge">s1</code> by reading <code class="highlighter-rouge">Univar-Stats.dml</code> from a URL.</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">uniUrl</span> <span class="k">=</span> <span class="s">"https://raw.githubusercontent.com/apache/incubator-systemml/master/scripts/algorithms/Univar-Stats.dml"</span>
<span class="k">val</span> <span class="n">s1</span> <span class="k">=</span> <span class="nc">ScriptFactory</span><span class="o">.</span><span class="n">dmlFromUrl</span><span class="o">(</span><span class="n">scriptUrl</span><span class="o">)</span></code></pre></figure>

<p><strong>Script from String:</strong></p>

<p>We create Script objects <code class="highlighter-rouge">s2</code> and <code class="highlighter-rouge">s3</code> from Strings using ScriptFactory&#8217;s <code class="highlighter-rouge">dml</code> and <code class="highlighter-rouge">dmlFromString</code> methods.
Both methods perform the same action. This example reads an algorithm at a URL to String <code class="highlighter-rouge">uniString</code> and then
creates two script objects based on this String.</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">uniUrl</span> <span class="k">=</span> <span class="s">"https://raw.githubusercontent.com/apache/incubator-systemml/master/scripts/algorithms/Univar-Stats.dml"</span>
<span class="k">val</span> <span class="n">uniString</span> <span class="k">=</span> <span class="n">scala</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="nc">Source</span><span class="o">.</span><span class="n">fromURL</span><span class="o">(</span><span class="n">uniUrl</span><span class="o">).</span><span class="n">mkString</span>
<span class="k">val</span> <span class="n">s2</span> <span class="k">=</span> <span class="nc">ScriptFactory</span><span class="o">.</span><span class="n">dml</span><span class="o">(</span><span class="n">uniString</span><span class="o">)</span>
<span class="k">val</span> <span class="n">s3</span> <span class="k">=</span> <span class="nc">ScriptFactory</span><span class="o">.</span><span class="n">dmlFromString</span><span class="o">(</span><span class="n">uniString</span><span class="o">)</span></code></pre></figure>

<p><strong>Script from File:</strong></p>

<p>We create Script object <code class="highlighter-rouge">s4</code> based on a path to a file using ScriptFactory&#8217;s <code class="highlighter-rouge">dmlFromFile</code> method. This example
reads a URL to a String, writes this String to a file, and then uses the path to the file to create a Script object.</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">uniUrl</span> <span class="k">=</span> <span class="s">"https://raw.githubusercontent.com/apache/incubator-systemml/master/scripts/algorithms/Univar-Stats.dml"</span>
<span class="k">val</span> <span class="n">uniString</span> <span class="k">=</span> <span class="n">scala</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="nc">Source</span><span class="o">.</span><span class="n">fromURL</span><span class="o">(</span><span class="n">uniUrl</span><span class="o">).</span><span class="n">mkString</span>
<span class="n">scala</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">nsc</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="nc">File</span><span class="o">(</span><span class="s">"uni.dml"</span><span class="o">).</span><span class="n">writeAll</span><span class="o">(</span><span class="n">uniString</span><span class="o">)</span>
<span class="k">val</span> <span class="n">s4</span> <span class="k">=</span> <span class="nc">ScriptFactory</span><span class="o">.</span><span class="n">dmlFromFile</span><span class="o">(</span><span class="s">"uni.dml"</span><span class="o">)</span></code></pre></figure>

<p><strong>Script from InputStream:</strong></p>

<p>The SystemML jar file contains all the primary algorithm scripts. We can read one of these scripts as an InputStream
and use this to create a Script object.</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">inputStream</span> <span class="k">=</span> <span class="n">getClass</span><span class="o">.</span><span class="n">getResourceAsStream</span><span class="o">(</span><span class="s">"/scripts/algorithms/Univar-Stats.dml"</span><span class="o">)</span>
<span class="k">val</span> <span class="n">s5</span> <span class="k">=</span> <span class="nc">ScriptFactory</span><span class="o">.</span><span class="n">dmlFromInputStream</span><span class="o">(</span><span class="n">inputStream</span><span class="o">)</span></code></pre></figure>

<p><strong>Script from Resource:</strong></p>

<p>As mentioned, the SystemML jar file contains all the primary algorithm script files. For convenience, we can
read these script files or other script files on the classpath using ScriptFactory&#8217;s <code class="highlighter-rouge">dmlFromResource</code> and <code class="highlighter-rouge">pydmlFromResource</code>
methods.</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">s6</span> <span class="k">=</span> <span class="nc">ScriptFactory</span><span class="o">.</span><span class="n">dmlFromResource</span><span class="o">(</span><span class="s">"/scripts/algorithms/Univar-Stats.dml"</span><span class="o">);</span></code></pre></figure>

<h2 id="scriptexecutor">ScriptExecutor</h2>

<p>A Script is executed by a ScriptExecutor. If no ScriptExecutor is specified, a default ScriptExecutor will
be created to execute a Script. Script execution consists of several steps, as detailed in
<a href="http://sites.computer.org/debull/A14sept/p52.pdf">SystemML&#8217;s Optimizer: Plan Generation for Large-Scale Machine Learning Programs</a>.
Additional information can be found in the Javadocs for ScriptExecutor.</p>

<p>Advanced users may find it useful to be able to specify their own execution or to override ScriptExecutor methods by
subclassing ScriptExecutor.</p>

<p>In this example, we override the <code class="highlighter-rouge">parseScript</code> and <code class="highlighter-rouge">validateScript</code> methods to display messages to the console
during these execution steps.</p>

<div class="codetabs">

<div data-lang="Scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">class</span> <span class="nc">MyScriptExecutor</span> <span class="k">extends</span> <span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">sysml</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">mlcontext</span><span class="o">.</span><span class="nc">ScriptExecutor</span> <span class="o">{</span>
  <span class="k">override</span> <span class="k">def</span> <span class="n">parseScript</span><span class="o">{</span> <span class="n">println</span><span class="o">(</span><span class="s">"Parsing script"</span><span class="o">);</span> <span class="k">super</span><span class="o">.</span><span class="n">parseScript</span><span class="o">();</span> <span class="o">}</span>
  <span class="k">override</span> <span class="k">def</span> <span class="n">validateScript</span><span class="o">{</span> <span class="n">println</span><span class="o">(</span><span class="s">"Validating script"</span><span class="o">);</span> <span class="k">super</span><span class="o">.</span><span class="n">validateScript</span><span class="o">();</span> <span class="o">}</span>
<span class="o">}</span>
<span class="k">val</span> <span class="n">helloScript</span> <span class="k">=</span> <span class="n">dml</span><span class="o">(</span><span class="s">"print('hello world')"</span><span class="o">)</span>
<span class="n">ml</span><span class="o">.</span><span class="n">execute</span><span class="o">(</span><span class="n">helloScript</span><span class="o">,</span> <span class="k">new</span> <span class="nc">MyScriptExecutor</span><span class="o">)</span></code></pre></figure>

  </div>

<div data-lang="Spark Shell">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="n">scala</span><span class="o">&gt;</span> <span class="k">class</span> <span class="nc">MyScriptExecutor</span> <span class="k">extends</span> <span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">sysml</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">mlcontext</span><span class="o">.</span><span class="nc">ScriptExecutor</span> <span class="o">{</span>
     <span class="o">|</span>   <span class="k">override</span> <span class="k">def</span> <span class="n">parseScript</span><span class="o">{</span> <span class="n">println</span><span class="o">(</span><span class="s">"Parsing script"</span><span class="o">);</span> <span class="k">super</span><span class="o">.</span><span class="n">parseScript</span><span class="o">();</span> <span class="o">}</span>
     <span class="o">|</span>   <span class="k">override</span> <span class="k">def</span> <span class="n">validateScript</span><span class="o">{</span> <span class="n">println</span><span class="o">(</span><span class="s">"Validating script"</span><span class="o">);</span> <span class="k">super</span><span class="o">.</span><span class="n">validateScript</span><span class="o">();</span> <span class="o">}</span>
     <span class="o">|</span> <span class="o">}</span>
<span class="n">defined</span> <span class="k">class</span> <span class="nc">MyScriptExecutor</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">helloScript</span> <span class="k">=</span> <span class="n">dml</span><span class="o">(</span><span class="s">"print('hello world')"</span><span class="o">)</span>
<span class="n">helloScript</span><span class="k">:</span> <span class="kt">org.apache.sysml.api.mlcontext.Script</span> <span class="o">=</span>
<span class="nc">Inputs</span><span class="k">:</span>
<span class="kt">None</span>

<span class="nc">Outputs</span><span class="k">:</span>
<span class="kt">None</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="n">ml</span><span class="o">.</span><span class="n">execute</span><span class="o">(</span><span class="n">helloScript</span><span class="o">,</span> <span class="k">new</span> <span class="nc">MyScriptExecutor</span><span class="o">)</span>
<span class="nc">Parsing</span> <span class="n">script</span>
<span class="nc">Validating</span> <span class="n">script</span>
<span class="n">hello</span> <span class="n">world</span>
<span class="n">res63</span><span class="k">:</span> <span class="kt">org.apache.sysml.api.mlcontext.MLResults</span> <span class="o">=</span>
<span class="nc">None</span></code></pre></figure>

  </div>

</div>

<h2 id="matrixmetadata">MatrixMetadata</h2>

<p>When supplying matrix data to Apache SystemML using the MLContext API, matrix metadata can be
supplied using a <code class="highlighter-rouge">MatrixMetadata</code> object. Supplying characteristics about a matrix can significantly
improve performance. For some types of input matrices, supplying metadata is mandatory.
Metadata at a minimum typically consists of the number of rows and columns in
a matrix. The number of non-zeros can also be supplied.</p>

<p>Additionally, the number of rows and columns per block can be supplied, although in typical usage
it&#8217;s probably fine to use the default values used by SystemML (1,000 rows and 1,000 columns per block).
SystemML handles a matrix internally by splitting the matrix into chunks, or <em>blocks</em>.
The number of rows and columns per block refers to the size of these matrix blocks.</p>

<p><strong>CSV RDD with No Metadata:</strong></p>

<p>Here we see an example of inputting an RDD of Strings in CSV format with no metadata. Note that in general
it is recommended that metadata is supplied. We output the sum and mean of the cells in the matrix.</p>

<div class="codetabs">

<div data-lang="Scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">rddCSV</span> <span class="k">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">parallelize</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span><span class="s">"1.0,2.0"</span><span class="o">,</span> <span class="s">"3.0,4.0"</span><span class="o">))</span>
<span class="k">val</span> <span class="n">sumAndMean</span> <span class="k">=</span> <span class="n">dml</span><span class="o">(</span><span class="s">"sum = sum(m); mean = mean(m)"</span><span class="o">).</span><span class="n">in</span><span class="o">(</span><span class="s">"m"</span><span class="o">,</span> <span class="n">rddCSV</span><span class="o">).</span><span class="n">out</span><span class="o">(</span><span class="s">"sum"</span><span class="o">,</span> <span class="s">"mean"</span><span class="o">)</span>
<span class="n">ml</span><span class="o">.</span><span class="n">execute</span><span class="o">(</span><span class="n">sumAndMean</span><span class="o">)</span></code></pre></figure>

  </div>

<div data-lang="Spark Shell">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">rddCSV</span> <span class="k">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">parallelize</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span><span class="s">"1.0,2.0"</span><span class="o">,</span> <span class="s">"3.0,4.0"</span><span class="o">))</span>
<span class="n">rddCSV</span><span class="k">:</span> <span class="kt">org.apache.spark.rdd.RDD</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="nc">ParallelCollectionRDD</span><span class="o">[</span><span class="err">190</span><span class="o">]</span> <span class="n">at</span> <span class="n">parallelize</span> <span class="n">at</span> <span class="o">&lt;</span><span class="n">console</span><span class="k">&gt;:</span><span class="mi">38</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">sumAndMean</span> <span class="k">=</span> <span class="n">dml</span><span class="o">(</span><span class="s">"sum = sum(m); mean = mean(m)"</span><span class="o">).</span><span class="n">in</span><span class="o">(</span><span class="s">"m"</span><span class="o">,</span> <span class="n">rddCSV</span><span class="o">).</span><span class="n">out</span><span class="o">(</span><span class="s">"sum"</span><span class="o">,</span> <span class="s">"mean"</span><span class="o">)</span>
<span class="n">sumAndMean</span><span class="k">:</span> <span class="kt">org.apache.sysml.api.mlcontext.Script</span> <span class="o">=</span>
<span class="nc">Inputs</span><span class="k">:</span>
  <span class="err">[1]</span> <span class="o">(</span><span class="kt">RDD</span><span class="o">)</span> <span class="kt">m:</span> <span class="kt">ParallelCollectionRDD</span><span class="o">[</span><span class="err">190</span><span class="o">]</span> <span class="n">at</span> <span class="n">parallelize</span> <span class="n">at</span> <span class="o">&lt;</span><span class="n">console</span><span class="k">&gt;:</span><span class="mi">38</span>

<span class="nc">Outputs</span><span class="k">:</span>
  <span class="err">[1]</span> <span class="kt">sum</span>
  <span class="o">[</span><span class="err">2</span><span class="o">]</span> <span class="n">mean</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="n">ml</span><span class="o">.</span><span class="n">execute</span><span class="o">(</span><span class="n">sumAndMean</span><span class="o">)</span>
<span class="n">res20</span><span class="k">:</span> <span class="kt">org.apache.sysml.api.mlcontext.MLResults</span> <span class="o">=</span>
  <span class="o">[</span><span class="err">1</span><span class="o">]</span> <span class="o">(</span><span class="nc">Double</span><span class="o">)</span> <span class="n">sum</span><span class="k">:</span> <span class="err">10</span><span class="kt">.</span><span class="err">0</span>
  <span class="err">[2]</span> <span class="o">(</span><span class="kt">Double</span><span class="o">)</span> <span class="kt">mean:</span> <span class="err">2</span><span class="kt">.</span><span class="err">5</span></code></pre></figure>

  </div>

</div>

<p><strong>IJV RDD with Metadata:</strong></p>

<p>Next, we&#8217;ll supply an RDD in IJV format. IJV is a sparse format where each line has three space-separated values.
The first value indicates the row number, the second value indicates the column number, and the
third value indicates the cell value. Since the total numbers of rows and columns can&#8217;t be determined
from these IJV rows, we need to supply metadata describing the matrix size.</p>

<p>Here, we specify that our matrix has 3 rows and 3 columns.</p>

<div class="codetabs">

<div data-lang="Scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">rddIJV</span> <span class="k">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">parallelize</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span><span class="s">"1 1 1"</span><span class="o">,</span> <span class="s">"2 1 2"</span><span class="o">,</span> <span class="s">"1 2 3"</span><span class="o">,</span> <span class="s">"3 3 4"</span><span class="o">))</span>
<span class="k">val</span> <span class="n">mm3x3</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">MatrixMetadata</span><span class="o">(</span><span class="nc">MatrixFormat</span><span class="o">.</span><span class="nc">IJV</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">3</span><span class="o">)</span>
<span class="k">val</span> <span class="n">sumAndMean</span> <span class="k">=</span> <span class="n">dml</span><span class="o">(</span><span class="s">"sum = sum(m); mean = mean(m)"</span><span class="o">).</span><span class="n">in</span><span class="o">(</span><span class="s">"m"</span><span class="o">,</span> <span class="n">rddIJV</span><span class="o">,</span> <span class="n">mm3x3</span><span class="o">).</span><span class="n">out</span><span class="o">(</span><span class="s">"sum"</span><span class="o">,</span> <span class="s">"mean"</span><span class="o">)</span>
<span class="n">ml</span><span class="o">.</span><span class="n">execute</span><span class="o">(</span><span class="n">sumAndMean</span><span class="o">)</span></code></pre></figure>

  </div>

<div data-lang="Spark Shell">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">rddIJV</span> <span class="k">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">parallelize</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span><span class="s">"1 1 1"</span><span class="o">,</span> <span class="s">"2 1 2"</span><span class="o">,</span> <span class="s">"1 2 3"</span><span class="o">,</span> <span class="s">"3 3 4"</span><span class="o">))</span>
<span class="n">rddIJV</span><span class="k">:</span> <span class="kt">org.apache.spark.rdd.RDD</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="nc">ParallelCollectionRDD</span><span class="o">[</span><span class="err">202</span><span class="o">]</span> <span class="n">at</span> <span class="n">parallelize</span> <span class="n">at</span> <span class="o">&lt;</span><span class="n">console</span><span class="k">&gt;:</span><span class="mi">38</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">mm3x3</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">MatrixMetadata</span><span class="o">(</span><span class="nc">MatrixFormat</span><span class="o">.</span><span class="nc">IJV</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">3</span><span class="o">)</span>
<span class="n">mm3x3</span><span class="k">:</span> <span class="kt">org.apache.sysml.api.mlcontext.MatrixMetadata</span> <span class="o">=</span> <span class="n">rows</span><span class="k">:</span> <span class="err">3</span><span class="o">,</span> <span class="n">columns</span><span class="k">:</span> <span class="err">3</span><span class="o">,</span> <span class="n">non</span><span class="o">-</span><span class="n">zeros</span><span class="k">:</span> <span class="kt">None</span><span class="o">,</span> <span class="n">rows</span> <span class="n">per</span> <span class="n">block</span><span class="k">:</span> <span class="kt">None</span><span class="o">,</span> <span class="n">columns</span> <span class="n">per</span> <span class="n">block</span><span class="k">:</span> <span class="kt">None</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">sumAndMean</span> <span class="k">=</span> <span class="n">dml</span><span class="o">(</span><span class="s">"sum = sum(m); mean = mean(m)"</span><span class="o">).</span><span class="n">in</span><span class="o">(</span><span class="s">"m"</span><span class="o">,</span> <span class="n">rddIJV</span><span class="o">,</span> <span class="n">mm3x3</span><span class="o">).</span><span class="n">out</span><span class="o">(</span><span class="s">"sum"</span><span class="o">,</span> <span class="s">"mean"</span><span class="o">)</span>
<span class="n">sumAndMean</span><span class="k">:</span> <span class="kt">org.apache.sysml.api.mlcontext.Script</span> <span class="o">=</span>
<span class="nc">Inputs</span><span class="k">:</span>
  <span class="err">[1]</span> <span class="o">(</span><span class="kt">RDD</span><span class="o">)</span> <span class="kt">m:</span> <span class="kt">ParallelCollectionRDD</span><span class="o">[</span><span class="err">202</span><span class="o">]</span> <span class="n">at</span> <span class="n">parallelize</span> <span class="n">at</span> <span class="o">&lt;</span><span class="n">console</span><span class="k">&gt;:</span><span class="mi">38</span>

<span class="nc">Outputs</span><span class="k">:</span>
  <span class="err">[1]</span> <span class="kt">sum</span>
  <span class="o">[</span><span class="err">2</span><span class="o">]</span> <span class="n">mean</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="n">ml</span><span class="o">.</span><span class="n">execute</span><span class="o">(</span><span class="n">sumAndMean</span><span class="o">)</span>
<span class="n">res21</span><span class="k">:</span> <span class="kt">org.apache.sysml.api.mlcontext.MLResults</span> <span class="o">=</span>
  <span class="o">[</span><span class="err">1</span><span class="o">]</span> <span class="o">(</span><span class="nc">Double</span><span class="o">)</span> <span class="n">sum</span><span class="k">:</span> <span class="err">10</span><span class="kt">.</span><span class="err">0</span>
  <span class="err">[2]</span> <span class="o">(</span><span class="kt">Double</span><span class="o">)</span> <span class="kt">mean:</span> <span class="err">1</span><span class="kt">.</span><span class="err">1111111111111112</span></code></pre></figure>

  </div>

</div>

<p>Next, we&#8217;ll run the same DML, but this time we&#8217;ll specify that the input matrix is 4x4 instead of 3x3.</p>

<div class="codetabs">

<div data-lang="Scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">rddIJV</span> <span class="k">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">parallelize</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span><span class="s">"1 1 1"</span><span class="o">,</span> <span class="s">"2 1 2"</span><span class="o">,</span> <span class="s">"1 2 3"</span><span class="o">,</span> <span class="s">"3 3 4"</span><span class="o">))</span>
<span class="k">val</span> <span class="n">mm4x4</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">MatrixMetadata</span><span class="o">(</span><span class="nc">MatrixFormat</span><span class="o">.</span><span class="nc">IJV</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">4</span><span class="o">)</span>
<span class="k">val</span> <span class="n">sumAndMean</span> <span class="k">=</span> <span class="n">dml</span><span class="o">(</span><span class="s">"sum = sum(m); mean = mean(m)"</span><span class="o">).</span><span class="n">in</span><span class="o">(</span><span class="s">"m"</span><span class="o">,</span> <span class="n">rddIJV</span><span class="o">,</span> <span class="n">mm4x4</span><span class="o">).</span><span class="n">out</span><span class="o">(</span><span class="s">"sum"</span><span class="o">,</span> <span class="s">"mean"</span><span class="o">)</span>
<span class="n">ml</span><span class="o">.</span><span class="n">execute</span><span class="o">(</span><span class="n">sumAndMean</span><span class="o">)</span></code></pre></figure>

  </div>

<div data-lang="Spark Shell">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">rddIJV</span> <span class="k">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">parallelize</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span><span class="s">"1 1 1"</span><span class="o">,</span> <span class="s">"2 1 2"</span><span class="o">,</span> <span class="s">"1 2 3"</span><span class="o">,</span> <span class="s">"3 3 4"</span><span class="o">))</span>
<span class="n">rddIJV</span><span class="k">:</span> <span class="kt">org.apache.spark.rdd.RDD</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="nc">ParallelCollectionRDD</span><span class="o">[</span><span class="err">210</span><span class="o">]</span> <span class="n">at</span> <span class="n">parallelize</span> <span class="n">at</span> <span class="o">&lt;</span><span class="n">console</span><span class="k">&gt;:</span><span class="mi">38</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">mm4x4</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">MatrixMetadata</span><span class="o">(</span><span class="nc">MatrixFormat</span><span class="o">.</span><span class="nc">IJV</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">4</span><span class="o">)</span>
<span class="n">mm4x4</span><span class="k">:</span> <span class="kt">org.apache.sysml.api.mlcontext.MatrixMetadata</span> <span class="o">=</span> <span class="n">rows</span><span class="k">:</span> <span class="err">4</span><span class="o">,</span> <span class="n">columns</span><span class="k">:</span> <span class="err">4</span><span class="o">,</span> <span class="n">non</span><span class="o">-</span><span class="n">zeros</span><span class="k">:</span> <span class="kt">None</span><span class="o">,</span> <span class="n">rows</span> <span class="n">per</span> <span class="n">block</span><span class="k">:</span> <span class="kt">None</span><span class="o">,</span> <span class="n">columns</span> <span class="n">per</span> <span class="n">block</span><span class="k">:</span> <span class="kt">None</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">sumAndMean</span> <span class="k">=</span> <span class="n">dml</span><span class="o">(</span><span class="s">"sum = sum(m); mean = mean(m)"</span><span class="o">).</span><span class="n">in</span><span class="o">(</span><span class="s">"m"</span><span class="o">,</span> <span class="n">rddIJV</span><span class="o">,</span> <span class="n">mm4x4</span><span class="o">).</span><span class="n">out</span><span class="o">(</span><span class="s">"sum"</span><span class="o">,</span> <span class="s">"mean"</span><span class="o">)</span>
<span class="n">sumAndMean</span><span class="k">:</span> <span class="kt">org.apache.sysml.api.mlcontext.Script</span> <span class="o">=</span>
<span class="nc">Inputs</span><span class="k">:</span>
  <span class="err">[1]</span> <span class="o">(</span><span class="kt">RDD</span><span class="o">)</span> <span class="kt">m:</span> <span class="kt">ParallelCollectionRDD</span><span class="o">[</span><span class="err">210</span><span class="o">]</span> <span class="n">at</span> <span class="n">parallelize</span> <span class="n">at</span> <span class="o">&lt;</span><span class="n">console</span><span class="k">&gt;:</span><span class="mi">38</span>

<span class="nc">Outputs</span><span class="k">:</span>
  <span class="err">[1]</span> <span class="kt">sum</span>
  <span class="o">[</span><span class="err">2</span><span class="o">]</span> <span class="n">mean</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="n">ml</span><span class="o">.</span><span class="n">execute</span><span class="o">(</span><span class="n">sumAndMean</span><span class="o">)</span>
<span class="n">res22</span><span class="k">:</span> <span class="kt">org.apache.sysml.api.mlcontext.MLResults</span> <span class="o">=</span>
  <span class="o">[</span><span class="err">1</span><span class="o">]</span> <span class="o">(</span><span class="nc">Double</span><span class="o">)</span> <span class="n">sum</span><span class="k">:</span> <span class="err">10</span><span class="kt">.</span><span class="err">0</span>
  <span class="err">[2]</span> <span class="o">(</span><span class="kt">Double</span><span class="o">)</span> <span class="kt">mean:</span> <span class="err">0</span><span class="kt">.</span><span class="err">625</span></code></pre></figure>

  </div>

</div>

<h2 id="matrix-data-conversions-and-performance">Matrix Data Conversions and Performance</h2>

<p>Internally, Apache SystemML uses a binary-block matrix representation, where a matrix is
represented as a grouping of blocks. Each block is equal in size to the other blocks in the matrix and
consists of a number of rows and columns. The default block size is 1,000 rows by 1,000
columns.</p>

<p>Conversion of a large set of data to a SystemML matrix representation can potentially be time-consuming.
Therefore, if you use a set of data multiple times, one way to potentially improve performance is
to convert it to a SystemML matrix representation and then use this representation rather than performing
the data conversion each time.</p>

<p>There are currently two mechanisms for this in SystemML: <strong>(1) BinaryBlockMatrix</strong> and <strong>(2) Matrix</strong>.</p>

<p><strong>BinaryBlockMatrix:</strong></p>

<p>If you have an input DataFrame, it can be converted to a BinaryBlockMatrix, and this BinaryBlockMatrix
can be passed as an input rather than passing in the DataFrame as an input.</p>

<p>For example, suppose we had a 10000x1000 matrix represented as a DataFrame, as we saw in an earlier example.
Now suppose we create two Script objects with the DataFrame as an input, as shown below. In the Spark Shell,
when executing this code, you can see that each of the two Script object creations requires the
time-consuming data conversion step.</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">import</span> <span class="nn">org.apache.spark.sql._</span>
<span class="k">import</span> <span class="nn">org.apache.spark.sql.types.</span><span class="o">{</span><span class="nc">StructType</span><span class="o">,</span><span class="nc">StructField</span><span class="o">,</span><span class="nc">DoubleType</span><span class="o">}</span>
<span class="k">import</span> <span class="nn">scala.util.Random</span>
<span class="k">val</span> <span class="n">numRows</span> <span class="k">=</span> <span class="mi">10000</span>
<span class="k">val</span> <span class="n">numCols</span> <span class="k">=</span> <span class="mi">1000</span>
<span class="k">val</span> <span class="n">data</span> <span class="k">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">parallelize</span><span class="o">(</span><span class="mi">0</span> <span class="n">to</span> <span class="n">numRows</span><span class="o">-</span><span class="mi">1</span><span class="o">).</span><span class="n">map</span> <span class="o">{</span> <span class="k">_</span> <span class="k">=&gt;</span> <span class="nc">Row</span><span class="o">.</span><span class="n">fromSeq</span><span class="o">(</span><span class="nc">Seq</span><span class="o">.</span><span class="n">fill</span><span class="o">(</span><span class="n">numCols</span><span class="o">)(</span><span class="nc">Random</span><span class="o">.</span><span class="n">nextDouble</span><span class="o">))</span> <span class="o">}</span>
<span class="k">val</span> <span class="n">schema</span> <span class="k">=</span> <span class="nc">StructType</span><span class="o">((</span><span class="mi">0</span> <span class="n">to</span> <span class="n">numCols</span><span class="o">-</span><span class="mi">1</span><span class="o">).</span><span class="n">map</span> <span class="o">{</span> <span class="n">i</span> <span class="k">=&gt;</span> <span class="nc">StructField</span><span class="o">(</span><span class="s">"C"</span> <span class="o">+</span> <span class="n">i</span><span class="o">,</span> <span class="nc">DoubleType</span><span class="o">,</span> <span class="kc">true</span><span class="o">)</span> <span class="o">}</span> <span class="o">)</span>
<span class="k">val</span> <span class="n">df</span> <span class="k">=</span> <span class="n">sqlContext</span><span class="o">.</span><span class="n">createDataFrame</span><span class="o">(</span><span class="n">data</span><span class="o">,</span> <span class="n">schema</span><span class="o">)</span>
<span class="k">val</span> <span class="n">mm</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">MatrixMetadata</span><span class="o">(</span><span class="n">numRows</span><span class="o">,</span> <span class="n">numCols</span><span class="o">)</span>
<span class="k">val</span> <span class="n">minMaxMeanScript</span> <span class="k">=</span> <span class="n">dml</span><span class="o">(</span><span class="n">minMaxMean</span><span class="o">).</span><span class="n">in</span><span class="o">(</span><span class="s">"Xin"</span><span class="o">,</span> <span class="n">df</span><span class="o">,</span> <span class="n">mm</span><span class="o">).</span><span class="n">out</span><span class="o">(</span><span class="s">"minOut"</span><span class="o">,</span> <span class="s">"maxOut"</span><span class="o">,</span> <span class="s">"meanOut"</span><span class="o">)</span>
<span class="k">val</span> <span class="n">minMaxMeanScript</span> <span class="k">=</span> <span class="n">dml</span><span class="o">(</span><span class="n">minMaxMean</span><span class="o">).</span><span class="n">in</span><span class="o">(</span><span class="s">"Xin"</span><span class="o">,</span> <span class="n">df</span><span class="o">,</span> <span class="n">mm</span><span class="o">).</span><span class="n">out</span><span class="o">(</span><span class="s">"minOut"</span><span class="o">,</span> <span class="s">"maxOut"</span><span class="o">,</span> <span class="s">"meanOut"</span><span class="o">)</span></code></pre></figure>

<p>Rather than passing in a DataFrame each time to the Script object creation, let&#8217;s instead create a
BinaryBlockMatrix object based on the DataFrame and pass this BinaryBlockMatrix to the Script object
creation. If we run the code below in the Spark Shell, we see that the data conversion step occurs
when the BinaryBlockMatrix object is created. However, when we create a Script object twice, we see
that no conversion penalty occurs, since this conversion occurred when the BinaryBlockMatrix was
created.</p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">import</span> <span class="nn">org.apache.spark.sql._</span>
<span class="k">import</span> <span class="nn">org.apache.spark.sql.types.</span><span class="o">{</span><span class="nc">StructType</span><span class="o">,</span><span class="nc">StructField</span><span class="o">,</span><span class="nc">DoubleType</span><span class="o">}</span>
<span class="k">import</span> <span class="nn">scala.util.Random</span>
<span class="k">val</span> <span class="n">numRows</span> <span class="k">=</span> <span class="mi">10000</span>
<span class="k">val</span> <span class="n">numCols</span> <span class="k">=</span> <span class="mi">1000</span>
<span class="k">val</span> <span class="n">data</span> <span class="k">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">parallelize</span><span class="o">(</span><span class="mi">0</span> <span class="n">to</span> <span class="n">numRows</span><span class="o">-</span><span class="mi">1</span><span class="o">).</span><span class="n">map</span> <span class="o">{</span> <span class="k">_</span> <span class="k">=&gt;</span> <span class="nc">Row</span><span class="o">.</span><span class="n">fromSeq</span><span class="o">(</span><span class="nc">Seq</span><span class="o">.</span><span class="n">fill</span><span class="o">(</span><span class="n">numCols</span><span class="o">)(</span><span class="nc">Random</span><span class="o">.</span><span class="n">nextDouble</span><span class="o">))</span> <span class="o">}</span>
<span class="k">val</span> <span class="n">schema</span> <span class="k">=</span> <span class="nc">StructType</span><span class="o">((</span><span class="mi">0</span> <span class="n">to</span> <span class="n">numCols</span><span class="o">-</span><span class="mi">1</span><span class="o">).</span><span class="n">map</span> <span class="o">{</span> <span class="n">i</span> <span class="k">=&gt;</span> <span class="nc">StructField</span><span class="o">(</span><span class="s">"C"</span> <span class="o">+</span> <span class="n">i</span><span class="o">,</span> <span class="nc">DoubleType</span><span class="o">,</span> <span class="kc">true</span><span class="o">)</span> <span class="o">}</span> <span class="o">)</span>
<span class="k">val</span> <span class="n">df</span> <span class="k">=</span> <span class="n">sqlContext</span><span class="o">.</span><span class="n">createDataFrame</span><span class="o">(</span><span class="n">data</span><span class="o">,</span> <span class="n">schema</span><span class="o">)</span>
<span class="k">val</span> <span class="n">mm</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">MatrixMetadata</span><span class="o">(</span><span class="n">numRows</span><span class="o">,</span> <span class="n">numCols</span><span class="o">)</span>
<span class="k">val</span> <span class="n">bbm</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">BinaryBlockMatrix</span><span class="o">(</span><span class="n">df</span><span class="o">,</span> <span class="n">mm</span><span class="o">)</span>
<span class="k">val</span> <span class="n">minMaxMeanScript</span> <span class="k">=</span> <span class="n">dml</span><span class="o">(</span><span class="n">minMaxMean</span><span class="o">).</span><span class="n">in</span><span class="o">(</span><span class="s">"Xin"</span><span class="o">,</span> <span class="n">bbm</span><span class="o">).</span><span class="n">out</span><span class="o">(</span><span class="s">"minOut"</span><span class="o">,</span> <span class="s">"maxOut"</span><span class="o">,</span> <span class="s">"meanOut"</span><span class="o">)</span>
<span class="k">val</span> <span class="n">minMaxMeanScript</span> <span class="k">=</span> <span class="n">dml</span><span class="o">(</span><span class="n">minMaxMean</span><span class="o">).</span><span class="n">in</span><span class="o">(</span><span class="s">"Xin"</span><span class="o">,</span> <span class="n">bbm</span><span class="o">).</span><span class="n">out</span><span class="o">(</span><span class="s">"minOut"</span><span class="o">,</span> <span class="s">"maxOut"</span><span class="o">,</span> <span class="s">"meanOut"</span><span class="o">)</span></code></pre></figure>

<p><strong>Matrix:</strong></p>

<p>When a matrix is returned as an output, it is returned as a Matrix object, which is a wrapper around
a SystemML MatrixObject. As a result, an output Matrix is already in a SystemML representation,
meaning that it can be passed as an input with no data conversion penalty.</p>

<p>As an example, here we read in matrix <code class="highlighter-rouge">x</code> as an RDD in CSV format. We create a Script that adds one to all
values in the matrix. We obtain the resulting matrix <code class="highlighter-rouge">y</code> as a Matrix. We execute the
script five times, feeding the output matrix as the input matrix for the next script execution.</p>

<div class="codetabs">

<div data-lang="Scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">rddCSV</span> <span class="k">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">parallelize</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span><span class="s">"1.0,2.0"</span><span class="o">,</span> <span class="s">"3.0,4.0"</span><span class="o">))</span>
<span class="k">val</span> <span class="n">add</span> <span class="k">=</span> <span class="n">dml</span><span class="o">(</span><span class="s">"y = x + 1"</span><span class="o">).</span><span class="n">in</span><span class="o">(</span><span class="s">"x"</span><span class="o">,</span> <span class="n">rddCSV</span><span class="o">).</span><span class="n">out</span><span class="o">(</span><span class="s">"y"</span><span class="o">)</span>
<span class="k">for</span> <span class="o">(</span><span class="n">i</span> <span class="k">&lt;-</span> <span class="mi">1</span> <span class="n">to</span> <span class="mi">5</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">println</span><span class="o">(</span><span class="s">"#"</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="s">":"</span><span class="o">);</span>
  <span class="k">val</span> <span class="n">m</span> <span class="k">=</span> <span class="n">ml</span><span class="o">.</span><span class="n">execute</span><span class="o">(</span><span class="n">add</span><span class="o">).</span><span class="n">getMatrix</span><span class="o">(</span><span class="s">"y"</span><span class="o">)</span>
  <span class="n">m</span><span class="o">.</span><span class="n">toRDDStringCSV</span><span class="o">.</span><span class="n">collect</span><span class="o">.</span><span class="n">foreach</span><span class="o">(</span><span class="n">println</span><span class="o">)</span>
  <span class="n">add</span><span class="o">.</span><span class="n">in</span><span class="o">(</span><span class="s">"x"</span><span class="o">,</span> <span class="n">m</span><span class="o">)</span>
<span class="o">}</span></code></pre></figure>

  </div>

<div data-lang="Spark Shell">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">rddCSV</span> <span class="k">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">parallelize</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span><span class="s">"1.0,2.0"</span><span class="o">,</span> <span class="s">"3.0,4.0"</span><span class="o">))</span>
<span class="n">rddCSV</span><span class="k">:</span> <span class="kt">org.apache.spark.rdd.RDD</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="nc">ParallelCollectionRDD</span><span class="o">[</span><span class="err">341</span><span class="o">]</span> <span class="n">at</span> <span class="n">parallelize</span> <span class="n">at</span> <span class="o">&lt;</span><span class="n">console</span><span class="k">&gt;:</span><span class="mi">53</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">add</span> <span class="k">=</span> <span class="n">dml</span><span class="o">(</span><span class="s">"y = x + 1"</span><span class="o">).</span><span class="n">in</span><span class="o">(</span><span class="s">"x"</span><span class="o">,</span> <span class="n">rddCSV</span><span class="o">).</span><span class="n">out</span><span class="o">(</span><span class="s">"y"</span><span class="o">)</span>
<span class="n">add</span><span class="k">:</span> <span class="kt">org.apache.sysml.api.mlcontext.Script</span> <span class="o">=</span>
<span class="nc">Inputs</span><span class="k">:</span>
  <span class="err">[1]</span> <span class="o">(</span><span class="kt">RDD</span><span class="o">)</span> <span class="kt">x:</span> <span class="kt">ParallelCollectionRDD</span><span class="o">[</span><span class="err">341</span><span class="o">]</span> <span class="n">at</span> <span class="n">parallelize</span> <span class="n">at</span> <span class="o">&lt;</span><span class="n">console</span><span class="k">&gt;:</span><span class="mi">53</span>

<span class="nc">Outputs</span><span class="k">:</span>
  <span class="err">[1]</span> <span class="kt">y</span>


<span class="n">scala</span><span class="o">&gt;</span> <span class="k">for</span> <span class="o">(</span><span class="n">i</span> <span class="k">&lt;-</span> <span class="mi">1</span> <span class="n">to</span> <span class="mi">5</span><span class="o">)</span> <span class="o">{</span>
     <span class="o">|</span>   <span class="n">println</span><span class="o">(</span><span class="s">"#"</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="s">":"</span><span class="o">);</span>
     <span class="o">|</span>   <span class="k">val</span> <span class="n">m</span> <span class="k">=</span> <span class="n">ml</span><span class="o">.</span><span class="n">execute</span><span class="o">(</span><span class="n">add</span><span class="o">).</span><span class="n">getMatrix</span><span class="o">(</span><span class="s">"y"</span><span class="o">)</span>
     <span class="o">|</span>   <span class="n">m</span><span class="o">.</span><span class="n">toRDDStringCSV</span><span class="o">.</span><span class="n">collect</span><span class="o">.</span><span class="n">foreach</span><span class="o">(</span><span class="n">println</span><span class="o">)</span>
     <span class="o">|</span>   <span class="n">add</span><span class="o">.</span><span class="n">in</span><span class="o">(</span><span class="s">"x"</span><span class="o">,</span> <span class="n">m</span><span class="o">)</span>
     <span class="o">|</span> <span class="o">}</span>
<span class="k">#</span><span class="mi">1</span><span class="k">:</span>
<span class="err">2</span><span class="kt">.</span><span class="err">0</span><span class="o">,</span><span class="mf">3.0</span>
<span class="mf">4.0</span><span class="o">,</span><span class="mf">5.0</span>
<span class="k">#</span><span class="mi">2</span><span class="k">:</span>
<span class="err">3</span><span class="kt">.</span><span class="err">0</span><span class="o">,</span><span class="mf">4.0</span>
<span class="mf">5.0</span><span class="o">,</span><span class="mf">6.0</span>
<span class="k">#</span><span class="mi">3</span><span class="k">:</span>
<span class="err">4</span><span class="kt">.</span><span class="err">0</span><span class="o">,</span><span class="mf">5.0</span>
<span class="mf">6.0</span><span class="o">,</span><span class="mf">7.0</span>
<span class="k">#</span><span class="mi">4</span><span class="k">:</span>
<span class="err">5</span><span class="kt">.</span><span class="err">0</span><span class="o">,</span><span class="mf">6.0</span>
<span class="mf">7.0</span><span class="o">,</span><span class="mf">8.0</span>
<span class="k">#</span><span class="mi">5</span><span class="k">:</span>
<span class="err">6</span><span class="kt">.</span><span class="err">0</span><span class="o">,</span><span class="mf">7.0</span>
<span class="mf">8.0</span><span class="o">,</span><span class="mf">9.0</span></code></pre></figure>

  </div>

</div>

<hr />

<h1 id="jupyter-pyspark-notebook-example---poisson-nonnegative-matrix-factorization">Jupyter (PySpark) Notebook Example - Poisson Nonnegative Matrix Factorization</h1>

<p>Similar to the Scala API, SystemML also provides a Python MLContext API.  Before usage, you&#8217;ll need
<strong><a href="beginners-guide-python#download--setup">to install it first</a></strong>.</p>

<p>Here, we&#8217;ll explore the use of SystemML via PySpark in a <a href="http://jupyter.org/">Jupyter notebook</a>.
This Jupyter notebook example can be nicely viewed in a rendered state
<a href="https://github.com/apache/incubator-systemml/blob/master/samples/jupyter-notebooks/SystemML-PySpark-Recommendation-Demo.ipynb">on GitHub</a>,
and can be <a href="https://raw.githubusercontent.com/apache/incubator-systemml/master/samples/jupyter-notebooks/SystemML-PySpark-Recommendation-Demo.ipynb">downloaded here</a> to a directory of your choice.</p>

<p>From the directory with the downloaded notebook, start Jupyter with PySpark:</p>

<div class="codetabs">
<div data-lang="Python 2">
    <div class="highlighter-rouge"><pre class="highlight"><code><span class="nv">PYSPARK_DRIVER_PYTHON</span><span class="o">=</span>jupyter <span class="nv">PYSPARK_DRIVER_PYTHON_OPTS</span><span class="o">=</span><span class="s2">"notebook"</span> pyspark
</code></pre>
    </div>
  </div>
<div data-lang="Python 3">
    <div class="highlighter-rouge"><pre class="highlight"><code><span class="nv">PYSPARK_PYTHON</span><span class="o">=</span>python3 <span class="nv">PYSPARK_DRIVER_PYTHON</span><span class="o">=</span>jupyter <span class="nv">PYSPARK_DRIVER_PYTHON_OPTS</span><span class="o">=</span><span class="s2">"notebook"</span> pyspark
</code></pre>
    </div>
  </div>
</div>

<p>This will open Jupyter in a browser:</p>

<p><img src="img/spark-mlcontext-programming-guide/jupyter1.png" alt="Jupyter Notebook" title="Jupyter Notebook" /></p>

<p>We can then open up the <code class="highlighter-rouge">SystemML-PySpark-Recommendation-Demo</code> notebook.</p>

<h2 id="set-up-the-notebook-and-download-the-data">Set up the notebook and download the data</h2>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="o">%</span><span class="n">load_ext</span> <span class="n">autoreload</span>
<span class="o">%</span><span class="n">autoreload</span> <span class="mi">2</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">systemml</span> <span class="kn">import</span> <span class="n">MLContext</span><span class="p">,</span> <span class="n">dml</span>  <span class="c"># pip install systeml</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">'figure.figsize'</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="o">%%</span><span class="n">sh</span>
<span class="c"># Download dataset</span>
<span class="n">curl</span> <span class="o">-</span><span class="n">O</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">snap</span><span class="o">.</span><span class="n">stanford</span><span class="o">.</span><span class="n">edu</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">amazon0601</span><span class="o">.</span><span class="n">txt</span><span class="o">.</span><span class="n">gz</span>
<span class="n">gunzip</span> <span class="n">amazon0601</span><span class="o">.</span><span class="n">txt</span><span class="o">.</span><span class="n">gz</span></code></pre></figure>

<h2 id="use-pyspark-to-load-the-data-in-as-a-spark-dataframe">Use PySpark to load the data in as a Spark DataFrame</h2>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># Load data</span>
<span class="kn">import</span> <span class="nn">pyspark.sql.functions</span> <span class="kn">as</span> <span class="nn">F</span>
<span class="n">dataPath</span> <span class="o">=</span> <span class="s">"amazon0601.txt"</span>

<span class="n">X_train</span> <span class="o">=</span> <span class="p">(</span><span class="n">sc</span><span class="o">.</span><span class="n">textFile</span><span class="p">(</span><span class="n">dataPath</span><span class="p">)</span>
    <span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="ow">not</span> <span class="n">l</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">"#"</span><span class="p">))</span>
    <span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="n">l</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">"</span><span class="se">\t</span><span class="s">"</span><span class="p">))</span>
    <span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">prods</span><span class="p">:</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">prods</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">prods</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="mf">1.0</span><span class="p">))</span>
    <span class="o">.</span><span class="n">toDF</span><span class="p">((</span><span class="s">"prod_i"</span><span class="p">,</span> <span class="s">"prod_j"</span><span class="p">,</span> <span class="s">"x_ij"</span><span class="p">))</span>
    <span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="s">"prod_i &lt; 500 AND prod_j &lt; 500"</span><span class="p">)</span> <span class="c"># Filter for memory constraints</span>
    <span class="o">.</span><span class="n">cache</span><span class="p">())</span>

<span class="n">max_prod_i</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="nb">max</span><span class="p">(</span><span class="s">"prod_i"</span><span class="p">))</span><span class="o">.</span><span class="n">first</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">max_prod_j</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="nb">max</span><span class="p">(</span><span class="s">"prod_j"</span><span class="p">))</span><span class="o">.</span><span class="n">first</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">numProducts</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_prod_i</span><span class="p">,</span> <span class="n">max_prod_j</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="c"># 0-based indexing</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Total number of products: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">numProducts</span><span class="p">))</span></code></pre></figure>

<h2 id="create-a-systemml-mlcontext-object">Create a SystemML MLContext object</h2>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># Create SystemML MLContext</span>
<span class="n">ml</span> <span class="o">=</span> <span class="n">MLContext</span><span class="p">(</span><span class="n">sc</span><span class="p">)</span></code></pre></figure>

<h2 id="define-a-kernel-for-poisson-nonnegative-matrix-factorization-pnmf-in-dml">Define a kernel for Poisson nonnegative matrix factorization (PNMF) in DML</h2>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># Define PNMF kernel in SystemML's DSL using the R-like syntax for PNMF</span>
<span class="n">pnmf</span> <span class="o">=</span> <span class="s">"""
# data &amp; args
X = X+1 # change product IDs to be 1-based, rather than 0-based
V = table(X[,1], X[,2])
size = ifdef($size, -1)
if(size &gt; -1) {
    V = V[1:size,1:size]
}

n = nrow(V)
m = ncol(V)
range = 0.01
W = Rand(rows=n, cols=rank, min=0, max=range, pdf="uniform")
H = Rand(rows=rank, cols=m, min=0, max=range, pdf="uniform")
losses = matrix(0, rows=max_iter, cols=1)

# run PNMF
i=1
while(i &lt;= max_iter) {
  # update params
  H = (H * (t(W) </span><span class="si">%*% </span><span class="s">(V/(W</span><span class="si">%*%</span><span class="s">H))))/t(colSums(W))
  W = (W * ((V/(W</span><span class="si">%*%</span><span class="s">H)) </span><span class="si">%*% </span><span class="s">t(H)))/t(rowSums(H))

  # compute loss
  losses[i,] = -1 * (sum(V*log(W</span><span class="si">%*%</span><span class="s">H)) - as.scalar(colSums(W)</span><span class="si">%*%</span><span class="s">rowSums(H)))
  i = i + 1;
}
"""</span></code></pre></figure>

<h2 id="execute-the-algorithm">Execute the algorithm</h2>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># Run the PNMF script on SystemML with Spark</span>
<span class="n">script</span> <span class="o">=</span> <span class="n">dml</span><span class="p">(</span><span class="n">pnmf</span><span class="p">)</span><span class="o">.</span><span class="nb">input</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X_train</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">rank</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="s">"W"</span><span class="p">,</span> <span class="s">"H"</span><span class="p">,</span> <span class="s">"losses"</span><span class="p">)</span>
<span class="n">W</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">losses</span> <span class="o">=</span> <span class="n">ml</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">script</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">"W"</span><span class="p">,</span> <span class="s">"H"</span><span class="p">,</span> <span class="s">"losses"</span><span class="p">)</span></code></pre></figure>

<h2 id="retrieve-the-losses-during-training-and-plot-them">Retrieve the losses during training and plot them</h2>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># Plot training loss over time</span>
<span class="n">xy</span> <span class="o">=</span> <span class="n">losses</span><span class="o">.</span><span class="n">toDF</span><span class="p">()</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="s">"__INDEX"</span><span class="p">)</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">xy</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">'Iteration'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">'Loss'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">'PNMF Training Loss'</span><span class="p">)</span></code></pre></figure>

<p><img src="img/spark-mlcontext-programming-guide/jupyter_loss_graph.png" alt="Jupyter Loss Graph" title="Jupyter Loss Graph" /></p>

<hr />

<h1 id="spark-shell-example---old-api">Spark Shell Example - OLD API</h1>

<h3 id="note-this-api-is-old-and-has-been-deprecated-">** <strong>NOTE: This API is old and has been deprecated.</strong> **</h3>
<p><strong>Please use the <a href="spark-mlcontext-programming-guide#spark-shell-example">new MLContext API</a> instead.</strong></p>

<h2 id="start-spark-shell-with-systemml-1">Start Spark Shell with SystemML</h2>

<p>To use SystemML with the Spark Shell, the SystemML jar can be referenced using the Spark Shell&#8217;s <code class="highlighter-rouge">--jars</code> option.
Instructions to build the SystemML jar can be found in the <a href="https://github.com/apache/incubator-systemml">SystemML GitHub README</a>.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">./bin/spark-shell --executor-memory 4G --driver-memory 4G --jars SystemML.jar</code></pre></figure>

<p>Here is an example of Spark Shell with SystemML and YARN.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">./bin/spark-shell --master yarn-client --num-executors 3 --driver-memory 5G --executor-memory 5G --executor-cores 4 --jars SystemML.jar</code></pre></figure>

<h2 id="create-mlcontext-1">Create MLContext</h2>

<p>An <code class="highlighter-rouge">MLContext</code> object can be created by passing its constructor a reference to the <code class="highlighter-rouge">SparkContext</code>.</p>

<div class="codetabs">

<div data-lang="Spark Shell">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="n">scala</span><span class="o">&gt;</span><span class="k">import</span> <span class="nn">org.apache.sysml.api.MLContext</span>
<span class="k">import</span> <span class="nn">org.apache.sysml.api.MLContext</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">ml</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">MLContext</span><span class="o">(</span><span class="n">sc</span><span class="o">)</span>
<span class="n">ml</span><span class="k">:</span> <span class="kt">org.apache.sysml.api.MLContext</span> <span class="o">=</span> <span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">sysml</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="nc">MLContext</span><span class="k">@</span><span class="mi">33</span><span class="n">e38c6b</span></code></pre></figure>

  </div>

<div data-lang="Statements">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">import</span> <span class="nn">org.apache.sysml.api.MLContext</span>
<span class="k">val</span> <span class="n">ml</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">MLContext</span><span class="o">(</span><span class="n">sc</span><span class="o">)</span></code></pre></figure>

  </div>

</div>

<h2 id="create-dataframe">Create DataFrame</h2>

<p>For demonstration purposes, we&#8217;ll create a <code class="highlighter-rouge">DataFrame</code> consisting of 100,000 rows and 1,000 columns
of random <code class="highlighter-rouge">double</code>s.</p>

<div class="codetabs">

<div data-lang="Spark Shell">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="n">scala</span><span class="o">&gt;</span> <span class="k">import</span> <span class="nn">org.apache.spark.sql._</span>
<span class="k">import</span> <span class="nn">org.apache.spark.sql._</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">import</span> <span class="nn">org.apache.spark.sql.types.</span><span class="o">{</span><span class="nc">StructType</span><span class="o">,</span><span class="nc">StructField</span><span class="o">,</span><span class="nc">DoubleType</span><span class="o">}</span>
<span class="k">import</span> <span class="nn">org.apache.spark.sql.types.</span><span class="o">{</span><span class="nc">StructType</span><span class="o">,</span> <span class="nc">StructField</span><span class="o">,</span> <span class="nc">DoubleType</span><span class="o">}</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">import</span> <span class="nn">scala.util.Random</span>
<span class="k">import</span> <span class="nn">scala.util.Random</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">numRows</span> <span class="k">=</span> <span class="mi">100000</span>
<span class="n">numRows</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">100000</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">numCols</span> <span class="k">=</span> <span class="mi">1000</span>
<span class="n">numCols</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">1000</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">data</span> <span class="k">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">parallelize</span><span class="o">(</span><span class="mi">0</span> <span class="n">to</span> <span class="n">numRows</span><span class="o">-</span><span class="mi">1</span><span class="o">).</span><span class="n">map</span> <span class="o">{</span> <span class="k">_</span> <span class="k">=&gt;</span> <span class="nc">Row</span><span class="o">.</span><span class="n">fromSeq</span><span class="o">(</span><span class="nc">Seq</span><span class="o">.</span><span class="n">fill</span><span class="o">(</span><span class="n">numCols</span><span class="o">)(</span><span class="nc">Random</span><span class="o">.</span><span class="n">nextDouble</span><span class="o">))</span> <span class="o">}</span>
<span class="n">data</span><span class="k">:</span> <span class="kt">org.apache.spark.rdd.RDD</span><span class="o">[</span><span class="kt">org.apache.spark.sql.Row</span><span class="o">]</span> <span class="k">=</span> <span class="nc">MapPartitionsRDD</span><span class="o">[</span><span class="err">1</span><span class="o">]</span> <span class="n">at</span> <span class="n">map</span> <span class="n">at</span> <span class="o">&lt;</span><span class="n">console</span><span class="k">&gt;:</span><span class="mi">33</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">schema</span> <span class="k">=</span> <span class="nc">StructType</span><span class="o">((</span><span class="mi">0</span> <span class="n">to</span> <span class="n">numCols</span><span class="o">-</span><span class="mi">1</span><span class="o">).</span><span class="n">map</span> <span class="o">{</span> <span class="n">i</span> <span class="k">=&gt;</span> <span class="nc">StructField</span><span class="o">(</span><span class="s">"C"</span> <span class="o">+</span> <span class="n">i</span><span class="o">,</span> <span class="nc">DoubleType</span><span class="o">,</span> <span class="kc">true</span><span class="o">)</span> <span class="o">}</span> <span class="o">)</span>
<span class="n">schema</span><span class="k">:</span> <span class="kt">org.apache.spark.sql.</span><span class="k">type</span><span class="kt">s.StructType</span> <span class="o">=</span> <span class="nc">StructType</span><span class="o">(</span><span class="nc">StructField</span><span class="o">(</span><span class="n">C0</span><span class="o">,</span><span class="nc">DoubleType</span><span class="o">,</span><span class="kc">true</span><span class="o">),</span> <span class="nc">StructField</span><span class="o">(</span><span class="n">C1</span><span class="o">,</span><span class="nc">DoubleType</span><span class="o">,</span><span class="kc">true</span><span class="o">),</span> <span class="nc">StructField</span><span class="o">(</span><span class="n">C2</span><span class="o">,</span><span class="nc">DoubleType</span><span class="o">,</span><span class="kc">true</span><span class="o">),</span> <span class="nc">StructField</span><span class="o">(</span><span class="n">C3</span><span class="o">,</span><span class="nc">DoubleType</span><span class="o">,</span><span class="kc">true</span><span class="o">),</span> <span class="nc">StructField</span><span class="o">(</span><span class="n">C4</span><span class="o">,</span><span class="nc">DoubleType</span><span class="o">,</span><span class="kc">true</span><span class="o">),</span> <span class="nc">StructField</span><span class="o">(</span><span class="n">C5</span><span class="o">,</span><span class="nc">DoubleType</span><span class="o">,</span><span class="kc">true</span><span class="o">),</span> <span class="nc">StructField</span><span class="o">(</span><span class="n">C6</span><span class="o">,</span><span class="nc">DoubleType</span><span class="o">,</span><span class="kc">true</span><span class="o">),</span> <span class="nc">StructField</span><span class="o">(</span><span class="n">C7</span><span class="o">,</span><span class="nc">DoubleType</span><span class="o">,</span><span class="kc">true</span><span class="o">),</span> <span class="nc">StructField</span><span class="o">(</span><span class="n">C8</span><span class="o">,</span><span class="nc">DoubleType</span><span class="o">,</span><span class="kc">true</span><span class="o">),</span> <span class="nc">StructField</span><span class="o">(</span><span class="n">C9</span><span class="o">,</span><span class="nc">DoubleType</span><span class="o">,</span><span class="kc">true</span><span class="o">),</span> <span class="nc">StructField</span><span class="o">(</span><span class="n">C10</span><span class="o">,</span><span class="nc">DoubleType</span><span class="o">,</span><span class="kc">true</span><span class="o">),</span> <span class="nc">StructField</span><span class="o">(</span><span class="n">C11</span><span class="o">,</span><span class="nc">DoubleType</span><span class="o">,</span><span class="kc">true</span><span class="o">),</span> <span class="nc">StructField</span><span class="o">(</span><span class="n">C12</span><span class="o">,</span><span class="nc">DoubleType</span><span class="o">,</span><span class="kc">true</span><span class="o">),</span> <span class="nc">StructField</span><span class="o">(</span><span class="n">C13</span><span class="o">,</span><span class="nc">DoubleType</span><span class="o">,</span><span class="kc">true</span><span class="o">),</span> <span class="nc">StructField</span><span class="o">(</span><span class="n">C14</span><span class="o">,</span><span class="nc">DoubleType</span><span class="o">,</span><span class="kc">true</span><span class="o">),</span> <span class="nc">StructField</span><span class="o">(</span><span class="n">C15</span><span class="o">,</span><span class="nc">DoubleType</span><span class="o">,</span><span class="kc">true</span><span class="o">),</span> <span class="nc">StructField</span><span class="o">(</span><span class="n">C16</span><span class="o">,</span><span class="nc">DoubleType</span><span class="o">,</span><span class="kc">true</span><span class="o">),</span> <span class="nc">StructField</span><span class="o">(</span><span class="n">C17</span><span class="o">,</span><span class="nc">DoubleType</span><span class="o">,</span><span class="kc">true</span><span class="o">),</span> <span class="nc">StructField</span><span class="o">(</span><span class="n">C18</span><span class="o">,</span><span class="nc">DoubleType</span><span class="o">,</span><span class="kc">true</span><span class="o">),</span> <span class="nc">StructField</span><span class="o">(</span><span class="n">C19</span><span class="o">,</span><span class="nc">DoubleType</span><span class="o">,</span><span class="kc">true</span><span class="o">),</span> <span class="nc">StructField</span><span class="o">(</span><span class="n">C20</span><span class="o">,</span><span class="nc">DoubleType</span><span class="o">,</span><span class="kc">true</span><span class="o">),</span> <span class="nc">StructField</span><span class="o">(</span><span class="n">C21</span><span class="o">,</span><span class="nc">DoubleType</span><span class="o">,</span><span class="kc">true</span><span class="o">),</span> <span class="o">...</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">df</span> <span class="k">=</span> <span class="n">sqlContext</span><span class="o">.</span><span class="n">createDataFrame</span><span class="o">(</span><span class="n">data</span><span class="o">,</span> <span class="n">schema</span><span class="o">)</span>
<span class="n">df</span><span class="k">:</span> <span class="kt">org.apache.spark.sql.DataFrame</span> <span class="o">=</span> <span class="o">[</span><span class="kt">C0:</span> <span class="kt">double</span>, <span class="kt">C1:</span> <span class="kt">double</span>, <span class="kt">C2:</span> <span class="kt">double</span>, <span class="kt">C3:</span> <span class="kt">double</span>, <span class="kt">C4:</span> <span class="kt">double</span>, <span class="kt">C5:</span> <span class="kt">double</span>, <span class="kt">C6:</span> <span class="kt">double</span>, <span class="kt">C7:</span> <span class="kt">double</span>, <span class="kt">C8:</span> <span class="kt">double</span>, <span class="kt">C9:</span> <span class="kt">double</span>, <span class="kt">C10:</span> <span class="kt">double</span>, <span class="kt">C11:</span> <span class="kt">double</span>, <span class="kt">C12:</span> <span class="kt">double</span>, <span class="kt">C13:</span> <span class="kt">double</span>, <span class="kt">C14:</span> <span class="kt">double</span>, <span class="kt">C15:</span> <span class="kt">double</span>, <span class="kt">C16:</span> <span class="kt">double</span>, <span class="kt">C17:</span> <span class="kt">double</span>, <span class="kt">C18:</span> <span class="kt">double</span>, <span class="kt">C19:</span> <span class="kt">double</span>, <span class="kt">C20:</span> <span class="kt">double</span>, <span class="kt">C21:</span> <span class="kt">double</span>, <span class="kt">C22:</span> <span class="kt">double</span>, <span class="kt">C23:</span> <span class="kt">double</span>, <span class="kt">C24:</span> <span class="kt">double</span>, <span class="kt">C25:</span> <span class="kt">double</span>, <span class="kt">C26:</span> <span class="kt">double</span>, <span class="kt">C27:</span> <span class="kt">double</span>, <span class="kt">C28:</span> <span class="kt">double</span>, <span class="kt">C29:</span> <span class="kt">double</span>, <span class="kt">C30:</span> <span class="kt">double</span>, <span class="kt">C31:</span> <span class="kt">double</span>, <span class="kt">C32:</span> <span class="kt">double</span>, <span class="kt">C33:</span> <span class="kt">double</span>, <span class="kt">C34:</span> <span class="kt">double</span>, <span class="kt">C35:</span> <span class="kt">double</span>, <span class="kt">C36:</span> <span class="kt">double</span>, <span class="kt">C37:</span> <span class="kt">double</span>, <span class="kt">C38:</span> <span class="kt">double</span>, <span class="kt">C39:</span> <span class="kt">double</span>, <span class="kt">C40:</span> <span class="kt">double</span>, <span class="kt">C41:</span> <span class="kt">double</span>, <span class="kt">C42:</span> <span class="kt">double</span>, <span class="kt">C43:</span> <span class="kt">double</span>, <span class="kt">C44:</span> <span class="kt">double</span>, <span class="kt">C45:</span> <span class="kt">double</span>, <span class="kt">C46:</span> <span class="kt">double</span>, <span class="kt">C47:</span> <span class="kt">double</span>, <span class="kt">C48:</span> <span class="kt">double</span>, <span class="kt">C49:</span> <span class="kt">double</span>, <span class="kt">C50:</span> <span class="kt">double</span>, <span class="kt">C51:</span> <span class="kt">double</span>, <span class="kt">C52:</span> <span class="kt">double</span>, <span class="kt">C53:</span> <span class="kt">double</span>, <span class="kt">C54:</span> <span class="kt">double</span>, <span class="kt">C55:</span> <span class="kt">double</span>, <span class="kt">C56:</span> <span class="kt">double</span>, <span class="kt">C57:</span> <span class="kt">double</span>, <span class="kt">C58:</span> <span class="kt">double</span>, <span class="kt">C5...</span></code></pre></figure>

  </div>

<div data-lang="Statements">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">import</span> <span class="nn">org.apache.spark.sql._</span>
<span class="k">import</span> <span class="nn">org.apache.spark.sql.types.</span><span class="o">{</span><span class="nc">StructType</span><span class="o">,</span><span class="nc">StructField</span><span class="o">,</span><span class="nc">DoubleType</span><span class="o">}</span>
<span class="k">import</span> <span class="nn">scala.util.Random</span>
<span class="k">val</span> <span class="n">numRows</span> <span class="k">=</span> <span class="mi">100000</span>
<span class="k">val</span> <span class="n">numCols</span> <span class="k">=</span> <span class="mi">1000</span>
<span class="k">val</span> <span class="n">data</span> <span class="k">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">parallelize</span><span class="o">(</span><span class="mi">0</span> <span class="n">to</span> <span class="n">numRows</span><span class="o">-</span><span class="mi">1</span><span class="o">).</span><span class="n">map</span> <span class="o">{</span> <span class="k">_</span> <span class="k">=&gt;</span> <span class="nc">Row</span><span class="o">.</span><span class="n">fromSeq</span><span class="o">(</span><span class="nc">Seq</span><span class="o">.</span><span class="n">fill</span><span class="o">(</span><span class="n">numCols</span><span class="o">)(</span><span class="nc">Random</span><span class="o">.</span><span class="n">nextDouble</span><span class="o">))</span> <span class="o">}</span>
<span class="k">val</span> <span class="n">schema</span> <span class="k">=</span> <span class="nc">StructType</span><span class="o">((</span><span class="mi">0</span> <span class="n">to</span> <span class="n">numCols</span><span class="o">-</span><span class="mi">1</span><span class="o">).</span><span class="n">map</span> <span class="o">{</span> <span class="n">i</span> <span class="k">=&gt;</span> <span class="nc">StructField</span><span class="o">(</span><span class="s">"C"</span> <span class="o">+</span> <span class="n">i</span><span class="o">,</span> <span class="nc">DoubleType</span><span class="o">,</span> <span class="kc">true</span><span class="o">)</span> <span class="o">}</span> <span class="o">)</span>
<span class="k">val</span> <span class="n">df</span> <span class="k">=</span> <span class="n">sqlContext</span><span class="o">.</span><span class="n">createDataFrame</span><span class="o">(</span><span class="n">data</span><span class="o">,</span> <span class="n">schema</span><span class="o">)</span></code></pre></figure>

  </div>

</div>

<h2 id="helper-methods">Helper Methods</h2>

<p>For convenience, we&#8217;ll create some helper methods. The SystemML output data is encapsulated in
an <code class="highlighter-rouge">MLOutput</code> object. The <code class="highlighter-rouge">getScalar()</code> method extracts a scalar value from a <code class="highlighter-rouge">DataFrame</code> returned by
<code class="highlighter-rouge">MLOutput</code>. The <code class="highlighter-rouge">getScalarDouble()</code> method returns such a value as a <code class="highlighter-rouge">Double</code>, and the
<code class="highlighter-rouge">getScalarInt()</code> method returns such a value as an <code class="highlighter-rouge">Int</code>.</p>

<div class="codetabs">

<div data-lang="Spark Shell">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="n">scala</span><span class="o">&gt;</span> <span class="k">import</span> <span class="nn">org.apache.sysml.api.MLOutput</span>
<span class="k">import</span> <span class="nn">org.apache.sysml.api.MLOutput</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">def</span> <span class="n">getScalar</span><span class="o">(</span><span class="n">outputs</span><span class="k">:</span> <span class="kt">MLOutput</span><span class="o">,</span> <span class="n">symbol</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Any</span> <span class="o">=</span>
     <span class="o">|</span> <span class="n">outputs</span><span class="o">.</span><span class="n">getDF</span><span class="o">(</span><span class="n">sqlContext</span><span class="o">,</span> <span class="n">symbol</span><span class="o">).</span><span class="n">first</span><span class="o">()(</span><span class="mi">1</span><span class="o">)</span>
<span class="n">getScalar</span><span class="k">:</span> <span class="o">(</span><span class="kt">outputs:</span> <span class="kt">org.apache.sysml.api.MLOutput</span><span class="o">,</span> <span class="kt">symbol:</span> <span class="kt">String</span><span class="o">)</span><span class="nc">Any</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">def</span> <span class="n">getScalarDouble</span><span class="o">(</span><span class="n">outputs</span><span class="k">:</span> <span class="kt">MLOutput</span><span class="o">,</span> <span class="n">symbol</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Double</span> <span class="o">=</span>
     <span class="o">|</span> <span class="n">getScalar</span><span class="o">(</span><span class="n">outputs</span><span class="o">,</span> <span class="n">symbol</span><span class="o">).</span><span class="n">asInstanceOf</span><span class="o">[</span><span class="kt">Double</span><span class="o">]</span>
<span class="n">getScalarDouble</span><span class="k">:</span> <span class="o">(</span><span class="kt">outputs:</span> <span class="kt">org.apache.sysml.api.MLOutput</span><span class="o">,</span> <span class="kt">symbol:</span> <span class="kt">String</span><span class="o">)</span><span class="nc">Double</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">def</span> <span class="n">getScalarInt</span><span class="o">(</span><span class="n">outputs</span><span class="k">:</span> <span class="kt">MLOutput</span><span class="o">,</span> <span class="n">symbol</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span>
     <span class="o">|</span> <span class="n">getScalarDouble</span><span class="o">(</span><span class="n">outputs</span><span class="o">,</span> <span class="n">symbol</span><span class="o">).</span><span class="n">toInt</span>
<span class="n">getScalarInt</span><span class="k">:</span> <span class="o">(</span><span class="kt">outputs:</span> <span class="kt">org.apache.sysml.api.MLOutput</span><span class="o">,</span> <span class="kt">symbol:</span> <span class="kt">String</span><span class="o">)</span><span class="nc">Int</span></code></pre></figure>

  </div>

<div data-lang="Statements">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">import</span> <span class="nn">org.apache.sysml.api.MLOutput</span>
<span class="k">def</span> <span class="n">getScalar</span><span class="o">(</span><span class="n">outputs</span><span class="k">:</span> <span class="kt">MLOutput</span><span class="o">,</span> <span class="n">symbol</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Any</span> <span class="o">=</span>
<span class="n">outputs</span><span class="o">.</span><span class="n">getDF</span><span class="o">(</span><span class="n">sqlContext</span><span class="o">,</span> <span class="n">symbol</span><span class="o">).</span><span class="n">first</span><span class="o">()(</span><span class="mi">1</span><span class="o">)</span>
<span class="k">def</span> <span class="n">getScalarDouble</span><span class="o">(</span><span class="n">outputs</span><span class="k">:</span> <span class="kt">MLOutput</span><span class="o">,</span> <span class="n">symbol</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Double</span> <span class="o">=</span>
<span class="n">getScalar</span><span class="o">(</span><span class="n">outputs</span><span class="o">,</span> <span class="n">symbol</span><span class="o">).</span><span class="n">asInstanceOf</span><span class="o">[</span><span class="kt">Double</span><span class="o">]</span>
<span class="k">def</span> <span class="n">getScalarInt</span><span class="o">(</span><span class="n">outputs</span><span class="k">:</span> <span class="kt">MLOutput</span><span class="o">,</span> <span class="n">symbol</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span>
<span class="n">getScalarDouble</span><span class="o">(</span><span class="n">outputs</span><span class="o">,</span> <span class="n">symbol</span><span class="o">).</span><span class="n">toInt</span></code></pre></figure>

  </div>

</div>

<h2 id="convert-dataframe-to-binary-block-matrix">Convert DataFrame to Binary-Block Matrix</h2>

<p>SystemML is optimized to operate on a binary-block format for matrix representation. For large
datasets, conversion from DataFrame to binary-block can require a significant quantity of time.
Explicit DataFrame to binary-block conversion allows algorithm performance to be measured separately
from data conversion time.</p>

<p>The SystemML binary-block matrix representation can be thought of as a two-dimensional array of blocks, where each block
consists of a number of rows and columns. In this example, we specify a matrix consisting
of blocks of size 1000x1000. The experimental <code class="highlighter-rouge">dataFrameToBinaryBlock()</code> method of <code class="highlighter-rouge">RDDConverterUtilsExt</code> is used
to convert the <code class="highlighter-rouge">DataFrame df</code> to a SystemML binary-block matrix, which is represented by the datatype
<code class="highlighter-rouge">JavaPairRDD[MatrixIndexes, MatrixBlock]</code>.</p>

<div class="codetabs">

<div data-lang="Spark Shell">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="n">scala</span><span class="o">&gt;</span> <span class="k">import</span> <span class="nn">org.apache.sysml.runtime.instructions.spark.utils.</span><span class="o">{</span><span class="nc">RDDConverterUtilsExt</span> <span class="k">=&gt;</span> <span class="nc">RDDConverterUtils</span><span class="o">}</span>
<span class="k">import</span> <span class="nn">org.apache.sysml.runtime.instructions.spark.utils.</span><span class="o">{</span><span class="nc">RDDConverterUtilsExt</span><span class="k">=&gt;</span><span class="nc">RDDConverterUtils</span><span class="o">}</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">import</span> <span class="nn">org.apache.sysml.runtime.matrix.MatrixCharacteristics</span><span class="o">;</span>
<span class="k">import</span> <span class="nn">org.apache.sysml.runtime.matrix.MatrixCharacteristics</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">numRowsPerBlock</span> <span class="k">=</span> <span class="mi">1000</span>
<span class="n">numRowsPerBlock</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">1000</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">numColsPerBlock</span> <span class="k">=</span> <span class="mi">1000</span>
<span class="n">numColsPerBlock</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">1000</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">mc</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">MatrixCharacteristics</span><span class="o">(</span><span class="n">numRows</span><span class="o">,</span> <span class="n">numCols</span><span class="o">,</span> <span class="n">numRowsPerBlock</span><span class="o">,</span> <span class="n">numColsPerBlock</span><span class="o">)</span>
<span class="n">mc</span><span class="k">:</span> <span class="kt">org.apache.sysml.runtime.matrix.MatrixCharacteristics</span> <span class="o">=</span> <span class="o">[</span><span class="err">100000</span> <span class="kt">x</span> <span class="err">1000</span>, <span class="kt">nnz=-</span><span class="err">1</span>, <span class="kt">blocks</span> <span class="o">(</span><span class="err">1000</span> <span class="kt">x</span> <span class="err">1000</span><span class="o">)]</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">sysMlMatrix</span> <span class="k">=</span> <span class="nc">RDDConverterUtils</span><span class="o">.</span><span class="n">dataFrameToBinaryBlock</span><span class="o">(</span><span class="n">sc</span><span class="o">,</span> <span class="n">df</span><span class="o">,</span> <span class="n">mc</span><span class="o">,</span> <span class="kc">false</span><span class="o">)</span>
<span class="n">sysMlMatrix</span><span class="k">:</span> <span class="kt">org.apache.spark.api.java.JavaPairRDD</span><span class="o">[</span><span class="kt">org.apache.sysml.runtime.matrix.data.MatrixIndexes</span>,<span class="kt">org.apache.sysml.runtime.matrix.data.MatrixBlock</span><span class="o">]</span> <span class="k">=</span> <span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">java</span><span class="o">.</span><span class="nc">JavaPairRDD</span><span class="k">@</span><span class="mi">2</span><span class="n">bce3248</span></code></pre></figure>

  </div>

<div data-lang="Statements">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">import</span> <span class="nn">org.apache.sysml.runtime.instructions.spark.utils.</span><span class="o">{</span><span class="nc">RDDConverterUtilsExt</span> <span class="k">=&gt;</span> <span class="nc">RDDConverterUtils</span><span class="o">}</span>
<span class="k">import</span> <span class="nn">org.apache.sysml.runtime.matrix.MatrixCharacteristics</span><span class="o">;</span>
<span class="k">val</span> <span class="n">numRowsPerBlock</span> <span class="k">=</span> <span class="mi">1000</span>
<span class="k">val</span> <span class="n">numColsPerBlock</span> <span class="k">=</span> <span class="mi">1000</span>
<span class="k">val</span> <span class="n">mc</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">MatrixCharacteristics</span><span class="o">(</span><span class="n">numRows</span><span class="o">,</span> <span class="n">numCols</span><span class="o">,</span> <span class="n">numRowsPerBlock</span><span class="o">,</span> <span class="n">numColsPerBlock</span><span class="o">)</span>
<span class="k">val</span> <span class="n">sysMlMatrix</span> <span class="k">=</span> <span class="nc">RDDConverterUtils</span><span class="o">.</span><span class="n">dataFrameToBinaryBlock</span><span class="o">(</span><span class="n">sc</span><span class="o">,</span> <span class="n">df</span><span class="o">,</span> <span class="n">mc</span><span class="o">,</span> <span class="kc">false</span><span class="o">)</span></code></pre></figure>

  </div>

</div>

<h2 id="dml-script">DML Script</h2>

<p>For this example, we will utilize the following DML Script called <code class="highlighter-rouge">shape.dml</code> that reads in a matrix and outputs the number of rows and the
number of columns, each represented as a matrix.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">X</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="o">$</span><span class="n">Xin</span><span class="p">)</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="n">nrow</span><span class="p">(</span><span class="n">X</span><span class="p">),</span> <span class="n">rows</span><span class="o">=</span><span class="m">1</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="m">1</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="n">ncol</span><span class="p">(</span><span class="n">X</span><span class="p">),</span> <span class="n">rows</span><span class="o">=</span><span class="m">1</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="m">1</span><span class="p">)</span>
<span class="n">write</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="o">$</span><span class="n">Mout</span><span class="p">)</span>
<span class="n">write</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="o">$</span><span class="n">Nout</span><span class="p">)</span></code></pre></figure>

<h2 id="execute-script">Execute Script</h2>

<p>Let&#8217;s execute our DML script, as shown in the example below. The call to <code class="highlighter-rouge">reset()</code> of <code class="highlighter-rouge">MLContext</code> is not necessary here, but this method should
be called if you need to reset inputs and outputs or if you would like to call <code class="highlighter-rouge">execute()</code> with a different script.</p>

<p>An example of registering the <code class="highlighter-rouge">DataFrame df</code> as an input to the <code class="highlighter-rouge">X</code> variable is shown but commented out. If a DataFrame is registered directly,
it will implicitly be converted to SystemML&#8217;s binary-block format. However, since we&#8217;ve already explicitly converted the DataFrame to the
binary-block fixed variable <code class="highlighter-rouge">systemMlMatrix</code>, we will register this input to the <code class="highlighter-rouge">X</code> variable. We register the <code class="highlighter-rouge">m</code> and <code class="highlighter-rouge">n</code> variables
as outputs.</p>

<p>When SystemML is executed via <code class="highlighter-rouge">DMLScript</code> (such as in Standalone Mode), inputs are supplied as either command-line named arguments
or positional argument. These inputs are specified in DML scripts by prepending them with a <code class="highlighter-rouge">$</code>. Values are read from or written
to files using <code class="highlighter-rouge">read</code>/<code class="highlighter-rouge">write</code> (DML) and <code class="highlighter-rouge">load</code>/<code class="highlighter-rouge">save</code> (PyDML) statements. When utilizing the <code class="highlighter-rouge">MLContext</code> API,
inputs and outputs can be other data representations, such as <code class="highlighter-rouge">DataFrame</code>s. The input and output data are bound to DML variables.
The named arguments in the <code class="highlighter-rouge">shape.dml</code> script do not have default values set for them, so we create a <code class="highlighter-rouge">Map</code> to map the required named
arguments to blank <code class="highlighter-rouge">String</code>s so that the script can pass validation.</p>

<p>The <code class="highlighter-rouge">shape.dml</code> script is executed by the call to <code class="highlighter-rouge">execute()</code>, where we supply the <code class="highlighter-rouge">Map</code> of required named arguments. The
execution results are returned as the <code class="highlighter-rouge">MLOutput</code> fixed variable <code class="highlighter-rouge">outputs</code>. The number of rows is obtained by calling the <code class="highlighter-rouge">getStaticInt()</code>
helper method with the <code class="highlighter-rouge">outputs</code> object and <code class="highlighter-rouge">"m"</code>. The number of columns is retrieved by calling <code class="highlighter-rouge">getStaticInt()</code> with
<code class="highlighter-rouge">outputs</code> and <code class="highlighter-rouge">"n"</code>.</p>

<div class="codetabs">

<div data-lang="Spark Shell">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="n">scala</span><span class="o">&gt;</span> <span class="n">ml</span><span class="o">.</span><span class="n">reset</span><span class="o">()</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="c1">//ml.registerInput("X", df) // implicit conversion of DataFrame to binary-block
</span>
<span class="n">scala</span><span class="o">&gt;</span> <span class="n">ml</span><span class="o">.</span><span class="n">registerInput</span><span class="o">(</span><span class="s">"X"</span><span class="o">,</span> <span class="n">sysMlMatrix</span><span class="o">,</span> <span class="n">numRows</span><span class="o">,</span> <span class="n">numCols</span><span class="o">)</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="n">ml</span><span class="o">.</span><span class="n">registerOutput</span><span class="o">(</span><span class="s">"m"</span><span class="o">)</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="n">ml</span><span class="o">.</span><span class="n">registerOutput</span><span class="o">(</span><span class="s">"n"</span><span class="o">)</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">nargs</span> <span class="k">=</span> <span class="nc">Map</span><span class="o">(</span><span class="s">"Xin"</span> <span class="o">-&gt;</span> <span class="s">" "</span><span class="o">,</span> <span class="s">"Mout"</span> <span class="o">-&gt;</span> <span class="s">" "</span><span class="o">,</span> <span class="s">"Nout"</span> <span class="o">-&gt;</span> <span class="s">" "</span><span class="o">)</span>
<span class="n">nargs</span><span class="k">:</span> <span class="kt">scala.collection.immutable.Map</span><span class="o">[</span><span class="kt">String</span>,<span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Map</span><span class="o">(</span><span class="nc">Xin</span> <span class="o">-&gt;</span> <span class="s">" "</span><span class="o">,</span> <span class="nc">Mout</span> <span class="o">-&gt;</span> <span class="s">" "</span><span class="o">,</span> <span class="nc">Nout</span> <span class="o">-&gt;</span> <span class="s">" "</span><span class="o">)</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">outputs</span> <span class="k">=</span> <span class="n">ml</span><span class="o">.</span><span class="n">execute</span><span class="o">(</span><span class="s">"shape.dml"</span><span class="o">,</span> <span class="n">nargs</span><span class="o">)</span>
<span class="mi">15</span><span class="o">/</span><span class="mi">10</span><span class="o">/</span><span class="mi">12</span> <span class="mi">16</span><span class="k">:</span><span class="err">29</span><span class="kt">:</span><span class="err">15</span> <span class="kt">WARN</span> <span class="kt">:</span> <span class="kt">Your</span> <span class="kt">hostname</span><span class="o">,</span> <span class="n">derons</span><span class="o">-</span><span class="n">mbp</span><span class="o">.</span><span class="n">usca</span><span class="o">.</span><span class="n">ibm</span><span class="o">.</span><span class="n">com</span> <span class="n">resolves</span> <span class="n">to</span> <span class="n">a</span> <span class="n">loopback</span><span class="o">/</span><span class="n">non</span><span class="o">-</span><span class="n">reachable</span> <span class="n">address</span><span class="k">:</span> <span class="err">127</span><span class="kt">.</span><span class="err">0</span><span class="kt">.</span><span class="err">0</span><span class="kt">.</span><span class="err">1</span><span class="o">,</span> <span class="n">but</span> <span class="n">we</span> <span class="n">couldn</span><span class="ss">'t </span><span class="n">find</span> <span class="n">any</span> <span class="n">external</span> <span class="nc">IP</span> <span class="n">address</span><span class="o">!</span>
<span class="mi">15</span><span class="o">/</span><span class="mi">10</span><span class="o">/</span><span class="mi">12</span> <span class="mi">16</span><span class="k">:</span><span class="err">29</span><span class="kt">:</span><span class="err">15</span> <span class="kt">WARN</span> <span class="kt">OptimizerUtils:</span> <span class="kt">Auto-disable</span> <span class="kt">multi-threaded</span> <span class="kt">text</span> <span class="kt">read</span> <span class="kt">for</span> <span class="kt">'text'</span> <span class="kt">and</span> <span class="kt">'csv'</span> <span class="kt">due</span> <span class="kt">to</span> <span class="kt">thread</span> <span class="kt">contention</span> <span class="kt">on</span> <span class="kt">JRE</span> <span class="kt">&lt;</span> <span class="err">1</span><span class="kt">.</span><span class="err">8</span> <span class="o">(</span><span class="kt">java.version</span><span class="o">=</span><span class="err">1</span><span class="kt">.</span><span class="err">7</span><span class="kt">.</span><span class="err">0</span><span class="k">_</span><span class="err">80</span><span class="o">).</span>
<span class="n">outputs</span><span class="k">:</span> <span class="kt">org.apache.sysml.api.MLOutput</span> <span class="o">=</span> <span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">sysml</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="nc">MLOutput</span><span class="k">@</span><span class="mf">4d</span><span class="mi">424743</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">m</span> <span class="k">=</span> <span class="n">getScalarInt</span><span class="o">(</span><span class="n">outputs</span><span class="o">,</span> <span class="s">"m"</span><span class="o">)</span>
<span class="n">m</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">100000</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">n</span> <span class="k">=</span> <span class="n">getScalarInt</span><span class="o">(</span><span class="n">outputs</span><span class="o">,</span> <span class="s">"n"</span><span class="o">)</span>
<span class="n">n</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">1000</span></code></pre></figure>

  </div>

<div data-lang="Statements">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="n">ml</span><span class="o">.</span><span class="n">reset</span><span class="o">()</span>
<span class="c1">//ml.registerInput("X", df) // implicit conversion of DataFrame to binary-block
</span><span class="n">ml</span><span class="o">.</span><span class="n">registerInput</span><span class="o">(</span><span class="s">"X"</span><span class="o">,</span> <span class="n">sysMlMatrix</span><span class="o">,</span> <span class="n">numRows</span><span class="o">,</span> <span class="n">numCols</span><span class="o">)</span>
<span class="n">ml</span><span class="o">.</span><span class="n">registerOutput</span><span class="o">(</span><span class="s">"m"</span><span class="o">)</span>
<span class="n">ml</span><span class="o">.</span><span class="n">registerOutput</span><span class="o">(</span><span class="s">"n"</span><span class="o">)</span>
<span class="k">val</span> <span class="n">nargs</span> <span class="k">=</span> <span class="nc">Map</span><span class="o">(</span><span class="s">"Xin"</span> <span class="o">-&gt;</span> <span class="s">" "</span><span class="o">,</span> <span class="s">"Mout"</span> <span class="o">-&gt;</span> <span class="s">" "</span><span class="o">,</span> <span class="s">"Nout"</span> <span class="o">-&gt;</span> <span class="s">" "</span><span class="o">)</span>
<span class="k">val</span> <span class="n">outputs</span> <span class="k">=</span> <span class="n">ml</span><span class="o">.</span><span class="n">execute</span><span class="o">(</span><span class="s">"shape.dml"</span><span class="o">,</span> <span class="n">nargs</span><span class="o">)</span>
<span class="k">val</span> <span class="n">m</span> <span class="k">=</span> <span class="n">getScalarInt</span><span class="o">(</span><span class="n">outputs</span><span class="o">,</span> <span class="s">"m"</span><span class="o">)</span>
<span class="k">val</span> <span class="n">n</span> <span class="k">=</span> <span class="n">getScalarInt</span><span class="o">(</span><span class="n">outputs</span><span class="o">,</span> <span class="s">"n"</span><span class="o">)</span></code></pre></figure>

  </div>

</div>

<h2 id="dml-script-as-string">DML Script as String</h2>

<p>The <code class="highlighter-rouge">MLContext</code> API allows a DML script to be specified
as a <code class="highlighter-rouge">String</code>. Here, we specify a DML script as a fixed <code class="highlighter-rouge">String</code> variable called <code class="highlighter-rouge">minMaxMeanScript</code>.
This DML will find the minimum, maximum, and mean value of a matrix.</p>

<div class="codetabs">

<div data-lang="Spark Shell">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">minMaxMeanScript</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span>
     <span class="o">|</span> <span class="s">"""
     | Xin = read(" ")
     | minOut = matrix(min(Xin), rows=1, cols=1)
     | maxOut = matrix(max(Xin), rows=1, cols=1)
     | meanOut = matrix(mean(Xin), rows=1, cols=1)
     | write(minOut, " ")
     | write(maxOut, " ")
     | write(meanOut, " ")
     | """</span>
<span class="n">minMaxMeanScript</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span>
<span class="s">"
Xin = read("</span> <span class="s">")
minOut = matrix(min(Xin), rows=1, cols=1)
maxOut = matrix(max(Xin), rows=1, cols=1)
meanOut = matrix(mean(Xin), rows=1, cols=1)
write(minOut, "</span> <span class="s">")
write(maxOut, "</span> <span class="s">")
write(meanOut, "</span> <span class="s">")
"</span></code></pre></figure>

  </div>

<div data-lang="Statements">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">minMaxMeanScript</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span>
<span class="s">"""
Xin = read(" ")
minOut = matrix(min(Xin), rows=1, cols=1)
maxOut = matrix(max(Xin), rows=1, cols=1)
meanOut = matrix(mean(Xin), rows=1, cols=1)
write(minOut, " ")
write(maxOut, " ")
write(meanOut, " ")
"""</span></code></pre></figure>

  </div>

</div>

<h2 id="scala-wrapper-for-dml">Scala Wrapper for DML</h2>

<p>We can create a Scala wrapper for our invocation of the <code class="highlighter-rouge">minMaxMeanScript</code> DML <code class="highlighter-rouge">String</code>. The <code class="highlighter-rouge">minMaxMean()</code> method
takes a <code class="highlighter-rouge">JavaPairRDD[MatrixIndexes, MatrixBlock]</code> parameter, which is a SystemML binary-block matrix representation.
It also takes a <code class="highlighter-rouge">rows</code> parameter indicating the number of rows in the matrix, a <code class="highlighter-rouge">cols</code> parameter indicating the number
of columns in the matrix, and an <code class="highlighter-rouge">MLContext</code> parameter. The <code class="highlighter-rouge">minMaxMean()</code> method
returns a tuple consisting of the minimum value in the matrix, the maximum value in the matrix, and the computed
mean value of the matrix.</p>

<div class="codetabs">

<div data-lang="Spark Shell">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="n">scala</span><span class="o">&gt;</span> <span class="k">import</span> <span class="nn">org.apache.sysml.runtime.matrix.data.MatrixIndexes</span>
<span class="k">import</span> <span class="nn">org.apache.sysml.runtime.matrix.data.MatrixIndexes</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">import</span> <span class="nn">org.apache.sysml.runtime.matrix.data.MatrixBlock</span>
<span class="k">import</span> <span class="nn">org.apache.sysml.runtime.matrix.data.MatrixBlock</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">import</span> <span class="nn">org.apache.spark.api.java.JavaPairRDD</span>
<span class="k">import</span> <span class="nn">org.apache.spark.api.java.JavaPairRDD</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">def</span> <span class="n">minMaxMean</span><span class="o">(</span><span class="n">mat</span><span class="k">:</span> <span class="kt">JavaPairRDD</span><span class="o">[</span><span class="kt">MatrixIndexes</span>, <span class="kt">MatrixBlock</span><span class="o">],</span> <span class="n">rows</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">cols</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">ml</span><span class="k">:</span> <span class="kt">MLContext</span><span class="o">)</span><span class="k">:</span> <span class="o">(</span><span class="kt">Double</span><span class="o">,</span> <span class="kt">Double</span><span class="o">,</span> <span class="nc">Double</span><span class="o">)</span> <span class="k">=</span> <span class="o">{</span>
     <span class="o">|</span> <span class="n">ml</span><span class="o">.</span><span class="n">reset</span><span class="o">()</span>
     <span class="o">|</span> <span class="n">ml</span><span class="o">.</span><span class="n">registerInput</span><span class="o">(</span><span class="s">"Xin"</span><span class="o">,</span> <span class="n">mat</span><span class="o">,</span> <span class="n">rows</span><span class="o">,</span> <span class="n">cols</span><span class="o">)</span>
     <span class="o">|</span> <span class="n">ml</span><span class="o">.</span><span class="n">registerOutput</span><span class="o">(</span><span class="s">"minOut"</span><span class="o">)</span>
     <span class="o">|</span> <span class="n">ml</span><span class="o">.</span><span class="n">registerOutput</span><span class="o">(</span><span class="s">"maxOut"</span><span class="o">)</span>
     <span class="o">|</span> <span class="n">ml</span><span class="o">.</span><span class="n">registerOutput</span><span class="o">(</span><span class="s">"meanOut"</span><span class="o">)</span>
     <span class="o">|</span> <span class="k">val</span> <span class="n">outputs</span> <span class="k">=</span> <span class="n">ml</span><span class="o">.</span><span class="n">executeScript</span><span class="o">(</span><span class="n">minMaxMeanScript</span><span class="o">)</span>
     <span class="o">|</span> <span class="k">val</span> <span class="n">minOut</span> <span class="k">=</span> <span class="n">getScalarDouble</span><span class="o">(</span><span class="n">outputs</span><span class="o">,</span> <span class="s">"minOut"</span><span class="o">)</span>
     <span class="o">|</span> <span class="k">val</span> <span class="n">maxOut</span> <span class="k">=</span> <span class="n">getScalarDouble</span><span class="o">(</span><span class="n">outputs</span><span class="o">,</span> <span class="s">"maxOut"</span><span class="o">)</span>
     <span class="o">|</span> <span class="k">val</span> <span class="n">meanOut</span> <span class="k">=</span> <span class="n">getScalarDouble</span><span class="o">(</span><span class="n">outputs</span><span class="o">,</span> <span class="s">"meanOut"</span><span class="o">)</span>
     <span class="o">|</span> <span class="o">(</span><span class="n">minOut</span><span class="o">,</span> <span class="n">maxOut</span><span class="o">,</span> <span class="n">meanOut</span><span class="o">)</span>
     <span class="o">|</span> <span class="o">}</span>
<span class="n">minMaxMean</span><span class="k">:</span> <span class="o">(</span><span class="kt">mat:</span> <span class="kt">org.apache.spark.api.java.JavaPairRDD</span><span class="o">[</span><span class="kt">org.apache.sysml.runtime.matrix.data.MatrixIndexes</span>,<span class="kt">org.apache.sysml.runtime.matrix.data.MatrixBlock</span><span class="o">],</span> <span class="n">rows</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">cols</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">ml</span><span class="k">:</span> <span class="kt">org.apache.sysml.api.MLContext</span><span class="o">)(</span><span class="nc">Double</span><span class="o">,</span> <span class="nc">Double</span><span class="o">,</span> <span class="nc">Double</span><span class="o">)</span></code></pre></figure>

  </div>

<div data-lang="Statements">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">import</span> <span class="nn">org.apache.sysml.runtime.matrix.data.MatrixIndexes</span>
<span class="k">import</span> <span class="nn">org.apache.sysml.runtime.matrix.data.MatrixBlock</span>
<span class="k">import</span> <span class="nn">org.apache.spark.api.java.JavaPairRDD</span>
<span class="k">def</span> <span class="n">minMaxMean</span><span class="o">(</span><span class="n">mat</span><span class="k">:</span> <span class="kt">JavaPairRDD</span><span class="o">[</span><span class="kt">MatrixIndexes</span>, <span class="kt">MatrixBlock</span><span class="o">],</span> <span class="n">rows</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">cols</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">ml</span><span class="k">:</span> <span class="kt">MLContext</span><span class="o">)</span><span class="k">:</span> <span class="o">(</span><span class="kt">Double</span><span class="o">,</span> <span class="kt">Double</span><span class="o">,</span> <span class="nc">Double</span><span class="o">)</span> <span class="k">=</span> <span class="o">{</span>
<span class="n">ml</span><span class="o">.</span><span class="n">reset</span><span class="o">()</span>
<span class="n">ml</span><span class="o">.</span><span class="n">registerInput</span><span class="o">(</span><span class="s">"Xin"</span><span class="o">,</span> <span class="n">mat</span><span class="o">,</span> <span class="n">rows</span><span class="o">,</span> <span class="n">cols</span><span class="o">)</span>
<span class="n">ml</span><span class="o">.</span><span class="n">registerOutput</span><span class="o">(</span><span class="s">"minOut"</span><span class="o">)</span>
<span class="n">ml</span><span class="o">.</span><span class="n">registerOutput</span><span class="o">(</span><span class="s">"maxOut"</span><span class="o">)</span>
<span class="n">ml</span><span class="o">.</span><span class="n">registerOutput</span><span class="o">(</span><span class="s">"meanOut"</span><span class="o">)</span>
<span class="k">val</span> <span class="n">outputs</span> <span class="k">=</span> <span class="n">ml</span><span class="o">.</span><span class="n">executeScript</span><span class="o">(</span><span class="n">minMaxMeanScript</span><span class="o">)</span>
<span class="k">val</span> <span class="n">minOut</span> <span class="k">=</span> <span class="n">getScalarDouble</span><span class="o">(</span><span class="n">outputs</span><span class="o">,</span> <span class="s">"minOut"</span><span class="o">)</span>
<span class="k">val</span> <span class="n">maxOut</span> <span class="k">=</span> <span class="n">getScalarDouble</span><span class="o">(</span><span class="n">outputs</span><span class="o">,</span> <span class="s">"maxOut"</span><span class="o">)</span>
<span class="k">val</span> <span class="n">meanOut</span> <span class="k">=</span> <span class="n">getScalarDouble</span><span class="o">(</span><span class="n">outputs</span><span class="o">,</span> <span class="s">"meanOut"</span><span class="o">)</span>
<span class="o">(</span><span class="n">minOut</span><span class="o">,</span> <span class="n">maxOut</span><span class="o">,</span> <span class="n">meanOut</span><span class="o">)</span>
<span class="o">}</span></code></pre></figure>

  </div>

</div>

<h2 id="invoking-dml-via-scala-wrapper">Invoking DML via Scala Wrapper</h2>

<p>Here, we invoke <code class="highlighter-rouge">minMaxMeanScript</code> using our <code class="highlighter-rouge">minMaxMean()</code> Scala wrapper method. It returns a tuple
consisting of the minimum value in the matrix, the maximum value in the matrix, and the mean value of the matrix.</p>

<div class="codetabs">

<div data-lang="Spark Shell">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="o">(</span><span class="n">min</span><span class="o">,</span> <span class="n">max</span><span class="o">,</span> <span class="n">mean</span><span class="o">)</span> <span class="k">=</span> <span class="n">minMaxMean</span><span class="o">(</span><span class="n">sysMlMatrix</span><span class="o">,</span> <span class="n">numRows</span><span class="o">,</span> <span class="n">numCols</span><span class="o">,</span> <span class="n">ml</span><span class="o">)</span>
<span class="mi">15</span><span class="o">/</span><span class="mi">10</span><span class="o">/</span><span class="mi">13</span> <span class="mi">14</span><span class="k">:</span><span class="err">33</span><span class="kt">:</span><span class="err">11</span> <span class="kt">WARN</span> <span class="kt">OptimizerUtils:</span> <span class="kt">Auto-disable</span> <span class="kt">multi-threaded</span> <span class="kt">text</span> <span class="kt">read</span> <span class="kt">for</span> <span class="kt">'text'</span> <span class="kt">and</span> <span class="kt">'csv'</span> <span class="kt">due</span> <span class="kt">to</span> <span class="kt">thread</span> <span class="kt">contention</span> <span class="kt">on</span> <span class="kt">JRE</span> <span class="kt">&lt;</span> <span class="err">1</span><span class="kt">.</span><span class="err">8</span> <span class="o">(</span><span class="kt">java.version</span><span class="o">=</span><span class="err">1</span><span class="kt">.</span><span class="err">7</span><span class="kt">.</span><span class="err">0</span><span class="k">_</span><span class="err">80</span><span class="o">).</span>
<span class="n">min</span><span class="k">:</span> <span class="kt">Double</span> <span class="o">=</span> <span class="mf">5.378949397005783E-9</span>                                              
<span class="n">max</span><span class="k">:</span> <span class="kt">Double</span> <span class="o">=</span> <span class="mf">0.9999999934660398</span>
<span class="n">mean</span><span class="k">:</span> <span class="kt">Double</span> <span class="o">=</span> <span class="mf">0.499988222338507</span></code></pre></figure>

  </div>

<div data-lang="Statements">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="o">(</span><span class="n">min</span><span class="o">,</span> <span class="n">max</span><span class="o">,</span> <span class="n">mean</span><span class="o">)</span> <span class="k">=</span> <span class="n">minMaxMean</span><span class="o">(</span><span class="n">sysMlMatrix</span><span class="o">,</span> <span class="n">numRows</span><span class="o">,</span> <span class="n">numCols</span><span class="o">,</span> <span class="n">ml</span><span class="o">)</span></code></pre></figure>

  </div>

</div>

<hr />

<h1 id="zeppelin-notebook-example---linear-regression-algorithm---old-api">Zeppelin Notebook Example - Linear Regression Algorithm - OLD API</h1>

<h3 id="note-this-api-is-old-and-has-been-deprecated--1">** <strong>NOTE: This API is old and has been deprecated.</strong> **</h3>
<p><strong>Please use the <a href="spark-mlcontext-programming-guide#spark-shell-example">new MLContext API</a> instead.</strong></p>

<p>Next, we&#8217;ll consider an example of a SystemML linear regression algorithm run from Spark through an Apache Zeppelin notebook.
Instructions to clone and build Zeppelin can be found at the <a href="https://github.com/apache/incubator-zeppelin">GitHub Apache Zeppelin</a>
site. This example also will look at the Spark ML linear regression algorithm.</p>

<p>This Zeppelin notebook example can be imported by choosing <code class="highlighter-rouge">Import note</code> -&gt; <code class="highlighter-rouge">Add from URL</code> from the Zeppelin main page, then insert the following URL:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>https://raw.githubusercontent.com/apache/incubator-systemml/master/samples/zeppelin-notebooks/2AZ2AQ12B/note.json
</code></pre>
</div>

<p>Alternatively download <a href="https://raw.githubusercontent.com/apache/incubator-systemml/master/samples/zeppelin-notebooks/2AZ2AQ12B/note.json" download="note.json">note.json</a>, then import it by choosing <code class="highlighter-rouge">Import note</code> -&gt; <code class="highlighter-rouge">Choose a JSON here</code> from the Zeppelin main page.</p>

<p>A <code class="highlighter-rouge">conf/zeppelin-env.sh</code> file is created based on <code class="highlighter-rouge">conf/zeppelin-env.sh.template</code>. For
this demonstration, it features <code class="highlighter-rouge">SPARK_HOME</code>, <code class="highlighter-rouge">SPARK_SUBMIT_OPTIONS</code>, and <code class="highlighter-rouge">ZEPPELIN_SPARK_USEHIVECONTEXT</code>
environment variables:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>export SPARK_HOME=/Users/example/spark-1.5.1-bin-hadoop2.6
export SPARK_SUBMIT_OPTIONS="--jars /Users/example/systemml/system-ml/target/SystemML.jar"
export ZEPPELIN_SPARK_USEHIVECONTEXT=false
</code></pre>
</div>

<p>Start Zeppelin using the <code class="highlighter-rouge">zeppelin.sh</code> script:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>bin/zeppelin.sh
</code></pre>
</div>

<p>After opening Zeppelin in a brower, we see the &#8220;SystemML - Linear Regression&#8221; note in the list of available
Zeppelin notes.</p>

<p><img src="img/spark-mlcontext-programming-guide/zeppelin-notebook.png" alt="Zeppelin Notebook" title="Zeppelin Notebook" /></p>

<p>If we go to the &#8220;SystemML - Linear Regression&#8221; note, we see that the note consists of several cells of code.</p>

<p><img src="img/spark-mlcontext-programming-guide/zeppelin-notebook-systemml-linear-regression.png" alt="Zeppelin 'SystemML - Linear Regression' Note" title="Zeppelin 'SystemML - Linear Regression' Note" /></p>

<p>Let&#8217;s briefly consider these cells.</p>

<h2 id="trigger-spark-startup">Trigger Spark Startup</h2>

<p>This cell triggers Spark to initialize by calling the <code class="highlighter-rouge">SparkContext</code> <code class="highlighter-rouge">sc</code> object. Information regarding these startup operations can be viewed in the
console window in which <code class="highlighter-rouge">zeppelin.sh</code> is running.</p>

<p><strong>Cell:</strong></p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="c1">// Trigger Spark Startup
</span><span class="n">sc</span></code></pre></figure>

<p><strong>Output:</strong></p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="n">res8</span><span class="k">:</span> <span class="kt">org.apache.spark.SparkContext</span> <span class="o">=</span> <span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="nc">SparkContext</span><span class="k">@</span><span class="mi">6</span><span class="n">ce70bf3</span></code></pre></figure>

<h2 id="generate-linear-regression-test-data">Generate Linear Regression Test Data</h2>

<p>The Spark <code class="highlighter-rouge">LinearDataGenerator</code> is used to generate test data for the Spark ML and SystemML linear regression algorithms.</p>

<p><strong>Cell:</strong></p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="c1">// Generate data
</span><span class="k">import</span> <span class="nn">org.apache.spark.mllib.util.LinearDataGenerator</span>
<span class="k">import</span> <span class="nn">sqlContext.implicits._</span>

<span class="k">val</span> <span class="n">numRows</span> <span class="k">=</span> <span class="mi">10000</span>
<span class="k">val</span> <span class="n">numCols</span> <span class="k">=</span> <span class="mi">1000</span>
<span class="k">val</span> <span class="n">rawData</span> <span class="k">=</span> <span class="nc">LinearDataGenerator</span><span class="o">.</span><span class="n">generateLinearRDD</span><span class="o">(</span><span class="n">sc</span><span class="o">,</span> <span class="n">numRows</span><span class="o">,</span> <span class="n">numCols</span><span class="o">,</span> <span class="mi">1</span><span class="o">).</span><span class="n">toDF</span><span class="o">()</span>

<span class="c1">// Repartition into a more parallelism-friendly number of partitions
</span><span class="k">val</span> <span class="n">data</span> <span class="k">=</span> <span class="n">rawData</span><span class="o">.</span><span class="n">repartition</span><span class="o">(</span><span class="mi">64</span><span class="o">).</span><span class="n">cache</span><span class="o">()</span></code></pre></figure>

<p><strong>Output:</strong></p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">import</span> <span class="nn">org.apache.spark.mllib.util.LinearDataGenerator</span>
<span class="n">numRows</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="n">numCols</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">rawData</span><span class="k">:</span> <span class="kt">org.apache.spark.sql.DataFrame</span> <span class="o">=</span> <span class="o">[</span><span class="kt">label:</span> <span class="kt">double</span>, <span class="kt">features:</span> <span class="kt">vector</span><span class="o">]</span>
<span class="n">data</span><span class="k">:</span> <span class="kt">org.apache.spark.sql.DataFrame</span> <span class="o">=</span> <span class="o">[</span><span class="kt">label:</span> <span class="kt">double</span>, <span class="kt">features:</span> <span class="kt">vector</span><span class="o">]</span></code></pre></figure>

<h2 id="train-using-spark-ml-linear-regression-algorithm-for-comparison">Train using Spark ML Linear Regression Algorithm for Comparison</h2>

<p>For purpose of comparison, we can train a model using the Spark ML linear regression
algorithm.</p>

<p><strong>Cell:</strong></p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="c1">// Spark ML
</span><span class="k">import</span> <span class="nn">org.apache.spark.ml.regression.LinearRegression</span>

<span class="c1">// Model Settings
</span><span class="k">val</span> <span class="n">maxIters</span> <span class="k">=</span> <span class="mi">100</span>
<span class="k">val</span> <span class="n">reg</span> <span class="k">=</span> <span class="mi">0</span>
<span class="k">val</span> <span class="n">elasticNetParam</span> <span class="k">=</span> <span class="mi">0</span>  <span class="c1">// L2 reg
</span>
<span class="c1">// Fit the model
</span><span class="k">val</span> <span class="n">lr</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">LinearRegression</span><span class="o">()</span>
  <span class="o">.</span><span class="n">setMaxIter</span><span class="o">(</span><span class="n">maxIters</span><span class="o">)</span>
  <span class="o">.</span><span class="n">setRegParam</span><span class="o">(</span><span class="n">reg</span><span class="o">)</span>
  <span class="o">.</span><span class="n">setElasticNetParam</span><span class="o">(</span><span class="n">elasticNetParam</span><span class="o">)</span>
<span class="k">val</span> <span class="n">start</span> <span class="k">=</span> <span class="nc">System</span><span class="o">.</span><span class="n">currentTimeMillis</span><span class="o">()</span>
<span class="k">val</span> <span class="n">model</span> <span class="k">=</span> <span class="n">lr</span><span class="o">.</span><span class="n">fit</span><span class="o">(</span><span class="n">data</span><span class="o">)</span>
<span class="k">val</span> <span class="n">trainingTime</span> <span class="k">=</span> <span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="n">currentTimeMillis</span><span class="o">()</span> <span class="o">-</span> <span class="n">start</span><span class="o">).</span><span class="n">toDouble</span> <span class="o">/</span> <span class="mf">1000.0</span>

<span class="c1">// Summarize the model over the training set and gather some metrics
</span><span class="k">val</span> <span class="n">trainingSummary</span> <span class="k">=</span> <span class="n">model</span><span class="o">.</span><span class="n">summary</span>
<span class="k">val</span> <span class="n">r2</span> <span class="k">=</span> <span class="n">trainingSummary</span><span class="o">.</span><span class="n">r2</span>
<span class="k">val</span> <span class="n">iters</span> <span class="k">=</span> <span class="n">trainingSummary</span><span class="o">.</span><span class="n">totalIterations</span>
<span class="k">val</span> <span class="n">trainingTimePerIter</span> <span class="k">=</span> <span class="n">trainingTime</span> <span class="o">/</span> <span class="n">iters</span></code></pre></figure>

<p><strong>Output:</strong></p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">import</span> <span class="nn">org.apache.spark.ml.regression.LinearRegression</span>
<span class="n">maxIters</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">reg</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">elasticNetParam</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">lr</span><span class="k">:</span> <span class="kt">org.apache.spark.ml.regression.LinearRegression</span> <span class="o">=</span> <span class="n">linReg_a7f51d676562</span>
<span class="n">start</span><span class="k">:</span> <span class="kt">Long</span> <span class="o">=</span> <span class="mi">1444672044647</span>
<span class="n">model</span><span class="k">:</span> <span class="kt">org.apache.spark.ml.regression.LinearRegressionModel</span> <span class="o">=</span> <span class="n">linReg_a7f51d676562</span>
<span class="n">trainingTime</span><span class="k">:</span> <span class="kt">Double</span> <span class="o">=</span> <span class="mf">12.985</span>
<span class="n">trainingSummary</span><span class="k">:</span> <span class="kt">org.apache.spark.ml.regression.LinearRegressionTrainingSummary</span> <span class="o">=</span> <span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">ml</span><span class="o">.</span><span class="n">regression</span><span class="o">.</span><span class="nc">LinearRegressionTrainingSummary</span><span class="k">@</span><span class="mi">227</span><span class="n">ba28b</span>
<span class="n">r2</span><span class="k">:</span> <span class="kt">Double</span> <span class="o">=</span> <span class="mf">0.9677118209276552</span>
<span class="n">iters</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">17</span>
<span class="n">trainingTimePerIter</span><span class="k">:</span> <span class="kt">Double</span> <span class="o">=</span> <span class="mf">0.7638235294117647</span></code></pre></figure>

<h2 id="spark-ml-linear-regression-summary-statistics">Spark ML Linear Regression Summary Statistics</h2>

<p>Summary statistics for the Spark ML linear regression algorithm are displayed by this cell.</p>

<p><strong>Cell:</strong></p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="c1">// Print statistics
</span><span class="n">println</span><span class="o">(</span><span class="n">s</span><span class="s">"R2: ${r2}"</span><span class="o">)</span>
<span class="n">println</span><span class="o">(</span><span class="n">s</span><span class="s">"Iterations: ${iters}"</span><span class="o">)</span>
<span class="n">println</span><span class="o">(</span><span class="n">s</span><span class="s">"Training time per iter: ${trainingTimePerIter} seconds"</span><span class="o">)</span></code></pre></figure>

<p><strong>Output:</strong></p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="n">R2</span><span class="k">:</span> <span class="err">0</span><span class="kt">.</span><span class="err">9677118209276552</span>
<span class="kt">Iterations:</span> <span class="err">17</span>
<span class="kt">Training</span> <span class="kt">time</span> <span class="kt">per</span> <span class="kt">iter:</span> <span class="err">0</span><span class="kt">.</span><span class="err">7638235294117647</span> <span class="kt">seconds</span></code></pre></figure>

<h2 id="systemml-linear-regression-algorithm">SystemML Linear Regression Algorithm</h2>

<p>The <code class="highlighter-rouge">linearReg</code> fixed <code class="highlighter-rouge">String</code> variable is set to
a linear regression algorithm written in DML, SystemML&#8217;s Declarative Machine Learning language.</p>

<p><strong>Cell:</strong></p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="c1">// SystemML kernels
</span><span class="k">val</span> <span class="n">linearReg</span> <span class="k">=</span>
<span class="s">"""
#
# THIS SCRIPT SOLVES LINEAR REGRESSION USING THE CONJUGATE GRADIENT ALGORITHM
#
# INPUT PARAMETERS:
# --------------------------------------------------------------------------------------------
# NAME  TYPE   DEFAULT  MEANING
# --------------------------------------------------------------------------------------------
# X     String  ---     Matrix X of feature vectors
# Y     String  ---     1-column Matrix Y of response values
# icpt  Int      0      Intercept presence, shifting and rescaling the columns of X:
#                       0 = no intercept, no shifting, no rescaling;
#                       1 = add intercept, but neither shift nor rescale X;
#                       2 = add intercept, shift &amp; rescale X columns to mean = 0, variance = 1
# reg   Double 0.000001 Regularization constant (lambda) for L2-regularization; set to nonzero
#                       for highly dependend/sparse/numerous features
# tol   Double 0.000001 Tolerance (epsilon); conjugate graduent procedure terminates early if
#                       L2 norm of the beta-residual is less than tolerance * its initial norm
# maxi  Int      0      Maximum number of conjugate gradient iterations, 0 = no maximum
# --------------------------------------------------------------------------------------------
#
# OUTPUT:
# B Estimated regression parameters (the betas) to store
#
# Note: Matrix of regression parameters (the betas) and its size depend on icpt input value:
#         OUTPUT SIZE:   OUTPUT CONTENTS:                HOW TO PREDICT Y FROM X AND B:
# icpt=0: ncol(X)   x 1  Betas for X only                Y ~ X %*% B[1:ncol(X), 1], or just X %*% B
# icpt=1: ncol(X)+1 x 1  Betas for X and intercept       Y ~ X %*% B[1:ncol(X), 1] + B[ncol(X)+1, 1]
# icpt=2: ncol(X)+1 x 2  Col.1: betas for X &amp; intercept  Y ~ X %*% B[1:ncol(X), 1] + B[ncol(X)+1, 1]
#                        Col.2: betas for shifted/rescaled X and intercept
#

fileX = "";
fileY = "";
fileB = "";

intercept_status = ifdef ($icpt, 0);     # $icpt=0;
tolerance = ifdef ($tol, 0.000001);      # $tol=0.000001;
max_iteration = ifdef ($maxi, 0);        # $maxi=0;
regularization = ifdef ($reg, 0.000001); # $reg=0.000001;

X = read (fileX);
y = read (fileY);

n = nrow (X);
m = ncol (X);
ones_n = matrix (1, rows = n, cols = 1);
zero_cell = matrix (0, rows = 1, cols = 1);

# Introduce the intercept, shift and rescale the columns of X if needed

m_ext = m;
if (intercept_status == 1 | intercept_status == 2)  # add the intercept column
{
    X = append (X, ones_n);
    m_ext = ncol (X);
}

scale_lambda = matrix (1, rows = m_ext, cols = 1);
if (intercept_status == 1 | intercept_status == 2)
{
    scale_lambda [m_ext, 1] = 0;
}

if (intercept_status == 2)  # scale-&amp;-shift X columns to mean 0, variance 1
{                           # Important assumption: X [, m_ext] = ones_n
    avg_X_cols = t(colSums(X)) / n;
    var_X_cols = (t(colSums (X ^ 2)) - n * (avg_X_cols ^ 2)) / (n - 1);
    is_unsafe = ppred (var_X_cols, 0.0, "&lt;=");
    scale_X = 1.0 / sqrt (var_X_cols * (1 - is_unsafe) + is_unsafe);
    scale_X [m_ext, 1] = 1;
    shift_X = - avg_X_cols * scale_X;
    shift_X [m_ext, 1] = 0;
} else {
    scale_X = matrix (1, rows = m_ext, cols = 1);
    shift_X = matrix (0, rows = m_ext, cols = 1);
}

# Henceforth, if intercept_status == 2, we use "X %*% (SHIFT/SCALE TRANSFORM)"
# instead of "X".  However, in order to preserve the sparsity of X,
# we apply the transform associatively to some other part of the expression
# in which it occurs.  To avoid materializing a large matrix, we rewrite it:
#
# ssX_A  = (SHIFT/SCALE TRANSFORM) %*% A    --- is rewritten as:
# ssX_A  = diag (scale_X) %*% A;
# ssX_A [m_ext, ] = ssX_A [m_ext, ] + t(shift_X) %*% A;
#
# tssX_A = t(SHIFT/SCALE TRANSFORM) %*% A   --- is rewritten as:
# tssX_A = diag (scale_X) %*% A + shift_X %*% A [m_ext, ];

lambda = scale_lambda * regularization;
beta_unscaled = matrix (0, rows = m_ext, cols = 1);

if (max_iteration == 0) {
    max_iteration = m_ext;
}
i = 0;

# BEGIN THE CONJUGATE GRADIENT ALGORITHM
r = - t(X) %*% y;

if (intercept_status == 2) {
    r = scale_X * r + shift_X %*% r [m_ext, ];
}

p = - r;
norm_r2 = sum (r ^ 2);
norm_r2_initial = norm_r2;
norm_r2_target = norm_r2_initial * tolerance ^ 2;

while (i &lt; max_iteration &amp; norm_r2 &gt; norm_r2_target)
{
    if (intercept_status == 2) {
        ssX_p = scale_X * p;
        ssX_p [m_ext, ] = ssX_p [m_ext, ] + t(shift_X) %*% p;
    } else {
        ssX_p = p;
    }

    q = t(X) %*% (X %*% ssX_p);

    if (intercept_status == 2) {
        q = scale_X * q + shift_X %*% q [m_ext, ];
    }

    q = q + lambda * p;
    a = norm_r2 / sum (p * q);
    beta_unscaled = beta_unscaled + a * p;
    r = r + a * q;
    old_norm_r2 = norm_r2;
    norm_r2 = sum (r ^ 2);
    p = -r + (norm_r2 / old_norm_r2) * p;
    i = i + 1;
}
# END THE CONJUGATE GRADIENT ALGORITHM

if (intercept_status == 2) {
    beta = scale_X * beta_unscaled;
    beta [m_ext, ] = beta [m_ext, ] + t(shift_X) %*% beta_unscaled;
} else {
    beta = beta_unscaled;
}

# Output statistics
avg_tot = sum (y) / n;
ss_tot = sum (y ^ 2);
ss_avg_tot = ss_tot - n * avg_tot ^ 2;
var_tot = ss_avg_tot / (n - 1);
y_residual = y - X %*% beta;
avg_res = sum (y_residual) / n;
ss_res = sum (y_residual ^ 2);
ss_avg_res = ss_res - n * avg_res ^ 2;

R2_temp = 1 - ss_res / ss_avg_tot
R2 = matrix(R2_temp, rows=1, cols=1)
write(R2, "")

totalIters = matrix(i, rows=1, cols=1)
write(totalIters, "")

# Prepare the output matrix
if (intercept_status == 2) {
    beta_out = append (beta, beta_unscaled);
} else {
    beta_out = beta;
}

write (beta_out, fileB);
"""</span></code></pre></figure>

<p><strong>Output:</strong></p>

<p>None</p>

<h2 id="helper-methods-1">Helper Methods</h2>

<p>This cell contains helper methods to return <code class="highlighter-rouge">Double</code> and <code class="highlighter-rouge">Int</code> values from output generated by the <code class="highlighter-rouge">MLContext</code> API.</p>

<p><strong>Cell:</strong></p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="c1">// Helper functions
</span><span class="k">import</span> <span class="nn">org.apache.sysml.api.MLOutput</span>

<span class="k">def</span> <span class="n">getScalar</span><span class="o">(</span><span class="n">outputs</span><span class="k">:</span> <span class="kt">MLOutput</span><span class="o">,</span> <span class="n">symbol</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Any</span> <span class="o">=</span>
    <span class="n">outputs</span><span class="o">.</span><span class="n">getDF</span><span class="o">(</span><span class="n">sqlContext</span><span class="o">,</span> <span class="n">symbol</span><span class="o">).</span><span class="n">first</span><span class="o">()(</span><span class="mi">1</span><span class="o">)</span>

<span class="k">def</span> <span class="n">getScalarDouble</span><span class="o">(</span><span class="n">outputs</span><span class="k">:</span> <span class="kt">MLOutput</span><span class="o">,</span> <span class="n">symbol</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Double</span> <span class="o">=</span>
    <span class="n">getScalar</span><span class="o">(</span><span class="n">outputs</span><span class="o">,</span> <span class="n">symbol</span><span class="o">).</span><span class="n">asInstanceOf</span><span class="o">[</span><span class="kt">Double</span><span class="o">]</span>

<span class="k">def</span> <span class="n">getScalarInt</span><span class="o">(</span><span class="n">outputs</span><span class="k">:</span> <span class="kt">MLOutput</span><span class="o">,</span> <span class="n">symbol</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span>
    <span class="n">getScalarDouble</span><span class="o">(</span><span class="n">outputs</span><span class="o">,</span> <span class="n">symbol</span><span class="o">).</span><span class="n">toInt</span></code></pre></figure>

<p><strong>Output:</strong></p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">import</span> <span class="nn">org.apache.sysml.api.MLOutput</span>
<span class="n">getScalar</span><span class="k">:</span> <span class="o">(</span><span class="kt">outputs:</span> <span class="kt">org.apache.sysml.api.MLOutput</span><span class="o">,</span> <span class="kt">symbol:</span> <span class="kt">String</span><span class="o">)</span><span class="nc">Any</span>
<span class="n">getScalarDouble</span><span class="k">:</span> <span class="o">(</span><span class="kt">outputs:</span> <span class="kt">org.apache.sysml.api.MLOutput</span><span class="o">,</span> <span class="kt">symbol:</span> <span class="kt">String</span><span class="o">)</span><span class="nc">Double</span>
<span class="n">getScalarInt</span><span class="k">:</span> <span class="o">(</span><span class="kt">outputs:</span> <span class="kt">org.apache.sysml.api.MLOutput</span><span class="o">,</span> <span class="kt">symbol:</span> <span class="kt">String</span><span class="o">)</span><span class="nc">Int</span></code></pre></figure>

<h2 id="convert-dataframe-to-binary-block-format">Convert DataFrame to Binary-Block Format</h2>

<p>SystemML uses a binary-block format for matrix data representation. This cell
explicitly converts the <code class="highlighter-rouge">DataFrame</code> <code class="highlighter-rouge">data</code> object to a binary-block <code class="highlighter-rouge">features</code> matrix
and single-column <code class="highlighter-rouge">label</code> matrix, both represented by the
<code class="highlighter-rouge">JavaPairRDD[MatrixIndexes, MatrixBlock]</code> datatype.</p>

<p><strong>Cell:</strong></p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="c1">// Imports
</span><span class="k">import</span> <span class="nn">org.apache.sysml.api.MLContext</span>
<span class="k">import</span> <span class="nn">org.apache.sysml.runtime.instructions.spark.utils.</span><span class="o">{</span><span class="nc">RDDConverterUtilsExt</span> <span class="k">=&gt;</span> <span class="nc">RDDConverterUtils</span><span class="o">}</span>
<span class="k">import</span> <span class="nn">org.apache.sysml.runtime.matrix.MatrixCharacteristics</span><span class="o">;</span>

<span class="c1">// Create SystemML context
</span><span class="k">val</span> <span class="n">ml</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">MLContext</span><span class="o">(</span><span class="n">sc</span><span class="o">)</span>

<span class="c1">// Convert data to proper format
</span><span class="k">val</span> <span class="n">mcX</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">MatrixCharacteristics</span><span class="o">(</span><span class="n">numRows</span><span class="o">,</span> <span class="n">numCols</span><span class="o">,</span> <span class="mi">1000</span><span class="o">,</span> <span class="mi">1000</span><span class="o">)</span>
<span class="k">val</span> <span class="n">mcY</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">MatrixCharacteristics</span><span class="o">(</span><span class="n">numRows</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">1000</span><span class="o">,</span> <span class="mi">1000</span><span class="o">)</span>
<span class="k">val</span> <span class="n">X</span> <span class="k">=</span> <span class="nc">RDDConverterUtils</span><span class="o">.</span><span class="n">vectorDataFrameToBinaryBlock</span><span class="o">(</span><span class="n">sc</span><span class="o">,</span> <span class="n">data</span><span class="o">,</span> <span class="n">mcX</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="s">"features"</span><span class="o">)</span>
<span class="k">val</span> <span class="n">y</span> <span class="k">=</span> <span class="nc">RDDConverterUtils</span><span class="o">.</span><span class="n">dataFrameToBinaryBlock</span><span class="o">(</span><span class="n">sc</span><span class="o">,</span> <span class="n">data</span><span class="o">.</span><span class="n">select</span><span class="o">(</span><span class="s">"label"</span><span class="o">),</span> <span class="n">mcY</span><span class="o">,</span> <span class="kc">false</span><span class="o">)</span>
<span class="c1">// val y = data.select("label")
</span>
<span class="c1">// Cache
</span><span class="k">val</span> <span class="n">X2</span> <span class="k">=</span> <span class="n">X</span><span class="o">.</span><span class="n">cache</span><span class="o">()</span>
<span class="k">val</span> <span class="n">y2</span> <span class="k">=</span> <span class="n">y</span><span class="o">.</span><span class="n">cache</span><span class="o">()</span>
<span class="k">val</span> <span class="n">cnt1</span> <span class="k">=</span> <span class="n">X2</span><span class="o">.</span><span class="n">count</span><span class="o">()</span>
<span class="k">val</span> <span class="n">cnt2</span> <span class="k">=</span> <span class="n">y2</span><span class="o">.</span><span class="n">count</span><span class="o">()</span></code></pre></figure>

<p><strong>Output:</strong></p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">import</span> <span class="nn">org.apache.sysml.api.MLContext</span>
<span class="k">import</span> <span class="nn">org.apache.sysml.runtime.instructions.spark.utils.</span><span class="o">{</span><span class="nc">RDDConverterUtilsExt</span><span class="k">=&gt;</span><span class="nc">RDDConverterUtils</span><span class="o">}</span>
<span class="k">import</span> <span class="nn">org.apache.sysml.runtime.matrix.MatrixCharacteristics</span>
<span class="n">ml</span><span class="k">:</span> <span class="kt">org.apache.sysml.api.MLContext</span> <span class="o">=</span> <span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">sysml</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="nc">MLContext</span><span class="k">@</span><span class="mf">38d</span><span class="mi">59245</span>
<span class="n">mcX</span><span class="k">:</span> <span class="kt">org.apache.sysml.runtime.matrix.MatrixCharacteristics</span> <span class="o">=</span> <span class="o">[</span><span class="err">10000</span> <span class="kt">x</span> <span class="err">1000</span>, <span class="kt">nnz=-</span><span class="err">1</span>, <span class="kt">blocks</span> <span class="o">(</span><span class="err">1000</span> <span class="kt">x</span> <span class="err">1000</span><span class="o">)]</span>
<span class="n">mcY</span><span class="k">:</span> <span class="kt">org.apache.sysml.runtime.matrix.MatrixCharacteristics</span> <span class="o">=</span> <span class="o">[</span><span class="err">10000</span> <span class="kt">x</span> <span class="err">1</span>, <span class="kt">nnz=-</span><span class="err">1</span>, <span class="kt">blocks</span> <span class="o">(</span><span class="err">1000</span> <span class="kt">x</span> <span class="err">1000</span><span class="o">)]</span>
<span class="n">X</span><span class="k">:</span> <span class="kt">org.apache.spark.api.java.JavaPairRDD</span><span class="o">[</span><span class="kt">org.apache.sysml.runtime.matrix.data.MatrixIndexes</span>,<span class="kt">org.apache.sysml.runtime.matrix.data.MatrixBlock</span><span class="o">]</span> <span class="k">=</span> <span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">java</span><span class="o">.</span><span class="nc">JavaPairRDD</span><span class="nd">@b5a86e3</span>
<span class="n">y</span><span class="k">:</span> <span class="kt">org.apache.spark.api.java.JavaPairRDD</span><span class="o">[</span><span class="kt">org.apache.sysml.runtime.matrix.data.MatrixIndexes</span>,<span class="kt">org.apache.sysml.runtime.matrix.data.MatrixBlock</span><span class="o">]</span> <span class="k">=</span> <span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">java</span><span class="o">.</span><span class="nc">JavaPairRDD</span><span class="k">@</span><span class="mi">56377665</span>
<span class="n">X2</span><span class="k">:</span> <span class="kt">org.apache.spark.api.java.JavaPairRDD</span><span class="o">[</span><span class="kt">org.apache.sysml.runtime.matrix.data.MatrixIndexes</span>,<span class="kt">org.apache.sysml.runtime.matrix.data.MatrixBlock</span><span class="o">]</span> <span class="k">=</span> <span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">java</span><span class="o">.</span><span class="nc">JavaPairRDD</span><span class="k">@</span><span class="mf">650f29d</span><span class="mi">2</span>
<span class="n">y2</span><span class="k">:</span> <span class="kt">org.apache.spark.api.java.JavaPairRDD</span><span class="o">[</span><span class="kt">org.apache.sysml.runtime.matrix.data.MatrixIndexes</span>,<span class="kt">org.apache.sysml.runtime.matrix.data.MatrixBlock</span><span class="o">]</span> <span class="k">=</span> <span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">java</span><span class="o">.</span><span class="nc">JavaPairRDD</span><span class="k">@</span><span class="mi">334857</span><span class="n">a8</span>
<span class="n">cnt1</span><span class="k">:</span> <span class="kt">Long</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">cnt2</span><span class="k">:</span> <span class="kt">Long</span> <span class="o">=</span> <span class="mi">10</span></code></pre></figure>

<h2 id="train-using-systemml-linear-regression-algorithm">Train using SystemML Linear Regression Algorithm</h2>

<p>Now, we can train our model using the SystemML linear regression algorithm. We register the features matrix <code class="highlighter-rouge">X</code> and the label matrix <code class="highlighter-rouge">y</code> as inputs. We register the <code class="highlighter-rouge">beta_out</code> matrix,
<code class="highlighter-rouge">R2</code>, and <code class="highlighter-rouge">totalIters</code> as outputs.</p>

<p><strong>Cell:</strong></p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="c1">// Register inputs &amp; outputs
</span><span class="n">ml</span><span class="o">.</span><span class="n">reset</span><span class="o">()</span>  
<span class="n">ml</span><span class="o">.</span><span class="n">registerInput</span><span class="o">(</span><span class="s">"X"</span><span class="o">,</span> <span class="n">X</span><span class="o">,</span> <span class="n">numRows</span><span class="o">,</span> <span class="n">numCols</span><span class="o">)</span>
<span class="n">ml</span><span class="o">.</span><span class="n">registerInput</span><span class="o">(</span><span class="s">"y"</span><span class="o">,</span> <span class="n">y</span><span class="o">,</span> <span class="n">numRows</span><span class="o">,</span> <span class="mi">1</span><span class="o">)</span>
<span class="c1">// ml.registerInput("y", y)
</span><span class="n">ml</span><span class="o">.</span><span class="n">registerOutput</span><span class="o">(</span><span class="s">"beta_out"</span><span class="o">)</span>
<span class="n">ml</span><span class="o">.</span><span class="n">registerOutput</span><span class="o">(</span><span class="s">"R2"</span><span class="o">)</span>
<span class="n">ml</span><span class="o">.</span><span class="n">registerOutput</span><span class="o">(</span><span class="s">"totalIters"</span><span class="o">)</span>

<span class="c1">// Run the script
</span><span class="k">val</span> <span class="n">start</span> <span class="k">=</span> <span class="nc">System</span><span class="o">.</span><span class="n">currentTimeMillis</span><span class="o">()</span>
<span class="k">val</span> <span class="n">outputs</span> <span class="k">=</span> <span class="n">ml</span><span class="o">.</span><span class="n">executeScript</span><span class="o">(</span><span class="n">linearReg</span><span class="o">)</span>
<span class="k">val</span> <span class="n">trainingTime</span> <span class="k">=</span> <span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="n">currentTimeMillis</span><span class="o">()</span> <span class="o">-</span> <span class="n">start</span><span class="o">).</span><span class="n">toDouble</span> <span class="o">/</span> <span class="mf">1000.0</span>

<span class="c1">// Get outputs
</span><span class="k">val</span> <span class="n">B</span> <span class="k">=</span> <span class="n">outputs</span><span class="o">.</span><span class="n">getDF</span><span class="o">(</span><span class="n">sqlContext</span><span class="o">,</span> <span class="s">"beta_out"</span><span class="o">).</span><span class="n">sort</span><span class="o">(</span><span class="s">"ID"</span><span class="o">).</span><span class="n">drop</span><span class="o">(</span><span class="s">"ID"</span><span class="o">)</span>
<span class="k">val</span> <span class="n">r2</span> <span class="k">=</span> <span class="n">getScalarDouble</span><span class="o">(</span><span class="n">outputs</span><span class="o">,</span> <span class="s">"R2"</span><span class="o">)</span>
<span class="k">val</span> <span class="n">iters</span> <span class="k">=</span> <span class="n">getScalarInt</span><span class="o">(</span><span class="n">outputs</span><span class="o">,</span> <span class="s">"totalIters"</span><span class="o">)</span>
<span class="k">val</span> <span class="n">trainingTimePerIter</span> <span class="k">=</span> <span class="n">trainingTime</span> <span class="o">/</span> <span class="n">iters</span></code></pre></figure>

<p><strong>Output:</strong></p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="n">start</span><span class="k">:</span> <span class="kt">Long</span> <span class="o">=</span> <span class="mi">1444672090620</span>
<span class="n">outputs</span><span class="k">:</span> <span class="kt">org.apache.sysml.api.MLOutput</span> <span class="o">=</span> <span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">sysml</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="nc">MLOutput</span><span class="k">@</span><span class="mf">5d</span><span class="mi">2</span><span class="n">c22d0</span>
<span class="n">trainingTime</span><span class="k">:</span> <span class="kt">Double</span> <span class="o">=</span> <span class="mf">1.176</span>
<span class="n">B</span><span class="k">:</span> <span class="kt">org.apache.spark.sql.DataFrame</span> <span class="o">=</span> <span class="o">[</span><span class="kt">C1:</span> <span class="kt">double</span><span class="o">]</span>
<span class="n">r2</span><span class="k">:</span> <span class="kt">Double</span> <span class="o">=</span> <span class="mf">0.9677079547216473</span>
<span class="n">iters</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">12</span>
<span class="n">trainingTimePerIter</span><span class="k">:</span> <span class="kt">Double</span> <span class="o">=</span> <span class="mf">0.09799999999999999</span></code></pre></figure>

<h2 id="systemml-linear-regression-summary-statistics">SystemML Linear Regression Summary Statistics</h2>

<p>SystemML linear regression summary statistics are displayed by this cell.</p>

<p><strong>Cell:</strong></p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="c1">// Print statistics
</span><span class="n">println</span><span class="o">(</span><span class="n">s</span><span class="s">"R2: ${r2}"</span><span class="o">)</span>
<span class="n">println</span><span class="o">(</span><span class="n">s</span><span class="s">"Iterations: ${iters}"</span><span class="o">)</span>
<span class="n">println</span><span class="o">(</span><span class="n">s</span><span class="s">"Training time per iter: ${trainingTimePerIter} seconds"</span><span class="o">)</span>
<span class="n">B</span><span class="o">.</span><span class="n">describe</span><span class="o">().</span><span class="n">show</span><span class="o">()</span></code></pre></figure>

<p><strong>Output:</strong></p>

<figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="n">R2</span><span class="k">:</span> <span class="err">0</span><span class="kt">.</span><span class="err">9677079547216473</span>
<span class="kt">Iterations:</span> <span class="err">12</span>
<span class="kt">Training</span> <span class="kt">time</span> <span class="kt">per</span> <span class="kt">iter:</span> <span class="err">0</span><span class="kt">.</span><span class="err">2334166666666667</span> <span class="kt">seconds</span>
<span class="o">+-------+-------------------+</span>
<span class="o">|</span><span class="n">summary</span><span class="o">|</span>                 <span class="n">C1</span><span class="o">|</span>
<span class="o">+-------+-------------------+</span>
<span class="o">|</span>  <span class="n">count</span><span class="o">|</span>               <span class="mi">1000</span><span class="o">|</span>
<span class="o">|</span>   <span class="n">mean</span><span class="o">|</span> <span class="mf">0.0184500840658385</span><span class="o">|</span>
<span class="o">|</span> <span class="n">stddev</span><span class="o">|</span> <span class="mf">0.2764750319432085</span><span class="o">|</span>
<span class="o">|</span>    <span class="n">min</span><span class="o">|-</span><span class="mf">0.5426068958986378</span><span class="o">|</span>
<span class="o">|</span>    <span class="n">max</span><span class="o">|</span> <span class="mf">0.5225309861616542</span><span class="o">|</span>
<span class="o">+-------+-------------------+</span></code></pre></figure>

<hr />

<h1 id="jupyter-pyspark-notebook-example---poisson-nonnegative-matrix-factorization---old-api">Jupyter (PySpark) Notebook Example - Poisson Nonnegative Matrix Factorization - OLD API</h1>

<h3 id="note-this-api-is-old-and-has-been-deprecated--2">** <strong>NOTE: This API is old and has been deprecated.</strong> **</h3>
<p><strong>Please use the <a href="spark-mlcontext-programming-guide#jupyter-pyspark-notebook-example---poisson-nonnegative-matrix-factorization">new MLContext API</a> instead.</strong></p>

<p>Here, we&#8217;ll explore the use of SystemML via PySpark in a <a href="http://jupyter.org/">Jupyter notebook</a>.
This Jupyter notebook example can be nicely viewed in a rendered state
<a href="https://github.com/apache/incubator-systemml/blob/master/samples/jupyter-notebooks/SystemML-PySpark-Recommendation-Demo.ipynb">on GitHub</a>,
and can be <a href="https://raw.githubusercontent.com/apache/incubator-systemml/master/samples/jupyter-notebooks/SystemML-PySpark-Recommendation-Demo.ipynb">downloaded here</a> to a directory of your choice.</p>

<p>From the directory with the downloaded notebook, start Jupyter with PySpark:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>PYSPARK_DRIVER_PYTHON=jupyter PYSPARK_DRIVER_PYTHON_OPTS="notebook" $SPARK_HOME/bin/pyspark --master local[*] --driver-class-path $SYSTEMML_HOME/SystemML.jar
</code></pre>
</div>

<p>This will open Jupyter in a browser:</p>

<p><img src="img/spark-mlcontext-programming-guide/jupyter1.png" alt="Jupyter Notebook" title="Jupyter Notebook" /></p>

<p>We can then open up the <code class="highlighter-rouge">SystemML-PySpark-Recommendation-Demo</code> notebook:</p>

<p><img src="img/spark-mlcontext-programming-guide/jupyter2.png" alt="Jupyter Notebook" title="Jupyter Notebook" /></p>

<h2 id="set-up-the-notebook-and-download-the-data-1">Set up the notebook and download the data</h2>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="o">%</span><span class="n">load_ext</span> <span class="n">autoreload</span>
<span class="o">%</span><span class="n">autoreload</span> <span class="mi">2</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>

<span class="c"># Add SystemML PySpark API file.</span>
<span class="n">sc</span><span class="o">.</span><span class="n">addPyFile</span><span class="p">(</span><span class="s">"https://raw.githubusercontent.com/apache/incubator-systemml/3d5f9b11741f6d6ecc6af7cbaa1069cde32be838/src/main/java/org/apache/sysml/api/python/SystemML.py"</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">'figure.figsize'</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="o">%%</span><span class="n">sh</span>
<span class="c"># Download dataset</span>
<span class="n">curl</span> <span class="o">-</span><span class="n">O</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">snap</span><span class="o">.</span><span class="n">stanford</span><span class="o">.</span><span class="n">edu</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">amazon0601</span><span class="o">.</span><span class="n">txt</span><span class="o">.</span><span class="n">gz</span>
<span class="n">gunzip</span> <span class="n">amazon0601</span><span class="o">.</span><span class="n">txt</span><span class="o">.</span><span class="n">gz</span></code></pre></figure>

<h2 id="use-pyspark-to-load-the-data-in-as-a-spark-dataframe-1">Use PySpark to load the data in as a Spark DataFrame</h2>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># Load data</span>
<span class="kn">import</span> <span class="nn">pyspark.sql.functions</span> <span class="kn">as</span> <span class="nn">F</span>
<span class="n">dataPath</span> <span class="o">=</span> <span class="s">"amazon0601.txt"</span>

<span class="n">X_train</span> <span class="o">=</span> <span class="p">(</span><span class="n">sc</span><span class="o">.</span><span class="n">textFile</span><span class="p">(</span><span class="n">dataPath</span><span class="p">)</span>
    <span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="ow">not</span> <span class="n">l</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">"#"</span><span class="p">))</span>
    <span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="n">l</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">"</span><span class="se">\t</span><span class="s">"</span><span class="p">))</span>
    <span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">prods</span><span class="p">:</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">prods</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">prods</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="mf">1.0</span><span class="p">))</span>
    <span class="o">.</span><span class="n">toDF</span><span class="p">((</span><span class="s">"prod_i"</span><span class="p">,</span> <span class="s">"prod_j"</span><span class="p">,</span> <span class="s">"x_ij"</span><span class="p">))</span>
    <span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="s">"prod_i &lt; 500 AND prod_j &lt; 500"</span><span class="p">)</span> <span class="c"># Filter for memory constraints</span>
    <span class="o">.</span><span class="n">cache</span><span class="p">())</span>

<span class="n">max_prod_i</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="nb">max</span><span class="p">(</span><span class="s">"prod_i"</span><span class="p">))</span><span class="o">.</span><span class="n">first</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">max_prod_j</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="nb">max</span><span class="p">(</span><span class="s">"prod_j"</span><span class="p">))</span><span class="o">.</span><span class="n">first</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">numProducts</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_prod_i</span><span class="p">,</span> <span class="n">max_prod_j</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="c"># 0-based indexing</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Total number of products: {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">numProducts</span><span class="p">))</span></code></pre></figure>

<h2 id="create-a-systemml-mlcontext-object-1">Create a SystemML MLContext object</h2>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># Create SystemML MLContext</span>
<span class="kn">from</span> <span class="nn">SystemML</span> <span class="kn">import</span> <span class="n">MLContext</span>
<span class="n">ml</span> <span class="o">=</span> <span class="n">MLContext</span><span class="p">(</span><span class="n">sc</span><span class="p">)</span></code></pre></figure>

<h2 id="define-a-kernel-for-poisson-nonnegative-matrix-factorization-pnmf-in-dml-1">Define a kernel for Poisson nonnegative matrix factorization (PNMF) in DML</h2>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># Define PNMF kernel in SystemML's DSL using the R-like syntax for PNMF</span>
<span class="n">pnmf</span> <span class="o">=</span> <span class="s">"""
# data &amp; args
X = read($X)
X = X+1 # change product IDs to be 1-based, rather than 0-based
V = table(X[,1], X[,2])
size = ifdef($size, -1)
if(size &gt; -1) {
    V = V[1:size,1:size]
}
max_iteration = as.integer($maxiter)
rank = as.integer($rank)

n = nrow(V)
m = ncol(V)
range = 0.01
W = Rand(rows=n, cols=rank, min=0, max=range, pdf="uniform")
H = Rand(rows=rank, cols=m, min=0, max=range, pdf="uniform")
losses = matrix(0, rows=max_iteration, cols=1)

# run PNMF
i=1
while(i &lt;= max_iteration) {
  # update params
  H = (H * (t(W) </span><span class="si">%*% </span><span class="s">(V/(W</span><span class="si">%*%</span><span class="s">H))))/t(colSums(W))
  W = (W * ((V/(W</span><span class="si">%*%</span><span class="s">H)) </span><span class="si">%*% </span><span class="s">t(H)))/t(rowSums(H))

  # compute loss
  losses[i,] = -1 * (sum(V*log(W</span><span class="si">%*%</span><span class="s">H)) - as.scalar(colSums(W)</span><span class="si">%*%</span><span class="s">rowSums(H)))
  i = i + 1;
}

# write outputs
write(losses, $lossout)
write(W, $Wout)
write(H, $Hout)
"""</span></code></pre></figure>

<h2 id="execute-the-algorithm-1">Execute the algorithm</h2>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># Run the PNMF script on SystemML with Spark</span>
<span class="n">ml</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<span class="n">outputs</span> <span class="o">=</span> <span class="n">ml</span><span class="o">.</span><span class="n">executeScript</span><span class="p">(</span><span class="n">pnmf</span><span class="p">,</span> <span class="p">{</span><span class="s">"X"</span><span class="p">:</span> <span class="n">X_train</span><span class="p">,</span> <span class="s">"maxiter"</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s">"rank"</span><span class="p">:</span> <span class="mi">10</span><span class="p">},</span> <span class="p">[</span><span class="s">"W"</span><span class="p">,</span> <span class="s">"H"</span><span class="p">,</span> <span class="s">"losses"</span><span class="p">])</span></code></pre></figure>

<h2 id="retrieve-the-losses-during-training-and-plot-them-1">Retrieve the losses during training and plot them</h2>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># Plot training loss over time</span>
<span class="n">losses</span> <span class="o">=</span> <span class="n">outputs</span><span class="o">.</span><span class="n">getDF</span><span class="p">(</span><span class="n">sqlContext</span><span class="p">,</span> <span class="s">"losses"</span><span class="p">)</span>
<span class="n">xy</span> <span class="o">=</span> <span class="n">losses</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">losses</span><span class="o">.</span><span class="n">ID</span><span class="p">)</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">xy</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">'Iteration'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">'Loss'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">'PNMF Training Loss'</span><span class="p">)</span></code></pre></figure>

<p><img src="img/spark-mlcontext-programming-guide/jupyter_loss_graph.png" alt="Jupyter Loss Graph" title="Jupyter Loss Graph" /></p>

<hr />

<h1 id="recommended-spark-configuration-settings">Recommended Spark Configuration Settings</h1>

<p>For best performance, we recommend setting the following flags when running SystemML with Spark:
<code class="highlighter-rouge">--conf spark.driver.maxResultSize=0 --conf spark.akka.frameSize=128</code>.</p>


        </div> <!-- /container -->

        

        <script src="js/vendor/jquery-1.12.0.min.js"></script>
        <script src="js/vendor/bootstrap.min.js"></script>
        <script src="js/vendor/anchor.min.js"></script>
        <script src="js/main.js"></script>
        




        <!-- Analytics -->
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
            ga('create', 'UA-71553733-1', 'auto');
            ga('send', 'pageview');
        </script>



        <!-- MathJax Section -->
        <script type="text/x-mathjax-config">
            MathJax.Hub.Config({
                TeX: { equationNumbers: { autoNumber: "AMS" } }
            });
        </script>
        <script>
            // Note that we load MathJax this way to work with local file (file://), HTTP and HTTPS.
            // We could use "//cdn.mathjax...", but that won't support "file://".
            (function(d, script) {
                script = d.createElement('script');
                script.type = 'text/javascript';
                script.async = true;
                script.onload = function(){
                    MathJax.Hub.Config({
                        tex2jax: {
                            inlineMath: [ ["$", "$"], ["\\\\(","\\\\)"] ],
                            displayMath: [ ["$$","$$"], ["\\[", "\\]"] ],
                            processEscapes: true,
                            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre']
                        }
                    });
                };
                script.src = ('https:' == document.location.protocol ? 'https://' : 'http://') +
                    'cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
                d.getElementsByTagName('head')[0].appendChild(script);
            }(document));
        </script>
    </body>
</html>
