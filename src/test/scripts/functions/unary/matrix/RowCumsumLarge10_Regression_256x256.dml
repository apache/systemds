# Test-specific focus:
#   Regression-style test combining multiple patterns.
#
# Why this matters:
#   Designed to catch subtle bugs introduced by future refactoring.
#
# Matrix characteristics:
#   - Mixed signs
#   - Row-dependent offsets
#   - Moderate size across both dimensions
#
# Expected result:
#   Sequential loop reference.
#
# Output:
#   Writes TRUE/FALSE to $1
#
# NOTE:
# - Do NOT call setExecMode() here. Exec mode is controlled by CLI: -exec spark

n = 256;  m = 256;

# Create structured matrix with mixed sign and magnitude
ri = matrix(seq(1, n), n, 1);
cj = matrix(seq(1, m), 1, m);

X = ((ri %*% matrix(1, 1, m)) - (matrix(1, n, 1) %*% cj)) / 10;
X = X + ((ri %% 7) %*% matrix(1, 1, m));  # add row-dependent offsets

# Row-wise cumulative sum (builtin is lower-case in DML)
Y = rowcumsum(X);

# Reference via loop
E = matrix(0, n, m);
E[, 1] = X[, 1];
for (j in 2:m) {
  E[, j] = E[, j-1] + X[, j];
}

err  = max(abs(Y - E));
pass = (err < 1e-9);

write(pass, $1);
